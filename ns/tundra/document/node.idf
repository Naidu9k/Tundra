<?xml version="1.0" encoding="UTF-8"?>

<Values version="2.0">
  <value name="node_type">interface</value>
  <value name="node_nsName">tundra.document</value>
  <value name="encodeutf8">true</value>
  <value name="shared">Ly8gYW1lbmRzIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCB3aXRoIHRoZSB7a2V5LHZhbHVlfSBw
YWlycyBzcGVjaWZpZWQgaW4gdGhlCi8vIGFtZW5kbWVudHMgSURhdGEKcHVibGljIHN0YXRpYyBJ
RGF0YSBhbWVuZChJRGF0YSBkb2N1bWVudCwgSURhdGFbXSBhbWVuZG1lbnRzLCBJRGF0YSBzY29w
ZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRpb24gewogIGlmIChhbWVuZG1lbnRzID09IG51bGwpIHJl
dHVybiBkb2N1bWVudDsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbWVuZG1lbnRzLmxlbmd0aDsg
aSsrKSB7CiAgICBpZiAoYW1lbmRtZW50c1tpXSAhPSBudWxsKSB7CiAgICAgIElEYXRhQ3Vyc29y
IGN1cnNvciA9IGFtZW5kbWVudHNbaV0uZ2V0Q3Vyc29yKCk7CiAgICAgIFN0cmluZyBrZXkgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImtleSIpOwogICAgICBTdHJpbmcgdmFsdWUgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgInZhbHVlIik7CiAgICAgIFN0cmluZyBjb25kaXRp
b24gPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImNvbmRpdGlvbiIpOwogICAgICBjdXJz
b3IuZGVzdHJveSgpOwoKICAgICAga2V5ID0gdHVuZHJhLnN0cmluZy5zdWJzdGl0dXRlKGtleSwg
c2NvcGUpOwogICAgICB2YWx1ZSA9IHR1bmRyYS5zdHJpbmcuc3Vic3RpdHV0ZSh2YWx1ZSwgc2Nv
cGUpOwoKICAgICAgaWYgKChjb25kaXRpb24gPT0gbnVsbCkgfHwgdHVuZHJhLmNvbmRpdGlvbi5l
dmFsdWF0ZShjb25kaXRpb24sIHNjb3BlKSkgewogICAgICAgIGRvY3VtZW50ID0gdHVuZHJhLnN1
cHBvcnQuZG9jdW1lbnQucHV0KGRvY3VtZW50LCBrZXksIHZhbHVlKTsKICAgICAgfQogICAgfQog
IH0KCiAgcmV0dXJuIGRvY3VtZW50Owp9CgovLyByZXR1cm5zIHdoZXRoZXIgdHdvIGRvY3VtZW50
cyBhcmUgZXF1YWwKcHVibGljIHN0YXRpYyBib29sZWFuIGVxdWFsKElEYXRhIHgsIElEYXRhIHkp
IHsKICByZXR1cm4gdHVuZHJhLm9iamVjdC5lcXVhbCh4LCB5KTsKfQoKLy8gcmV0dXJucyBhbGwg
dGhlIGtleXMgaW4gdGhlIGdpdmVuIGRvY3VtZW50IGFzIGEgc3RyaW5nIGxpc3QKcHVibGljIHN0
YXRpYyBTdHJpbmdbXSBrZXlzZXQoSURhdGEgaW5wdXQpIHsKICByZXR1cm4ga2V5c2V0KGlucHV0
LCBudWxsKTsKfQoKLy8gcmV0dXJucyB0aGUga2V5cyB0aGF0IG1hdGNoIHRoZSBnaXZlbiByZWd1
bGFyIGV4cHJlc3Npb24gcGF0dGVybgovLyBpbiB0aGUgZ2l2ZW4gZG9jdW1lbnQgYXMgYSBzdHJp
bmcgbGlzdApwdWJsaWMgc3RhdGljIFN0cmluZ1tdIGtleXNldChJRGF0YSBpbnB1dCwgU3RyaW5n
IHBhdHRlcm5TdHJpbmcpIHsKICBqYXZhLnV0aWwucmVnZXguUGF0dGVybiBwYXR0ZXJuID0gbnVs
bDsKICBpZiAocGF0dGVyblN0cmluZyAhPSBudWxsKSBwYXR0ZXJuID0gamF2YS51dGlsLnJlZ2V4
LlBhdHRlcm4uY29tcGlsZShwYXR0ZXJuU3RyaW5nKTsKCiAgamF2YS51dGlsLkxpc3Q8U3RyaW5n
PiBrZXlzID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8U3RyaW5nPigpOwogIGlmIChpbnB1dCAh
PSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAg
IHdoaWxlKGN1cnNvci5uZXh0KCkpIHsKICAgICAgU3RyaW5nIGtleSA9IGN1cnNvci5nZXRLZXko
KTsKCiAgICAgIGlmIChwYXR0ZXJuID09IG51bGwpIHsKICAgICAgICBrZXlzLmFkZChrZXkpOwog
ICAgICB9IGVsc2UgewogICAgICAgIGphdmEudXRpbC5yZWdleC5NYXRjaGVyIG1hdGNoZXIgPSBw
YXR0ZXJuLm1hdGNoZXIoa2V5KTsKICAgICAgICBpZiAobWF0Y2hlci5tYXRjaGVzKCkpIGtleXMu
YWRkKGtleSk7CiAgICAgIH0KICAgIH0KICAgIGN1cnNvci5kZXN0cm95KCk7CiAgfQogIHJldHVy
biAoU3RyaW5nW10pa2V5cy50b0FycmF5KG5ldyBTdHJpbmdbMF0pOwp9CgovLyByZXR1cm5zIGFs
bCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBkb2N1bWVudCBhcyBhIHN0cmluZyBsaXN0CnB1Ymxp
YyBzdGF0aWMgT2JqZWN0W10gdmFsdWVzZXQoSURhdGEgaW5wdXQpIHsKICBqYXZhLnV0aWwuTGlz
dCB2YWx1ZXMgPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdCgpOwogIGphdmEudXRpbC5TZXQ8Q2xh
c3M8Pz4+IGNsYXNzZXMgPSBuZXcgamF2YS51dGlsLkxpbmtlZEhhc2hTZXQ8Q2xhc3M8Pz4+KCk7
CgogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5n
ZXRDdXJzb3IoKTsKICAgIHdoaWxlKGN1cnNvci5uZXh0KCkpIHsKICAgICAgT2JqZWN0IHZhbHVl
ID0gY3Vyc29yLmdldFZhbHVlKCk7CiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSBjbGFzc2VzLmFk
ZCh2YWx1ZS5nZXRDbGFzcygpKTsKICAgICAgdmFsdWVzLmFkZCh2YWx1ZSk7CiAgICB9CiAgICBj
dXJzb3IuZGVzdHJveSgpOwogIH0KCiAgQ2xhc3M8Pz4gbmVhcmVzdEFuY2VzdG9yID0gdHVuZHJh
LnN1cHBvcnQub2JqZWN0Lm5lYXJlc3RBbmNlc3RvcihjbGFzc2VzKTsKICBpZiAobmVhcmVzdEFu
Y2VzdG9yID09IG51bGwpIG5lYXJlc3RBbmNlc3RvciA9IE9iamVjdC5jbGFzczsKICAKICByZXR1
cm4gdmFsdWVzLnRvQXJyYXkoKE9iamVjdFtdKWphdmEubGFuZy5yZWZsZWN0LkFycmF5Lm5ld0lu
c3RhbmNlKG5lYXJlc3RBbmNlc3RvciwgMCkpOwp9CgovLyBtZXJnZXMgbXVsdGlwbGUgSURhdGEg
ZG9jdW1lbnRzIGludG8gYSBzaW5nbGUgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBtZXJn
ZShJRGF0YVtdIGlucHV0KSB7CiAgSURhdGEgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgp
OwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGlucHV0Lmxl
bmd0aDsgaSsrKSB7CiAgICAgIElEYXRhVXRpbC5tZXJnZShpbnB1dFtpXSwgb3V0cHV0KTsKICAg
IH0KICB9CiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gc29ydHMgdGhlIGdpdmVuIElEYXRhIGRvY3Vt
ZW50IGJ5IGl0cyBrZXlzIGluIG5hdHVyYWwgYXNjZW5kaW5nIG9yZGVyCnB1YmxpYyBzdGF0aWMg
SURhdGEgc29ydChJRGF0YSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09
IG51bGwpIHJldHVybiBudWxsOwoKICBTdHJpbmdbXSBrZXlzID0ga2V5c2V0KGlucHV0KTsKICBq
YXZhLnV0aWwuQXJyYXlzLnNvcnQoa2V5cyk7CgogIElEYXRhIG91dHB1dCA9IElEYXRhRmFjdG9y
eS5jcmVhdGUoKTsKICBJRGF0YUN1cnNvciBpYyA9IGlucHV0LmdldEN1cnNvcigpOwogIElEYXRh
Q3Vyc29yIG9jID0gb3V0cHV0LmdldEN1cnNvcigpOwoKICBmb3IgKGludCBpID0gMDsgaSA8IGtl
eXMubGVuZ3RoOyBpKyspIHsKICAgIGJvb2xlYW4gcmVzdWx0OwoKICAgIGlmIChpID4gMCAmJiBr
ZXlzW2ldLmVxdWFscyhrZXlzW2ktMV0pKSB7CiAgICAgIHJlc3VsdCA9IGljLm5leHQoa2V5c1tp
XSk7CiAgICB9IGVsc2UgewogICAgICByZXN1bHQgPSBpYy5maXJzdChrZXlzW2ldKTsKICAgIH0K
CiAgICBpZiAocmVzdWx0KSB7CiAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7Cgog
ICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiByZWN1cnNlKSB7CiAgICAgICAgaWYgKHZhbHVlIGlu
c3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgIHZhbHVlID0gc29ydCgoSURhdGEpdmFsdWUsIHJl
Y3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtdIHx8IHZh
bHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFibGUpIHsKICAgICAgICAgIElEYXRhW10gYXJy
YXkgPSB2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURhdGFbXSl2YWx1ZSA6ICgoY29tLndt
LnV0aWwuVGFibGUpdmFsdWUpLmdldFZhbHVlcygpOwogICAgICAgICAgZm9yIChpbnQgaiA9IDA7
IGogPCBhcnJheS5sZW5ndGg7IGorKykgewogICAgICAgICAgICBhcnJheVtqXSA9IHNvcnQoYXJy
YXlbal0sIHJlY3Vyc2UpOwogICAgICAgICAgfQogICAgICAgICAgdmFsdWUgPSBhcnJheTsKICAg
ICAgICB9CiAgICAgIH0KICAgICAgb2MuaW5zZXJ0QWZ0ZXIoa2V5c1tpXSwgdmFsdWUpOwogICAg
fQogIH0KCiAgaWMuZGVzdHJveSgpOwogIG9jLmRlc3Ryb3koKTsKCiAgcmV0dXJuIG91dHB1dDsK
fQoKLy8gdHJpbXMgYWxsIHN0cmluZyB2YWx1ZXMsIHRoZW4gY29udmVydHMgZW1wdHkgc3RyaW5n
cyB0byBudWxscywgdGhlbiBjb21wYWN0cyBieSByZW1vdmluZyBhbGwgbnVsbCB2YWx1ZXMKcHVi
bGljIHN0YXRpYyBJRGF0YSBzcXVlZXplKElEYXRhIGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsK
ICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51bGw7CgogIElEYXRhIG91dHB1dCA9IElEYXRh
RmFjdG9yeS5jcmVhdGUoKTsKICBJRGF0YUN1cnNvciBpYyA9IGlucHV0LmdldEN1cnNvcigpOwog
IElEYXRhQ3Vyc29yIG9jID0gb3V0cHV0LmdldEN1cnNvcigpOwoKICB3aGlsZShpYy5uZXh0KCkp
IHsKICAgIFN0cmluZyBrZXkgPSBpYy5nZXRLZXkoKTsKICAgIE9iamVjdCB2YWx1ZSA9IGljLmdl
dFZhbHVlKCk7CgogICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgaWYgKHZhbHVlIGluc3Rh
bmNlb2YgU3RyaW5nKSB7CiAgICAgICAgU3RyaW5nIHN0cmluZyA9IChTdHJpbmcpdmFsdWU7CiAg
ICAgICAgc3RyaW5nID0gc3RyaW5nLnRyaW0oKTsKICAgICAgICBpZiAoc3RyaW5nLmVxdWFscygi
IikpIHN0cmluZyA9IG51bGw7CiAgICAgICAgdmFsdWUgPSBzdHJpbmc7CiAgICAgIH0gZWxzZSBp
ZiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtdIHx8IHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0
aWwuVGFibGUpIHsKICAgICAgICBJRGF0YVtdIGFycmF5ID0gdmFsdWUgaW5zdGFuY2VvZiBJRGF0
YVtdID8gKElEYXRhW10pdmFsdWUgOiAoKGNvbS53bS51dGlsLlRhYmxlKXZhbHVlKS5nZXRWYWx1
ZXMoKTsKICAgICAgICBpZiAocmVjdXJzZSkgewogICAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlz
dC5kb2N1bWVudC5zcXVlZXplKGFycmF5LCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKGFy
cmF5Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICB2YWx1ZSA9IG51bGw7CiAgICAgICAgfQogICAg
ICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAgICAgICBpZiAocmVjdXJz
ZSkgewogICAgICAgICAgdmFsdWUgPSBzcXVlZXplKChJRGF0YSl2YWx1ZSwgcmVjdXJzZSk7CiAg
ICAgICAgfSBlbHNlIHsKICAgICAgICAgIElEYXRhQ3Vyc29yIHZjID0gKChJRGF0YSl2YWx1ZSku
Z2V0Q3Vyc29yKCk7CiAgICAgICAgICBpZiAoSURhdGFVdGlsLnNpemUodmMpID09IDApIHZhbHVl
ID0gbnVsbDsKICAgICAgICAgIHZjLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBp
ZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3RbXVtdKSB7CiAgICAgICAgdmFsdWUgPSB0dW5kcmEu
c3VwcG9ydC50YWJsZS5vYmplY3Quc3F1ZWV6ZSgoT2JqZWN0W11bXSl2YWx1ZSk7CiAgICAgIH0g
ZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3RbXSkgewogICAgICAgIHZhbHVlID0gdHVu
ZHJhLmxpc3Qub2JqZWN0LnNxdWVlemUoKE9iamVjdFtdKXZhbHVlKTsKICAgICAgfQoKICAgICAg
aWYgKHZhbHVlICE9IG51bGwpIG9jLmluc2VydEFmdGVyKGtleSwgdmFsdWUpOwogICAgfQogIH0K
CiAgaWYgKElEYXRhVXRpbC5zaXplKG9jKSA9PSAwKSBvdXRwdXQgPSBudWxsOwoKICBpYy5kZXN0
cm95KCk7CiAgb2MuZGVzdHJveSgpOwoKICByZXR1cm4gb3V0cHV0Owp9CgovLyByZXR1cm5zIHRo
ZSBudW1iZXIgb2YgdG9wLWxldmVsIHtrZXksIHZhbHVlfSBwYWlycyBpbiB0aGUgZ2l2ZW4gSURh
dGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBpbnQgc2l6ZShJRGF0YSBpbnB1dCkgewogIGludCBz
aXplID0gMDsKICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAgSURhdGFDdXJzb3IgY3Vyc29yID0g
aW5wdXQuZ2V0Q3Vyc29yKCk7CiAgICBzaXplID0gSURhdGFVdGlsLnNpemUoY3Vyc29yKTsKICAg
IGN1cnNvci5kZXN0cm95KCk7CiAgfQogIHJldHVybiBzaXplOwp9CgovLyByZXR1cm5zIGEgY2xv
bmUgb2YgdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgSURhdGEgZHVwbGlj
YXRlKElEYXRhIGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHRocm93cyBTZXJ2aWNlRXhjZXB0aW9u
IHsKICBJRGF0YSBvdXRwdXQgPSBudWxsOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0
YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIHRyeSB7CiAgICAgIGlmIChy
ZWN1cnNlKSB7CiAgICAgICAgb3V0cHV0ID0gSURhdGFVdGlsLmRlZXBDbG9uZShpbnB1dCk7CiAg
ICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0ID0gSURhdGFVdGlsLmNsb25lKGlucHV0KTsKICAg
ICAgfQogICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBleCkgewogICAgICB0dW5kcmEu
ZXhjZXB0aW9uLnJhaXNlKGV4KTsKICAgIH0gZmluYWxseSB7CiAgICAgIGN1cnNvci5kZXN0cm95
KCk7CiAgICB9CiAgfQogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIHJlbW92ZXMgdGhlIHZhbHVlIHdp
dGggdGhlIGdpdmVuIGtleSBmcm9tIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3Rh
dGljIElEYXRhIGRyb3AoSURhdGEgaW5wdXQsIFN0cmluZyBrZXkpIHsKICBpZiAoaW5wdXQgIT0g
bnVsbCAmJiBrZXkgIT0gbnVsbCkgewogICAgSURhdGFDdXJzb3IgY3Vyc29yID0gaW5wdXQuZ2V0
Q3Vyc29yKCk7CiAgICBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwga2V5KTsKICAgIGN1cnNvci5k
ZXN0cm95KCk7CgogICAgaWYgKHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LktleS5pc0Z1bGx5UXVh
bGlmaWVkKGtleSkpIGRyb3AoaW5wdXQsIHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LktleS5wYXJz
ZShrZXkpKTsKICB9CiAgcmV0dXJuIGlucHV0Owp9CgovLyByZW1vdmVzIHRoZSB2YWx1ZSB3aXRo
IHRoZSBnaXZlbiBrZXkgZnJvbSB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQKcHJvdGVjdGVkIHN0
YXRpYyBJRGF0YSBkcm9wKElEYXRhIGlucHV0LCBqYXZhLnV0aWwuUXVldWU8dHVuZHJhLnN1cHBv
cnQuZG9jdW1lbnQuS2V5PiBrZXlzKSB7CiAgaWYgKGlucHV0ICE9IG51bGwgJiYga2V5cyAhPSBu
dWxsICYmIGtleXMuc2l6ZSgpID4gMCkgewogICAgSURhdGFDdXJzb3IgY3Vyc29yID0gaW5wdXQu
Z2V0Q3Vyc29yKCk7CiAgICB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5LZXkga2V5ID0ga2V5cy5y
ZW1vdmUoKTsKCiAgICBpZiAoa2V5cy5zaXplKCkgPiAwKSB7CiAgICAgIGlmIChrZXkuaGFzSW5k
ZXgoKSkgewogICAgICAgIElEYXRhW10gYXJyYXkgPSBJRGF0YVV0aWwuZ2V0SURhdGFBcnJheShj
dXJzb3IsIGtleS50b1N0cmluZygpKTsKICAgICAgICBkcm9wKHR1bmRyYS5saXN0Lm9iamVjdC5n
ZXQoYXJyYXksIGtleS5nZXRJbmRleCgpKSwga2V5cyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg
ZHJvcChJRGF0YVV0aWwuZ2V0SURhdGEoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSksIGtleXMpOwog
ICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoa2V5Lmhhc0luZGV4KCkpIHsKICAgICAgICBP
YmplY3RbXSBhcnJheSA9IElEYXRhVXRpbC5nZXRPYmplY3RBcnJheShjdXJzb3IsIGtleS50b1N0
cmluZygpKTsKICAgICAgICBJRGF0YVV0aWwucHV0KGN1cnNvciwga2V5LnRvU3RyaW5nKCksIHR1
bmRyYS5saXN0Lm9iamVjdC5kcm9wKGFycmF5LCBrZXkuZ2V0SW5kZXgoKSkpOwogICAgICB9IGVs
c2UgewogICAgICAgIElEYXRhVXRpbC5yZW1vdmUoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSk7CiAg
ICAgIH0KICAgIH0KICAgIGN1cnNvci5kZXN0cm95KCk7CiAgfQogIHJldHVybiBpbnB1dDsKfQoK
Ly8gdmlzaXRzIGVhY2ggZWxlbWVudCBpbiB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQsIGNhbGxz
IHRoZSBnaXZlbiBzZXJ2aWNlIHRvIGNvbnZlcnQgdGhlIGVsZW1lbnQsIGFuZCBjcmVhdGVzIGEg
bmV3IElEYXRhIGRvY3VtZW50IHdpdGggdGhlIHJlc3VsdGluZyBlbGVtZW50cwpwdWJsaWMgc3Rh
dGljIElEYXRhIG1hcChJRGF0YSBpbnB1dCwgU3RyaW5nIHNlcnZpY2UsIElEYXRhIHBpcGVsaW5l
LCBTdHJpbmcga2V5SW5wdXQsIFN0cmluZyBrZXlPdXRwdXQsIFN0cmluZyB2YWx1ZUlucHV0LCBT
dHJpbmcgdmFsdWVPdXRwdXQsIENsYXNzIHZhbHVlQ2xhc3MsIGJvb2xlYW4gcmVjdXJzZSkgdGhy
b3dzIFNlcnZpY2VFeGNlcHRpb24gewogIElEYXRhIG91dHB1dCA9IG51bGw7CgogIGlmIChpbnB1
dCAhPSBudWxsICYmIHNlcnZpY2UgIT0gbnVsbCkgewogICAgSURhdGFDdXJzb3IgaWMgPSBpbnB1
dC5nZXRDdXJzb3IoKTsKICAgIG91dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKICAgIElE
YXRhQ3Vyc29yIG9jID0gb3V0cHV0LmdldEN1cnNvcigpOwoKICAgIGlmIChrZXlJbnB1dCA9PSBu
dWxsKSBrZXlJbnB1dCA9ICIka2V5IjsKICAgIGlmIChrZXlPdXRwdXQgPT0gbnVsbCkga2V5T3V0
cHV0ID0ga2V5SW5wdXQ7CiAgICBpZiAodmFsdWVJbnB1dCA9PSBudWxsKSB2YWx1ZUlucHV0ID0g
IiR2YWx1ZSI7CiAgICBpZiAodmFsdWVPdXRwdXQgPT0gbnVsbCkgdmFsdWVPdXRwdXQgPSB2YWx1
ZUlucHV0OwogICAgaWYgKHBpcGVsaW5lID09IG51bGwpIHBpcGVsaW5lID0gSURhdGFGYWN0b3J5
LmNyZWF0ZSgpOwoKICAgIHRyeSB7CiAgICAgIHdoaWxlKGljLm5leHQoKSkgewogICAgICAgIFR1
cGxlPE9iamVjdD4gdHVwbGUgPSBuZXcgVHVwbGU8T2JqZWN0PihpYy5nZXRLZXkoKSwgaWMuZ2V0
VmFsdWUoKSk7CgogICAgICAgIGlmIChyZWN1cnNlICYmIHR1cGxlLnZhbHVlICE9IG51bGwpIHsK
ICAgICAgICAgIGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIElEYXRhKSB7CiAgICAgICAgICAg
IHR1cGxlLnZhbHVlID0gbWFwKChJRGF0YSl0dXBsZS52YWx1ZSwgc2VydmljZSwgcGlwZWxpbmUs
IGtleUlucHV0LCBrZXlPdXRwdXQsIHZhbHVlSW5wdXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNz
LCByZWN1cnNlKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5zdGFuY2VvZiBJ
RGF0YVtdIHx8IHR1cGxlLnZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFibGUpIHsKICAg
ICAgICAgICAgSURhdGFbXSBpYXJ5ID0gdHVwbGUudmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtdID8g
KElEYXRhW10pdHVwbGUudmFsdWUgOiAoKGNvbS53bS51dGlsLlRhYmxlKXR1cGxlLnZhbHVlKS5n
ZXRWYWx1ZXMoKTsKICAgICAgICAgICAgSURhdGFbXSBvYXJ5ID0gbmV3IElEYXRhW2lhcnkubGVu
Z3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpYXJ5Lmxlbmd0aDsgaSsrKSB7
CiAgICAgICAgICAgICAgb2FyeVtpXSA9IG1hcChpYXJ5W2ldLCBzZXJ2aWNlLCBwaXBlbGluZSwg
a2V5SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3Ms
IHJlY3Vyc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVlID0gb2FyeTsK
ICAgICAgICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5zdGFuY2VvZiBTdHJpbmdbXVtdKSB7
CiAgICAgICAgICAgIFN0cmluZ1tdW10gaWFyeSA9IChTdHJpbmdbXVtdKXR1cGxlLnZhbHVlOwog
ICAgICAgICAgICBTdHJpbmdbXVtdIG9hcnkgPSBuZXcgU3RyaW5nW2lhcnkubGVuZ3RoXVtdOwog
ICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlhcnkubGVuZ3RoOyBpKyspIHsKICAgICAg
ICAgICAgICBpZiAoaWFyeVtpXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBvYXJ5W2ldID0g
bmV3IFN0cmluZ1tpYXJ5W2ldLmxlbmd0aF07CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0g
MDsgaiA8IGlhcnlbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgVHVwbGU8U3Ry
aW5nPiB0ID0gbWFwKG5ldyBUdXBsZTxTdHJpbmc+KHR1cGxlLmtleSwgaWFyeVtpXVtqXSksIHNl
cnZpY2UsIHBpcGVsaW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91
dHB1dCwgdmFsdWVDbGFzcyk7CiAgICAgICAgICAgICAgICAgIG9hcnlbaV1bal0gPSB0LnZhbHVl
OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg
ICAgICB0dXBsZS52YWx1ZSA9IG9hcnk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR1cGxlLnZhbHVl
IGluc3RhbmNlb2YgU3RyaW5nW10pIHsKICAgICAgICAgICAgU3RyaW5nW10gaWFyeSA9IChTdHJp
bmdbXSl0dXBsZS52YWx1ZTsKICAgICAgICAgICAgU3RyaW5nW10gb2FyeSA9IG5ldyBTdHJpbmdb
aWFyeS5sZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlhcnkubGVuZ3Ro
OyBpKyspIHsKICAgICAgICAgICAgICBUdXBsZTxTdHJpbmc+IHQgPSBtYXAobmV3IFR1cGxlPFN0
cmluZz4odHVwbGUua2V5LCBpYXJ5W2ldKSwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlucHV0LCBr
ZXlPdXRwdXQsIHZhbHVlSW5wdXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNzKTsKICAgICAgICAg
ICAgICBvYXJ5W2ldID0gdC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0dXBsZS52
YWx1ZSA9IG9hcnk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR1cGxlLnZhbHVlIGluc3RhbmNlb2Yg
T2JqZWN0W10pIHsKICAgICAgICAgICAgT2JqZWN0W10gaWFyeSA9IChPYmplY3RbXSl0dXBsZS52
YWx1ZTsKICAgICAgICAgICAgT2JqZWN0W10gb2FyeSA9IG5ldyBPYmplY3RbaWFyeS5sZW5ndGhd
OwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlhcnkubGVuZ3RoOyBpKyspIHsKICAg
ICAgICAgICAgICBUdXBsZTxPYmplY3Q+IHQgPSBtYXAobmV3IFR1cGxlPE9iamVjdD4odHVwbGUu
a2V5LCBpYXJ5W2ldKSwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlucHV0LCBrZXlPdXRwdXQsIHZh
bHVlSW5wdXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNzKTsKICAgICAgICAgICAgICBvYXJ5W2ld
ID0gdC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0dXBsZS52YWx1ZSA9IG9hcnk7
CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHR1cGxlID0gbWFwKHR1cGxlLCBzZXJ2aWNl
LCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQs
IHZhbHVlQ2xhc3MpOwogICAgICAgIElEYXRhVXRpbC5wdXQob2MsIHR1cGxlLmtleSwgdHVwbGUu
dmFsdWUpOwogICAgICB9CiAgICB9IGZpbmFsbHkgewogICAgICBpYy5kZXN0cm95KCk7CiAgICAg
IG9jLmRlc3Ryb3koKTsKICAgIH0KICB9IGVsc2UgewogICAgb3V0cHV0ID0gZHVwbGljYXRlKGlu
cHV0LCByZWN1cnNlKTsKICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIHdyYXBwZXIgY2xhc3Mg
Zm9yIHtrZXksIHZhbHVlfSB0dXBsZXMKcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBUdXBsZTxUPiB7
IAogIHB1YmxpYyBTdHJpbmcga2V5OwogIHB1YmxpYyBUIHZhbHVlOwogIHB1YmxpYyBUdXBsZShT
dHJpbmcga2V5LCBUIHZhbHVlKSB7IAogICAgdGhpcy5rZXkgPSBrZXk7IAogICAgdGhpcy52YWx1
ZSA9IHZhbHVlOyAKICB9Cn0KCi8vIGNvbnZlcnRzIHRoZSBnaXZlbiBlbGVtZW50IGJ5IGNhbGxp
bmcgdGhlIGdpdmVuIHNlcnZpY2UsIGFuZCByZXR1cm5zIHRoZSByZXN1bHQKcHJvdGVjdGVkIHN0
YXRpYyA8VD4gVHVwbGU8VD4gbWFwKFR1cGxlPFQ+IHR1cGxlLCBTdHJpbmcgc2VydmljZSwgSURh
dGEgcGlwZWxpbmUsIFN0cmluZyBrZXlJbnB1dCwgU3RyaW5nIGtleU91dHB1dCwgU3RyaW5nIHZh
bHVlSW5wdXQsIFN0cmluZyB2YWx1ZU91dHB1dCwgQ2xhc3MgdmFsdWVDbGFzcykgdGhyb3dzIFNl
cnZpY2VFeGNlcHRpb24gewogIGlmICh0dXBsZS52YWx1ZSA9PSBudWxsIHx8IHZhbHVlQ2xhc3Mg
PT0gbnVsbCB8fCB2YWx1ZUNsYXNzLmlzSW5zdGFuY2UodHVwbGUudmFsdWUpKSB7CiAgICBJRGF0
YUN1cnNvciBjdXJzb3IgPSBwaXBlbGluZS5nZXRDdXJzb3IoKTsKICAgIElEYXRhVXRpbC5wdXQo
Y3Vyc29yLCBrZXlJbnB1dCwgdHVwbGUua2V5KTsKICAgIElEYXRhVXRpbC5wdXQoY3Vyc29yLCB2
YWx1ZUlucHV0LCB0dXBsZS52YWx1ZSk7CiAgICBjdXJzb3IuZGVzdHJveSgpOwoKICAgIHBpcGVs
aW5lID0gdHVuZHJhLnNlcnZpY2UuaW52b2tlKHNlcnZpY2UsIHBpcGVsaW5lKTsKCiAgICAvLyBj
bGVhbiB1cCB0aGUgaW5wdXQgcGlwZWxpbmUKICAgIGN1cnNvciA9IHBpcGVsaW5lLmdldEN1cnNv
cigpOwogICAgdHVwbGUua2V5ID0gSURhdGFVdGlsLmdldFN0cmluZyhjdXJzb3IsIGtleU91dHB1
dCk7CiAgICB0dXBsZS52YWx1ZSA9IChUKUlEYXRhVXRpbC5nZXQoY3Vyc29yLCB2YWx1ZU91dHB1
dCk7CiAgICBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwga2V5SW5wdXQpOwogICAgaWYgKCFrZXlJ
bnB1dC5lcXVhbHMoa2V5T3V0cHV0KSkgSURhdGFVdGlsLnJlbW92ZShjdXJzb3IsIGtleU91dHB1
dCk7CiAgICBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwgdmFsdWVJbnB1dCk7CiAgICBpZiAoIXZh
bHVlSW5wdXQuZXF1YWxzKHZhbHVlT3V0cHV0KSkgSURhdGFVdGlsLnJlbW92ZShjdXJzb3IsIHZh
bHVlT3V0cHV0KTsKICAgIGN1cnNvci5kZXN0cm95KCk7CiAgfSAgCiAgcmV0dXJuIHR1cGxlOwp9
CgovLyBpbnZva2VzIHRoZSBnaXZlbiBzZXJ2aWNlIGZvciBlYWNoIHtrZXksIHZhbHVlfSBwYWly
IGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIHZvaWQgZWFjaChJRGF0
YSBpbnB1dCwgU3RyaW5nIHNlcnZpY2UsIElEYXRhIHBpcGVsaW5lLCBTdHJpbmcga2V5SW5wdXQs
IFN0cmluZyB2YWx1ZUlucHV0LCBDbGFzcyB2YWx1ZUNsYXNzLCBib29sZWFuIHJlY3Vyc2UpIHRo
cm93cyBTZXJ2aWNlRXhjZXB0aW9uIHsKICBtYXAoaW5wdXQsIHNlcnZpY2UsIHBpcGVsaW5lLCBr
ZXlJbnB1dCwgbnVsbCwgdmFsdWVJbnB1dCwgbnVsbCwgdmFsdWVDbGFzcywgcmVjdXJzZSk7Cn0K
Ci8vIHJlbmFtZXMgYSBrZXkgZnJvbSBzb3VyY2UgdG8gdGFyZ2V0IHdpdGhpbiB0aGUgZ2l2ZW4g
SURhdGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSByZW5hbWUoSURhdGEgaW5wdXQsIFN0
cmluZyBzb3VyY2UsIFN0cmluZyB0YXJnZXQpIHsKICBpZiAoIXNvdXJjZS5lcXVhbHModGFyZ2V0
KSkgaW5wdXQgPSBkcm9wKGNvcHkoaW5wdXQsIHNvdXJjZSwgdGFyZ2V0KSwgc291cmNlKTsKICBy
ZXR1cm4gaW5wdXQ7Cn0KCi8vIGNvcGllcyBhIHZhbHVlIGZyb20gc291cmNlIGtleSB0byB0YXJn
ZXQga2V5IHdpdGhpbiB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0
YSBjb3B5KElEYXRhIGlucHV0LCBTdHJpbmcgc291cmNlLCBTdHJpbmcgdGFyZ2V0KSB7CiAgaWYg
KHNvdXJjZS5lcXVhbHModGFyZ2V0KSkgcmV0dXJuIGlucHV0OwogIHJldHVybiB0dW5kcmEuc3Vw
cG9ydC5kb2N1bWVudC5wdXQoaW5wdXQsIHRhcmdldCwgdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQu
Z2V0KGlucHV0LCBzb3VyY2UpKTsKfQoKLy8gcmVtb3ZlcyBhbGwgbnVsbCB2YWx1ZXMgZnJvbSB0
aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBjb21wYWN0KElEYXRh
IGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBJRGF0YSBvdXRwdXQgPSBudWxsOwoKICBpZiAo
aW5wdXQgIT0gbnVsbCkgewogICAgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogICAg
SURhdGFDdXJzb3IgaWMgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIElEYXRhQ3Vyc29yIG9jID0g
b3V0cHV0LmdldEN1cnNvcigpOwoKICAgIHRyeSB7CiAgICAgIHdoaWxlKGljLm5leHQoKSkgewog
ICAgICAgIFN0cmluZyBrZXkgPSBpYy5nZXRLZXkoKTsKICAgICAgICBPYmplY3QgdmFsdWUgPSBp
Yy5nZXRWYWx1ZSgpOwoKICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgaWYg
KHJlY3Vyc2UpIHsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAg
ICAgICAgICAgICB2YWx1ZSA9IGNvbXBhY3QoKElEYXRhKXZhbHVlLCByZWN1cnNlKTsKICAgICAg
ICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdmFsdWUgaW5zdGFu
Y2VvZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAgICAgICAgIHZhbHVlID0gdHVuZHJhLmxp
c3QuZG9jdW1lbnQuY29tcGFjdCh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURhdGFbXSl2
YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdldFZhbHVlcygpLCByZWN1cnNlKTsK
ICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdFtdW10pIHsKICAg
ICAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5zdXBwb3J0LnRhYmxlLm9iamVjdC5jb21wYWN0KChP
YmplY3RbXVtdKXZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9m
IE9iamVjdFtdKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlzdC5vYmplY3QuY29t
cGFjdCgoT2JqZWN0W10pdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAg
fQoKICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgSURhdGFVdGlsLnB1dChvYywga2V5LCB2YWx1
ZSk7CiAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgIGljLmRlc3Ryb3koKTsKICAgICAgb2Mu
ZGVzdHJveSgpOwogICAgfQogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gcmV0dXJucyBhIG5l
dyBJRGF0YSBkb2N1bWVudCwgd2hlcmUgYWxsIElEYXRhcyBhcmUgaW1wbGVtZW50ZWQgd2l0aCB0
aGUgc2FtZSBjbGFzcywgYW5kIGFsbAovLyBmdWxseSBxdWFsaWZpZWQga2V5cyBhcmUgcmVwbGFj
ZWQgd2l0aCBhIG5lc3RlZCBzdHJ1Y3R1cmUKcHVibGljIHN0YXRpYyBJRGF0YSBub3JtYWxpemUo
SURhdGEgaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxsKSByZXR1
cm4gbnVsbDsKCiAgSURhdGEgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogIElEYXRh
Q3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CgogIHRyeSB7CiAgICB3aGlsZShpYy5uZXh0
KCkpIHsKICAgICAgU3RyaW5nIGtleSA9IGljLmdldEtleSgpOwogICAgICBPYmplY3QgdmFsdWUg
PSBpYy5nZXRWYWx1ZSgpOwoKICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgICBpZiAo
dmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5jb2Rlci5JRGF0YUNvZGFibGUpIHsKICAgICAg
ICAgIHZhbHVlID0gKChjb20ud20udXRpbC5jb2Rlci5JRGF0YUNvZGFibGUpdmFsdWUpLmdldElE
YXRhKCk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLmNv
ZGVyLlZhbHVlc0NvZGFibGUpIHsKICAgICAgICAgIHZhbHVlID0gKChjb20ud20udXRpbC5jb2Rl
ci5WYWx1ZXNDb2RhYmxlKXZhbHVlKS5nZXRWYWx1ZXMoKTsKICAgICAgICB9IGVsc2UgaWYgKHZh
bHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuY29kZXIuSURhdGFDb2RhYmxlW10pIHsKICAgICAg
ICAgIHZhbHVlID0gbm9ybWFsaXplKChjb20ud20udXRpbC5jb2Rlci5JRGF0YUNvZGFibGVbXSl2
YWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGNvbS53
bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGVbXSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxp
emUoKGNvbS53bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGVbXSl2YWx1ZSwgcmVjdXJzZSk7CiAg
ICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10pIHsKICAgICAgICAgIHZh
bHVlID0gbm9ybWFsaXplKChJRGF0YVtdKXZhbHVlLCByZWN1cnNlKTsKICAgICAgICB9IGVsc2Ug
aWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFibGUpIHsKICAgICAgICAgIHZhbHVl
ID0gbm9ybWFsaXplKCgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdldFZhbHVlcygpLCByZWN1
cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHJlY3Vyc2UgJiYgdmFsdWUgaW5zdGFuY2VvZiBJRGF0
YSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxpemUoKElEYXRhKXZhbHVlLCByZWN1cnNlKTsK
ICAgICAgICB9CiAgICAgIH0KICAgICAgdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQucHV0KG91dHB1
dCwga2V5LCB2YWx1ZSk7CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIGljLmRlc3Ryb3koKTsKICB9
CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIG5vcm1hbGl6ZXMgYW4gSURhdGFbXSwgd2hlcmUgYWxs
IElEYXRhcyBhcmUgaW1wbGVtZW50ZWQgd2l0aCB0aGUgc2FtZSBjbGFzcywgYW5kIGFsbAovLyBm
dWxseSBxdWFsaWZpZWQga2V5cyBhcmUgcmVwbGFjZWQgd2l0aCBhIG5lc3RlZCBzdHJ1Y3R1cmUK
cHJvdGVjdGVkIHN0YXRpYyBJRGF0YVtdIG5vcm1hbGl6ZShJRGF0YVtdIGlucHV0LCBib29sZWFu
IHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51bGw7CgogIElEYXRhW10g
b3V0cHV0ID0gbmV3IElEYXRhW2lucHV0Lmxlbmd0aF07CiAgZm9yIChpbnQgaSA9IDA7IGkgPCBp
bnB1dC5sZW5ndGg7IGkrKykgewogICAgb3V0cHV0W2ldID0gbm9ybWFsaXplKGlucHV0W2ldLCBy
ZWN1cnNlKTsKICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIGNvbnZlcnRzIGFuIElEYXRhQ29k
YWJsZVtdIHRvIGFuIElEYXRhW10gYW5kIG5vcm1hbGl6ZXMsIHdoZXJlIGFsbCBJRGF0YXMgYXJl
IGltcGxlbWVudGVkIAovLyB3aXRoIHRoZSBzYW1lIGNsYXNzLCBhbmQgYWxsIGZ1bGx5IHF1YWxp
ZmllZCBrZXlzIGFyZSByZXBsYWNlZCB3aXRoIGEgbmVzdGVkIHN0cnVjdHVyZQpwcm90ZWN0ZWQg
c3RhdGljIElEYXRhW10gbm9ybWFsaXplKGNvbS53bS51dGlsLmNvZGVyLklEYXRhQ29kYWJsZVtd
IGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51
bGw7CgogIElEYXRhW10gb3V0cHV0ID0gbmV3IElEYXRhW2lucHV0Lmxlbmd0aF07CiAgZm9yIChp
bnQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgb3V0cHV0W2ldID0gbm9ybWFs
aXplKGlucHV0W2ldLmdldElEYXRhKCksIHJlY3Vyc2UpOwogIH0KICAKICByZXR1cm4gb3V0cHV0
Owp9CgovLyBjb252ZXJ0cyBhIFZhbHVlc0NvZGFibGVbXSB0byBhbiBJRGF0YVtdIGFuZCBub3Jt
YWxpemVzLCB3aGVyZSBhbGwgSURhdGFzIGFyZSBpbXBsZW1lbnRlZCAKLy8gd2l0aCB0aGUgc2Ft
ZSBjbGFzcywgYW5kIGFsbCBmdWxseSBxdWFsaWZpZWQga2V5cyBhcmUgcmVwbGFjZWQgd2l0aCBh
IG5lc3RlZCBzdHJ1Y3R1cmUKcHJvdGVjdGVkIHN0YXRpYyBJRGF0YVtdIG5vcm1hbGl6ZShjb20u
d20udXRpbC5jb2Rlci5WYWx1ZXNDb2RhYmxlW10gaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgewog
IGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgSURhdGFbXSBvdXRwdXQgPSBuZXcg
SURhdGFbaW5wdXQubGVuZ3RoXTsKICBmb3IgKGludCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsg
aSsrKSB7CiAgICBvdXRwdXRbaV0gPSBub3JtYWxpemUoaW5wdXRbaV0uZ2V0VmFsdWVzKCksIHJl
Y3Vyc2UpOwogIH0KICAKICByZXR1cm4gb3V0cHV0Owp9CgovLyByZW1vdmVzIGFsbCBrZXlzIGV4
Y2VwdCB0aG9zZSBzcGVjaWZpZWQgZnJvbSB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQKcHVibGlj
IHN0YXRpYyB2b2lkIGNsZWFyKElEYXRhIGRvY3VtZW50LCBTdHJpbmdbXSBrZXlzKSB7CiAgaWYg
KGRvY3VtZW50ID09IG51bGwpIHJldHVybjsKCiAgSURhdGEgc2F2ZWQgPSBudWxsOwogIGlmIChr
ZXlzICE9IG51bGwpIHsKICAgIHNhdmVkID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogICAgZm9y
IChpbnQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIE9iamVjdCB2YWx1ZSA9
IHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LmdldChkb2N1bWVudCwga2V5c1tpXSk7CiAgICAgIGlm
ICh2YWx1ZSAhPSBudWxsKSB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5wdXQoc2F2ZWQsIGtleXNb
aV0sIHZhbHVlKTsKICAgIH0KICB9CgogIElEYXRhQ3Vyc29yIGN1cnNvciA9IGRvY3VtZW50Lmdl
dEN1cnNvcigpOwogIGN1cnNvci5maXJzdCgpOwogIHdoaWxlKGN1cnNvci5kZWxldGUoKSk7CiAg
Y3Vyc29yLmRlc3Ryb3koKTsKCiAgaWYgKGtleXMgIT0gbnVsbCkgSURhdGFVdGlsLm1lcmdlKHNh
dmVkLCBkb2N1bWVudCk7Cn0KCi8vIGNvbnZlcnRzIGFuIElEYXRhIGRvY3VtZW50IHRvIGFuIElE
YXRhW10gZG9jdW1lbnQgbGlzdCB3aXRoIGVhY2gKLy8gaXRlbSByZXByZXNlbnRpbmcgZWFjaCBr
ZXkgdmFsdWUgdHVwbGUgZnJvbSB0aGUgZ2l2ZW4gZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0
YVtdIHBpdm90KElEYXRhIGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0g
bnVsbCkgcmV0dXJuIG51bGw7CgogIElEYXRhQ3Vyc29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNv
cigpOwogIGphdmEudXRpbC5MaXN0PElEYXRhPiBwaXZvdCA9IG5ldyBqYXZhLnV0aWwuQXJyYXlM
aXN0PElEYXRhPigpOwoKICB3aGlsZShjdXJzb3IubmV4dCgpKSB7CiAgICBTdHJpbmcga2V5ID0g
Y3Vyc29yLmdldEtleSgpOwogICAgT2JqZWN0IHZhbHVlID0gY3Vyc29yLmdldFZhbHVlKCk7Cgog
ICAgaWYgKHJlY3Vyc2UgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICBpZiAodmFsdWUgaW5zdGFu
Y2VvZiBJRGF0YSkgewogICAgICAgIHZhbHVlID0gcGl2b3QoKElEYXRhKXZhbHVlLCByZWN1cnNl
KTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdmFsdWUgaW5z
dGFuY2VvZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAgIElEYXRhW10gYXJyYXkgPSB2YWx1
ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURhdGFbXSl2YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFi
bGUpdmFsdWUpLmdldFZhbHVlcygpOwoKICAgICAgICBqYXZhLnV0aWwuTGlzdDxJRGF0YVtdPiBs
aXN0PSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxJRGF0YVtdPihhcnJheS5sZW5ndGgpOwoKICAg
ICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBs
aXN0LmFkZChwaXZvdChhcnJheVtpXSwgcmVjdXJzZSkpOwogICAgICAgIH0KCiAgICAgICAgdmFs
dWUgPSBsaXN0LnRvQXJyYXkobmV3IElEYXRhWzBdWzBdKTsKICAgICAgfQogICAgfQoKICAgIElE
YXRhIGl0ZW0gPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgICBJRGF0YUN1cnNvciBpYyA9IGl0
ZW0uZ2V0Q3Vyc29yKCk7CiAgICBJRGF0YVV0aWwucHV0KGljLCAia2V5Iiwga2V5KTsKICAgIElE
YXRhVXRpbC5wdXQoaWMsICJ2YWx1ZSIsIHZhbHVlKTsKICAgIGljLmRlc3Ryb3koKTsKCiAgICBw
aXZvdC5hZGQoaXRlbSk7CiAgfQoKICByZXR1cm4gcGl2b3QudG9BcnJheShuZXcgSURhdGFbMF0p
Owp9CgovLyBwZXJmb3JtcyB2YXJpYWJsZSBzdWJzdGl0dXRpb24gb24gYWxsIGVsZW1lbnRzIG9m
IHRoZSBnaXZlbiBJRGF0YSBpbnB1dCBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIHN1YnN0
aXR1dGUoSURhdGEgaW5wdXQsIElEYXRhIHNjb3BlLCBib29sZWFuIHJlY3Vyc2UpIHsKICByZXR1
cm4gc3Vic3RpdHV0ZShpbnB1dCwgc2NvcGUsIG51bGwsIHJlY3Vyc2UpOwp9CgovLyBwZXJmb3Jt
cyB2YXJpYWJsZSBzdWJzdGl0dXRpb24gb24gYWxsIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBJRGF0
YSBpbnB1dCBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIHN1YnN0aXR1dGUoSURhdGEgaW5w
dXQsIElEYXRhIHNjb3BlLCBTdHJpbmcgZGVmYXVsdFZhbHVlLCBib29sZWFuIHJlY3Vyc2UpIHsK
ICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgaWYgKHNjb3BlID09IG51bGwpIHNj
b3BlID0gaW5wdXQ7CgogIElEYXRhIG91dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKCiAg
SURhdGFDdXJzb3IgaWMgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICBJRGF0YUN1cnNvciBvYyA9IG91
dHB1dC5nZXRDdXJzb3IoKTsKCiAgdHJ5IHsKICAgIHdoaWxlKGljLm5leHQoKSkgewogICAgICBT
dHJpbmcga2V5ID0gaWMuZ2V0S2V5KCk7CiAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVl
KCk7CiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgaWYgKHJlY3Vyc2UgJiYgdmFs
dWUgaW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAgICAgdmFsdWUgPSBzdWJzdGl0dXRlKChJRGF0
YSl2YWx1ZSwgc2NvcGUsIGRlZmF1bHRWYWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlm
IChyZWN1cnNlICYmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdmFsdWUgaW5zdGFuY2Vv
ZiBjb20ud20udXRpbC5UYWJsZSkpIHsKICAgICAgICAgIElEYXRhW10gaWFyeSA9IHZhbHVlIGlu
c3RhbmNlb2YgSURhdGFbXSA/IChJRGF0YVtdKXZhbHVlIDogKChjb20ud20udXRpbC5UYWJsZSl2
YWx1ZSkuZ2V0VmFsdWVzKCk7CiAgICAgICAgICBJRGF0YVtdIG9hcnkgPSBuZXcgSURhdGFbaWFy
eS5sZW5ndGhdOwogICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpYXJ5Lmxlbmd0aDsgaSsr
KSBvYXJ5W2ldID0gc3Vic3RpdHV0ZShpYXJ5W2ldLCBzY29wZSwgZGVmYXVsdFZhbHVlLCByZWN1
cnNlKTsKICAgICAgICAgIHZhbHVlID0gb2FyeTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGlu
c3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5zdHJpbmcuc3Vic3Rp
dHV0ZSgoU3RyaW5nKXZhbHVlLCBzY29wZSwgZGVmYXVsdFZhbHVlKTsKICAgICAgICB9IGVsc2Ug
aWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nW10pIHsKICAgICAgICAgIHZhbHVlID0gdHVuZHJh
Lmxpc3Quc3RyaW5nLnN1YnN0aXR1dGUoKFN0cmluZ1tdKXZhbHVlLCBzY29wZSwgZGVmYXVsdFZh
bHVlKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nW11bXSkgewog
ICAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlzdC5zdHJpbmcuc3Vic3RpdHV0ZSgoU3RyaW5nW11b
XSl2YWx1ZSwgc2NvcGUsIGRlZmF1bHRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIElE
YXRhVXRpbC5wdXQob2MsIGtleSwgdmFsdWUpOwogICAgfQogIH0gZmluYWxseSB7CiAgICBpYy5k
ZXN0cm95KCk7CiAgICBvYy5kZXN0cm95KCk7CiAgfQoKICByZXR1cm4gb3V0cHV0Owp9CgovLyBw
YXJzZXMgYW4gSURhdGEgWE1MIGlucHV0IHN0cmVhbSB0byBhbiBJRGF0YSBvYmplY3QKcHVibGlj
IHN0YXRpYyBJRGF0YSBwYXJzZShqYXZhLmlvLklucHV0U3RyZWFtIGluKSB0aHJvd3MgamF2YS5p
by5JT0V4Y2VwdGlvbiB7CiAgY29tLndtLnV0aWwuY29kZXIuWE1MQ29kZXJXcmFwcGVyIGNvZGVj
ID0gbmV3IGNvbS53bS51dGlsLmNvZGVyLlhNTENvZGVyV3JhcHBlcigpOwogIHJldHVybiBjb2Rl
Yy5kZWNvZGUoaW4pOwp9CgovLyBwYXJzZXMgYW4gSURhdGEgWE1MIHN0cmluZywgYnl0ZSBhcnJh
eSBvciBpbnB1dCBzdHJlYW0gdG8gYW4gSURhdGEgb2JqZWN0CnB1YmxpYyBzdGF0aWMgSURhdGEg
cGFyc2UoT2JqZWN0IGNvbnRlbnQsIFN0cmluZyBlbmNvZGluZykgdGhyb3dzIGphdmEuaW8uSU9F
eGNlcHRpb24gewogIHJldHVybiBwYXJzZSgoamF2YS5pby5JbnB1dFN0cmVhbSl0dW5kcmEub2Jq
ZWN0LmNvbnZlcnQoY29udGVudCwgZW5jb2RpbmcsICJzdHJlYW0iKSk7Cn0KCi8vIGVtaXRzIGFu
IElEYXRhIG9iamVjdCBhcyBhIGFuIElEYXRhIFhNTCBzdHJpbmcsIGJ5dGUgYXJyYXkgb3Igc3Ry
ZWFtCnB1YmxpYyBzdGF0aWMgT2JqZWN0IGVtaXQoSURhdGEgZG9jdW1lbnQsIFN0cmluZyBlbmNv
ZGluZywgU3RyaW5nIG1vZGUpIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICBjb20ud20u
dXRpbC5jb2Rlci5JRGF0YVhNTENvZGVyIGNvZGVjID0gbnVsbDsKICBpZiAoZW5jb2RpbmcgPT0g
bnVsbCkgewogICAgY29kZWMgPSBuZXcgY29tLndtLnV0aWwuY29kZXIuSURhdGFYTUxDb2Rlcigp
OwogIH0gZWxzZSB7CiAgICBjb2RlYyA9IG5ldyBjb20ud20udXRpbC5jb2Rlci5JRGF0YVhNTENv
ZGVyKGVuY29kaW5nKTsKICB9CgogIGphdmEuaW8uQnl0ZUFycmF5T3V0cHV0U3RyZWFtIG91dCA9
IG5ldyBqYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbSgpOwogIGNvZGVjLmVuY29kZShvdXQs
IGRvY3VtZW50KTsKCiAgcmV0dXJuIHR1bmRyYS5vYmplY3QuY29udmVydChvdXQudG9CeXRlQXJy
YXkoKSwgZW5jb2RpbmcsIG1vZGUpOwp9</value>
  <value name="extends"></value>
  <array name="implements" type="value" depth="1">
  </array>
  <array name="imports" type="value" depth="1">
  </array>
</Values>
