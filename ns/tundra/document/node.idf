<?xml version="1.0" encoding="UTF-8"?>

<Values version="2.0">
  <value name="node_type">interface</value>
  <value name="node_nsName">tundra.document</value>
  <value name="encodeutf8">true</value>
  <value name="shared">Ly8gYW1lbmRzIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCB3aXRoIHRoZSB7a2V5LHZhbHVlfSBw
YWlycyBzcGVjaWZpZWQgaW4gdGhlCi8vIGFtZW5kbWVudHMgSURhdGEKcHVibGljIHN0YXRpYyBJ
RGF0YSBhbWVuZChJRGF0YSBkb2N1bWVudCwgSURhdGFbXSBhbWVuZG1lbnRzLCBJRGF0YSBzY29w
ZSkgewogIGlmIChhbWVuZG1lbnRzID09IG51bGwpIHJldHVybiBkb2N1bWVudDsKCiAgZm9yIChp
bnQgaSA9IDA7IGkgPCBhbWVuZG1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAoYW1lbmRtZW50
c1tpXSAhPSBudWxsKSB7CiAgICAgIElEYXRhQ3Vyc29yIGN1cnNvciA9IGFtZW5kbWVudHNbaV0u
Z2V0Q3Vyc29yKCk7CiAgICAgIFN0cmluZyBrZXkgPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNv
ciwgImtleSIpOwogICAgICBTdHJpbmcgdmFsdWUgPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNv
ciwgInZhbHVlIik7CiAgICAgIFN0cmluZyBjb25kaXRpb24gPSBJRGF0YVV0aWwuZ2V0U3RyaW5n
KGN1cnNvciwgImNvbmRpdGlvbiIpOwogICAgICBjdXJzb3IuZGVzdHJveSgpOwoKICAgICAga2V5
ID0gdHVuZHJhLnN0cmluZy5zdWJzdGl0dXRlKGtleSwgc2NvcGUpOwogICAgICB2YWx1ZSA9IHR1
bmRyYS5zdHJpbmcuc3Vic3RpdHV0ZSh2YWx1ZSwgc2NvcGUpOwoKICAgICAgaWYgKChjb25kaXRp
b24gPT0gbnVsbCkgfHwgdHVuZHJhLmNvbmRpdGlvbi5ldmFsdWF0ZShjb25kaXRpb24sIHNjb3Bl
KSkgewogICAgICAgIGRvY3VtZW50ID0gdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQucHV0KGRvY3Vt
ZW50LCBrZXksIHZhbHVlKTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIGRvY3VtZW50Owp9
CgovLyByZXR1cm5zIHdoZXRoZXIgdHdvIGRvY3VtZW50cyBhcmUgZXF1YWwKcHVibGljIHN0YXRp
YyBib29sZWFuIGVxdWFsKElEYXRhIHgsIElEYXRhIHkpIHsKICByZXR1cm4gdHVuZHJhLm9iamVj
dC5lcXVhbCh4LCB5KTsKfQoKLy8gcmV0dXJucyBhbGwgdGhlIGtleXMgaW4gdGhlIGdpdmVuIGRv
Y3VtZW50IGFzIGEgc3RyaW5nIGxpc3QKcHVibGljIHN0YXRpYyBTdHJpbmdbXSBrZXlzZXQoSURh
dGEgaW5wdXQpIHsKICBqYXZhLnV0aWwuTGlzdDxTdHJpbmc+IGtleXMgPSBuZXcgamF2YS51dGls
LkFycmF5TGlzdDxTdHJpbmc+KCk7CiAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgIElEYXRhQ3Vy
c29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgd2hpbGUoY3Vyc29yLm5leHQoKSkg
ewogICAgICBrZXlzLmFkZChjdXJzb3IuZ2V0S2V5KCkpOwogICAgfQogICAgY3Vyc29yLmRlc3Ry
b3koKTsKICB9CiAgcmV0dXJuIChTdHJpbmdbXSlrZXlzLnRvQXJyYXkobmV3IFN0cmluZ1swXSk7
Cn0KCi8vIHJldHVybnMgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIGRvY3VtZW50IGFzIGEg
c3RyaW5nIGxpc3QKcHVibGljIHN0YXRpYyBPYmplY3RbXSB2YWx1ZXNldChJRGF0YSBpbnB1dCkg
ewogIGphdmEudXRpbC5MaXN0PE9iamVjdD4gdmFsdWVzID0gbmV3IGphdmEudXRpbC5BcnJheUxp
c3Q8T2JqZWN0PigpOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJz
b3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIHdoaWxlKGN1cnNvci5uZXh0KCkpIHsKICAgICAg
dmFsdWVzLmFkZChjdXJzb3IuZ2V0VmFsdWUoKSk7CiAgICB9CiAgICBjdXJzb3IuZGVzdHJveSgp
OwogIH0KICByZXR1cm4gKE9iamVjdFtdKXZhbHVlcy50b0FycmF5KG5ldyBPYmplY3RbMF0pOwp9
CgovLyBtZXJnZXMgbXVsdGlwbGUgSURhdGEgZG9jdW1lbnRzIGludG8gYSBzaW5nbGUgZG9jdW1l
bnQKcHVibGljIHN0YXRpYyBJRGF0YSBtZXJnZShJRGF0YVtdIGlucHV0KSB7CiAgSURhdGEgb3V0
cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBm
b3IgKGludCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIElEYXRhVXRpbC5t
ZXJnZShpbnB1dFtpXSwgb3V0cHV0KTsKICAgIH0KICB9CiAgcmV0dXJuIG91dHB1dDsKfQoKLy8g
c29ydHMgdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50IGJ5IGl0cyBrZXlzIGluIG5hdHVyYWwgYXNj
ZW5kaW5nIG9yZGVyCnB1YmxpYyBzdGF0aWMgSURhdGEgc29ydChJRGF0YSBpbnB1dCwgYm9vbGVh
biByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09IG51bGwpIHJldHVybiBudWxsOwoKICBTdHJpbmdb
XSBrZXlzID0ga2V5c2V0KGlucHV0KTsKICBqYXZhLnV0aWwuQXJyYXlzLnNvcnQoa2V5cyk7Cgog
IElEYXRhIG91dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKICBJRGF0YUN1cnNvciBpYyA9
IGlucHV0LmdldEN1cnNvcigpOwogIElEYXRhQ3Vyc29yIG9jID0gb3V0cHV0LmdldEN1cnNvcigp
OwoKICBmb3IgKGludCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgIGJvb2xlYW4g
cmVzdWx0OwoKICAgIGlmIChpID4gMCAmJiBrZXlzW2ldLmVxdWFscyhrZXlzW2ktMV0pKSB7CiAg
ICAgIHJlc3VsdCA9IGljLm5leHQoa2V5c1tpXSk7CiAgICB9IGVsc2UgewogICAgICByZXN1bHQg
PSBpYy5maXJzdChrZXlzW2ldKTsKICAgIH0KCiAgICBpZiAocmVzdWx0KSB7CiAgICAgIE9iamVj
dCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7CgogICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiByZWN1
cnNlKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgIHZh
bHVlID0gc29ydCgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAodmFs
dWUgaW5zdGFuY2VvZiBJRGF0YVtdIHx8IHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFi
bGUpIHsKICAgICAgICAgIElEYXRhW10gYXJyYXkgPSB2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10g
PyAoSURhdGFbXSl2YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdldFZhbHVlcygp
OwogICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGorKykgewogICAg
ICAgICAgICBhcnJheVtqXSA9IHNvcnQoYXJyYXlbal0sIHJlY3Vyc2UpOwogICAgICAgICAgfQog
ICAgICAgICAgdmFsdWUgPSBhcnJheTsKICAgICAgICB9CiAgICAgIH0KICAgICAgb2MuaW5zZXJ0
QWZ0ZXIoa2V5c1tpXSwgdmFsdWUpOwogICAgfQogIH0KCiAgaWMuZGVzdHJveSgpOwogIG9jLmRl
c3Ryb3koKTsKCiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gdHJpbXMgYWxsIHN0cmluZyB2YWx1ZXMs
IHRoZW4gY29udmVydHMgZW1wdHkgc3RyaW5ncyB0byBudWxscywgdGhlbiBjb21wYWN0cyBieSBy
ZW1vdmluZyBhbGwgbnVsbCB2YWx1ZXMKcHVibGljIHN0YXRpYyBJRGF0YSBzcXVlZXplKElEYXRh
IGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51
bGw7CgogIElEYXRhIG91dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKICBJRGF0YUN1cnNv
ciBpYyA9IGlucHV0LmdldEN1cnNvcigpOwogIElEYXRhQ3Vyc29yIG9jID0gb3V0cHV0LmdldEN1
cnNvcigpOwoKICB3aGlsZShpYy5uZXh0KCkpIHsKICAgIFN0cmluZyBrZXkgPSBpYy5nZXRLZXko
KTsKICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7CgogICAgaWYgKHZhbHVlICE9IG51
bGwpIHsKICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgU3RyaW5n
IHN0cmluZyA9IChTdHJpbmcpdmFsdWU7CiAgICAgICAgc3RyaW5nID0gc3RyaW5nLnRyaW0oKTsK
ICAgICAgICBpZiAoc3RyaW5nLmVxdWFscygiIikpIHN0cmluZyA9IG51bGw7CgogICAgICAgIHZh
bHVlID0gc3RyaW5nOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nW10p
IHsKICAgICAgICBTdHJpbmdbXSBhcnJheSA9IChTdHJpbmdbXSl2YWx1ZTsKICAgICAgICBmb3Ig
KGludCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoYXJyYXlb
aV0gIT0gbnVsbCkgewogICAgICAgICAgICBhcnJheVtpXSA9IGFycmF5W2ldLnRyaW0oKTsKICAg
ICAgICAgICAgaWYgKGFycmF5W2ldLmVxdWFscygiIikpIGFycmF5W2ldID0gbnVsbDsKICAgICAg
ICAgIH0KICAgICAgICB9CgogICAgICAgIHZhbHVlID0gYXJyYXk7CiAgICAgIH0gZWxzZSBpZiAo
dmFsdWUgaW5zdGFuY2VvZiBTdHJpbmdbXVtdKSB7CiAgICAgICAgU3RyaW5nW11bXSBhcnJheSA9
IChTdHJpbmdbXVtdKXZhbHVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyYXkubGVu
Z3RoOyBpKyspIHsKICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYXJyYXlbaV0ubGVuZ3Ro
OyBqKyspIHsKICAgICAgICAgICAgaWYgKGFycmF5W2ldW2pdICE9IG51bGwpIHsKICAgICAgICAg
ICAgICBhcnJheVtpXVtqXSA9IGFycmF5W2ldW2pdLnRyaW0oKTsKICAgICAgICAgICAgICBpZiAo
YXJyYXlbaV1bal0uZXF1YWxzKCIiKSkgYXJyYXlbaV1bal0gPSBudWxsOwogICAgICAgICAgICB9
CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YWx1ZSA9IGFycmF5OwogICAgICB9IGVs
c2UgaWYgKHJlY3Vyc2UgJiYgdmFsdWUgaW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAgIHZhbHVl
ID0gc3F1ZWV6ZSgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICB9IGVsc2UgaWYgKHJlY3Vy
c2UgJiYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSB8fCB2YWx1ZSBpbnN0YW5jZW9mIGNvbS53
bS51dGlsLlRhYmxlKSkgewogICAgICAgIElEYXRhW10gYXJyYXkgPSB2YWx1ZSBpbnN0YW5jZW9m
IElEYXRhW10gPyAoSURhdGFbXSl2YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdl
dFZhbHVlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKysp
IHsKICAgICAgICAgIGFycmF5W2ldID0gc3F1ZWV6ZShhcnJheVtpXSwgcmVjdXJzZSk7CiAgICAg
ICAgfQoKICAgICAgICB2YWx1ZSA9IGFycmF5OwogICAgICB9CgogICAgICBvYy5pbnNlcnRBZnRl
cihrZXksIHZhbHVlKTsKICAgIH0KICB9CgogIGljLmRlc3Ryb3koKTsKICBvYy5kZXN0cm95KCk7
CgogIHJldHVybiBjb21wYWN0KG91dHB1dCwgcmVjdXJzZSk7Cn0KCi8vIHJldHVybnMgdGhlIG51
bWJlciBvZiB0b3AtbGV2ZWwge2tleSwgdmFsdWV9IHBhaXJzIGluIHRoZSBnaXZlbiBJRGF0YSBk
b2N1bWVudApwdWJsaWMgc3RhdGljIGludCBzaXplKElEYXRhIGlucHV0KSB7CiAgaW50IHNpemUg
PSAwOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1
dC5nZXRDdXJzb3IoKTsKICAgIHNpemUgPSBJRGF0YVV0aWwuc2l6ZShjdXJzb3IpOwogICAgY3Vy
c29yLmRlc3Ryb3koKTsKICB9CiAgcmV0dXJuIHNpemU7Cn0KCi8vIHJldHVybnMgYSBjbG9uZSBv
ZiB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBkdXBsaWNhdGUo
SURhdGEgaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRpb24gewog
IElEYXRhIG91dHB1dCA9IG51bGw7CiAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgIElEYXRhQ3Vy
c29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgdHJ5IHsKICAgICAgaWYgKHJlY3Vy
c2UpIHsKICAgICAgICBvdXRwdXQgPSBJRGF0YVV0aWwuZGVlcENsb25lKGlucHV0KTsKICAgICAg
fSBlbHNlIHsKICAgICAgICBvdXRwdXQgPSBJRGF0YVV0aWwuY2xvbmUoaW5wdXQpOwogICAgICB9
CiAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGV4KSB7CiAgICAgIHR1bmRyYS5leGNl
cHRpb24ucmFpc2UoZXgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgY3Vyc29yLmRlc3Ryb3koKTsK
ICAgIH0KICB9CiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gcmVtb3ZlcyB0aGUgdmFsdWUgd2l0aCB0
aGUgZ2l2ZW4ga2V5IGZyb20gdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMg
SURhdGEgZHJvcChJRGF0YSBpbnB1dCwgU3RyaW5nIGtleSkgewogIGlmIChpbnB1dCAhPSBudWxs
ICYmIGtleSAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJz
b3IoKTsKICAgIElEYXRhVXRpbC5yZW1vdmUoY3Vyc29yLCBrZXkpOwogICAgY3Vyc29yLmRlc3Ry
b3koKTsKCiAgICBpZiAodHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQuS2V5LmlzRnVsbHlRdWFsaWZp
ZWQoa2V5KSkgZHJvcChpbnB1dCwgdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQuS2V5LnBhcnNlKGtl
eSkpOwogIH0KICByZXR1cm4gaW5wdXQ7Cn0KCi8vIHJlbW92ZXMgdGhlIHZhbHVlIHdpdGggdGhl
IGdpdmVuIGtleSBmcm9tIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwcm90ZWN0ZWQgc3RhdGlj
IElEYXRhIGRyb3AoSURhdGEgaW5wdXQsIGphdmEudXRpbC5RdWV1ZTx0dW5kcmEuc3VwcG9ydC5k
b2N1bWVudC5LZXk+IGtleXMpIHsKICBpZiAoaW5wdXQgIT0gbnVsbCAmJiBrZXlzICE9IG51bGwg
JiYga2V5cy5zaXplKCkgPiAwKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRD
dXJzb3IoKTsKICAgIHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LktleSBrZXkgPSBrZXlzLnJlbW92
ZSgpOwoKICAgIGlmIChrZXlzLnNpemUoKSA+IDApIHsKICAgICAgaWYgKGtleS5oYXNJbmRleCgp
KSB7CiAgICAgICAgSURhdGFbXSBhcnJheSA9IElEYXRhVXRpbC5nZXRJRGF0YUFycmF5KGN1cnNv
ciwga2V5LnRvU3RyaW5nKCkpOwogICAgICAgIGRyb3AodHVuZHJhLmxpc3Qub2JqZWN0LmdldChh
cnJheSwga2V5LmdldEluZGV4KCkpLCBrZXlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkcm9w
KElEYXRhVXRpbC5nZXRJRGF0YShjdXJzb3IsIGtleS50b1N0cmluZygpKSwga2V5cyk7CiAgICAg
IH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChrZXkuaGFzSW5kZXgoKSkgewogICAgICAgIE9iamVj
dFtdIGFycmF5ID0gSURhdGFVdGlsLmdldE9iamVjdEFycmF5KGN1cnNvciwga2V5LnRvU3RyaW5n
KCkpOwogICAgICAgIElEYXRhVXRpbC5wdXQoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSwgdHVuZHJh
Lmxpc3Qub2JqZWN0LmRyb3AoYXJyYXksIGtleS5nZXRJbmRleCgpKSk7CiAgICAgIH0gZWxzZSB7
CiAgICAgICAgSURhdGFVdGlsLnJlbW92ZShjdXJzb3IsIGtleS50b1N0cmluZygpKTsKICAgICAg
fQogICAgfQogICAgY3Vyc29yLmRlc3Ryb3koKTsKICB9CiAgcmV0dXJuIGlucHV0Owp9CgovLyB2
aXNpdHMgZWFjaCBlbGVtZW50IGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCwgY2FsbHMgdGhl
IGdpdmVuIHNlcnZpY2UgdG8gY29udmVydCB0aGUgZWxlbWVudCwgYW5kIGNyZWF0ZXMgYSBuZXcg
SURhdGEgZG9jdW1lbnQgd2l0aCB0aGUgcmVzdWx0aW5nIGVsZW1lbnRzCnB1YmxpYyBzdGF0aWMg
SURhdGEgbWFwKElEYXRhIGlucHV0LCBTdHJpbmcgc2VydmljZSwgSURhdGEgcGlwZWxpbmUsIFN0
cmluZyBrZXlJbnB1dCwgU3RyaW5nIGtleU91dHB1dCwgU3RyaW5nIHZhbHVlSW5wdXQsIFN0cmlu
ZyB2YWx1ZU91dHB1dCwgQ2xhc3MgdmFsdWVDbGFzcywgYm9vbGVhbiByZWN1cnNlKSB0aHJvd3Mg
U2VydmljZUV4Y2VwdGlvbiB7CiAgSURhdGEgb3V0cHV0ID0gbnVsbDsKCiAgaWYgKGlucHV0ICE9
IG51bGwgJiYgc2VydmljZSAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBpYyA9IGlucHV0Lmdl
dEN1cnNvcigpOwogICAgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogICAgSURhdGFD
dXJzb3Igb2MgPSBvdXRwdXQuZ2V0Q3Vyc29yKCk7CgogICAgaWYgKGtleUlucHV0ID09IG51bGwp
IGtleUlucHV0ID0gIiRrZXkiOwogICAgaWYgKGtleU91dHB1dCA9PSBudWxsKSBrZXlPdXRwdXQg
PSBrZXlJbnB1dDsKICAgIGlmICh2YWx1ZUlucHV0ID09IG51bGwpIHZhbHVlSW5wdXQgPSAiJHZh
bHVlIjsKICAgIGlmICh2YWx1ZU91dHB1dCA9PSBudWxsKSB2YWx1ZU91dHB1dCA9IHZhbHVlSW5w
dXQ7CiAgICBpZiAocGlwZWxpbmUgPT0gbnVsbCkgcGlwZWxpbmUgPSBJRGF0YUZhY3RvcnkuY3Jl
YXRlKCk7CgogICAgdHJ5IHsKICAgICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAgICAgVHVwbGU8
T2JqZWN0PiB0dXBsZSA9IG5ldyBUdXBsZTxPYmplY3Q+KGljLmdldEtleSgpLCBpYy5nZXRWYWx1
ZSgpKTsKCiAgICAgICAgaWYgKHJlY3Vyc2UgJiYgdHVwbGUudmFsdWUgIT0gbnVsbCkgewogICAg
ICAgICAgaWYgKHR1cGxlLnZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgICAgdHVw
bGUudmFsdWUgPSBtYXAoKElEYXRhKXR1cGxlLnZhbHVlLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5
SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MsIHJl
Y3Vyc2UpOwogICAgICAgICAgfSBlbHNlIGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIElEYXRh
W10gfHwgdHVwbGUudmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAg
ICAgICBJRGF0YVtdIGlhcnkgPSB0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURh
dGFbXSl0dXBsZS52YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdHVwbGUudmFsdWUpLmdldFZh
bHVlcygpOwogICAgICAgICAgICBJRGF0YVtdIG9hcnkgPSBuZXcgSURhdGFbaWFyeS5sZW5ndGhd
OwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlhcnkubGVuZ3RoOyBpKyspIHsKICAg
ICAgICAgICAgICBvYXJ5W2ldID0gbWFwKGlhcnlbaV0sIHNlcnZpY2UsIHBpcGVsaW5lLCBrZXlJ
bnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91dHB1dCwgdmFsdWVDbGFzcywgcmVj
dXJzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHVwbGUudmFsdWUgPSBvYXJ5OwogICAg
ICAgICAgfSBlbHNlIGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdW10pIHsKICAg
ICAgICAgICAgU3RyaW5nW11bXSBpYXJ5ID0gKFN0cmluZ1tdW10pdHVwbGUudmFsdWU7CiAgICAg
ICAgICAgIFN0cmluZ1tdW10gb2FyeSA9IG5ldyBTdHJpbmdbaWFyeS5sZW5ndGhdW107CiAgICAg
ICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAgICAg
ICAgIGlmIChpYXJ5W2ldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9hcnlbaV0gPSBuZXcg
U3RyaW5nW2lhcnlbaV0ubGVuZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq
IDwgaWFyeVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICBUdXBsZTxTdHJpbmc+
IHQgPSBtYXAobmV3IFR1cGxlPFN0cmluZz4odHVwbGUua2V5LCBpYXJ5W2ldW2pdKSwgc2Vydmlj
ZSwgcGlwZWxpbmUsIGtleUlucHV0LCBrZXlPdXRwdXQsIHZhbHVlSW5wdXQsIHZhbHVlT3V0cHV0
LCB2YWx1ZUNsYXNzKTsKICAgICAgICAgICAgICAgICAgb2FyeVtpXVtqXSA9IHQudmFsdWU7CiAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg
IHR1cGxlLnZhbHVlID0gb2FyeTsKICAgICAgICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5z
dGFuY2VvZiBTdHJpbmdbXSkgewogICAgICAgICAgICBTdHJpbmdbXSBpYXJ5ID0gKFN0cmluZ1td
KXR1cGxlLnZhbHVlOwogICAgICAgICAgICBTdHJpbmdbXSBvYXJ5ID0gbmV3IFN0cmluZ1tpYXJ5
Lmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkr
KykgewogICAgICAgICAgICAgIFR1cGxlPFN0cmluZz4gdCA9IG1hcChuZXcgVHVwbGU8U3RyaW5n
Pih0dXBsZS5rZXksIGlhcnlbaV0pLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91
dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MpOwogICAgICAgICAgICAg
IG9hcnlbaV0gPSB0LnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVl
ID0gb2FyeTsKICAgICAgICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5zdGFuY2VvZiBPYmpl
Y3RbXSkgewogICAgICAgICAgICBPYmplY3RbXSBpYXJ5ID0gKE9iamVjdFtdKXR1cGxlLnZhbHVl
OwogICAgICAgICAgICBPYmplY3RbXSBvYXJ5ID0gbmV3IE9iamVjdFtpYXJ5Lmxlbmd0aF07CiAg
ICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAg
ICAgICAgIFR1cGxlPE9iamVjdD4gdCA9IG1hcChuZXcgVHVwbGU8T2JqZWN0Pih0dXBsZS5rZXks
IGlhcnlbaV0pLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJ
bnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MpOwogICAgICAgICAgICAgIG9hcnlbaV0gPSB0
LnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVlID0gb2FyeTsKICAg
ICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdHVwbGUgPSBtYXAodHVwbGUsIHNlcnZpY2UsIHBp
cGVsaW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91dHB1dCwgdmFs
dWVDbGFzcyk7CiAgICAgICAgSURhdGFVdGlsLnB1dChvYywgdHVwbGUua2V5LCB0dXBsZS52YWx1
ZSk7CiAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgIGljLmRlc3Ryb3koKTsKICAgICAgb2Mu
ZGVzdHJveSgpOwogICAgfQogIH0gZWxzZSB7CiAgICBvdXRwdXQgPSBkdXBsaWNhdGUoaW5wdXQs
IHJlY3Vyc2UpOwogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gd3JhcHBlciBjbGFzcyBmb3Ig
e2tleSwgdmFsdWV9IHR1cGxlcwpwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFR1cGxlPFQ+IHsgCiAg
cHVibGljIFN0cmluZyBrZXk7CiAgcHVibGljIFQgdmFsdWU7CiAgcHVibGljIFR1cGxlKFN0cmlu
ZyBrZXksIFQgdmFsdWUpIHsgCiAgICB0aGlzLmtleSA9IGtleTsgCiAgICB0aGlzLnZhbHVlID0g
dmFsdWU7IAogIH0KfQoKLy8gY29udmVydHMgdGhlIGdpdmVuIGVsZW1lbnQgYnkgY2FsbGluZyB0
aGUgZ2l2ZW4gc2VydmljZSwgYW5kIHJldHVybnMgdGhlIHJlc3VsdApwcm90ZWN0ZWQgc3RhdGlj
IDxUPiBUdXBsZTxUPiBtYXAoVHVwbGU8VD4gdHVwbGUsIFN0cmluZyBzZXJ2aWNlLCBJRGF0YSBw
aXBlbGluZSwgU3RyaW5nIGtleUlucHV0LCBTdHJpbmcga2V5T3V0cHV0LCBTdHJpbmcgdmFsdWVJ
bnB1dCwgU3RyaW5nIHZhbHVlT3V0cHV0LCBDbGFzcyB2YWx1ZUNsYXNzKSB0aHJvd3MgU2Vydmlj
ZUV4Y2VwdGlvbiB7CiAgaWYgKHR1cGxlLnZhbHVlID09IG51bGwgfHwgdmFsdWVDbGFzcyA9PSBu
dWxsIHx8IHZhbHVlQ2xhc3MuaXNJbnN0YW5jZSh0dXBsZS52YWx1ZSkpIHsKICAgIElEYXRhQ3Vy
c29yIGN1cnNvciA9IHBpcGVsaW5lLmdldEN1cnNvcigpOwogICAgSURhdGFVdGlsLnB1dChjdXJz
b3IsIGtleUlucHV0LCB0dXBsZS5rZXkpOwogICAgSURhdGFVdGlsLnB1dChjdXJzb3IsIHZhbHVl
SW5wdXQsIHR1cGxlLnZhbHVlKTsKICAgIGN1cnNvci5kZXN0cm95KCk7CgogICAgcGlwZWxpbmUg
PSB0dW5kcmEuc2VydmljZS5pbnZva2Uoc2VydmljZSwgcGlwZWxpbmUpOwoKICAgIC8vIGNsZWFu
IHVwIHRoZSBpbnB1dCBwaXBlbGluZQogICAgY3Vyc29yID0gcGlwZWxpbmUuZ2V0Q3Vyc29yKCk7
CiAgICB0dXBsZS5rZXkgPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwga2V5T3V0cHV0KTsK
ICAgIHR1cGxlLnZhbHVlID0gKFQpSURhdGFVdGlsLmdldChjdXJzb3IsIHZhbHVlT3V0cHV0KTsK
ICAgIElEYXRhVXRpbC5yZW1vdmUoY3Vyc29yLCBrZXlJbnB1dCk7CiAgICBpZiAoIWtleUlucHV0
LmVxdWFscyhrZXlPdXRwdXQpKSBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwga2V5T3V0cHV0KTsK
ICAgIElEYXRhVXRpbC5yZW1vdmUoY3Vyc29yLCB2YWx1ZUlucHV0KTsKICAgIGlmICghdmFsdWVJ
bnB1dC5lcXVhbHModmFsdWVPdXRwdXQpKSBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwgdmFsdWVP
dXRwdXQpOwogICAgY3Vyc29yLmRlc3Ryb3koKTsKICB9ICAKICByZXR1cm4gdHVwbGU7Cn0KCi8v
IGludm9rZXMgdGhlIGdpdmVuIHNlcnZpY2UgZm9yIGVhY2gge2tleSwgdmFsdWV9IHBhaXIgaW4g
dGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgdm9pZCBlYWNoKElEYXRhIGlu
cHV0LCBTdHJpbmcgc2VydmljZSwgSURhdGEgcGlwZWxpbmUsIFN0cmluZyBrZXlJbnB1dCwgU3Ry
aW5nIHZhbHVlSW5wdXQsIENsYXNzIHZhbHVlQ2xhc3MsIGJvb2xlYW4gcmVjdXJzZSkgdGhyb3dz
IFNlcnZpY2VFeGNlcHRpb24gewogIG1hcChpbnB1dCwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlu
cHV0LCBudWxsLCB2YWx1ZUlucHV0LCBudWxsLCB2YWx1ZUNsYXNzLCByZWN1cnNlKTsKfQoKLy8g
cmVuYW1lcyBhIGtleSBmcm9tIHNvdXJjZSB0byB0YXJnZXQgd2l0aGluIHRoZSBnaXZlbiBJRGF0
YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIHJlbmFtZShJRGF0YSBpbnB1dCwgU3RyaW5n
IHNvdXJjZSwgU3RyaW5nIHRhcmdldCkgewogIGlmICghc291cmNlLmVxdWFscyh0YXJnZXQpKSBp
bnB1dCA9IGRyb3AoY29weShpbnB1dCwgc291cmNlLCB0YXJnZXQpLCBzb3VyY2UpOwogIHJldHVy
biBpbnB1dDsKfQoKLy8gY29waWVzIGEgdmFsdWUgZnJvbSBzb3VyY2Uga2V5IHRvIHRhcmdldCBr
ZXkgd2l0aGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIGNv
cHkoSURhdGEgaW5wdXQsIFN0cmluZyBzb3VyY2UsIFN0cmluZyB0YXJnZXQpIHsKICBpZiAoc291
cmNlLmVxdWFscyh0YXJnZXQpKSByZXR1cm4gaW5wdXQ7CiAgcmV0dXJuIHR1bmRyYS5zdXBwb3J0
LmRvY3VtZW50LnB1dChpbnB1dCwgdGFyZ2V0LCB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5nZXQo
aW5wdXQsIHNvdXJjZSkpOwp9CgovLyByZW1vdmVzIGFsbCBudWxsIHZhbHVlcyBmcm9tIHRoZSBn
aXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIGNvbXBhY3QoSURhdGEgaW5w
dXQsIGJvb2xlYW4gcmVjdXJzZSkgewogIElEYXRhIG91dHB1dCA9IG51bGw7CgogIGlmIChpbnB1
dCAhPSBudWxsKSB7CiAgICBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgICBJRGF0
YUN1cnNvciBpYyA9IGlucHV0LmdldEN1cnNvcigpOwogICAgSURhdGFDdXJzb3Igb2MgPSBvdXRw
dXQuZ2V0Q3Vyc29yKCk7CgogICAgdHJ5IHsKICAgICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAg
ICAgU3RyaW5nIGtleSA9IGljLmdldEtleSgpOwogICAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdl
dFZhbHVlKCk7CgogICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAocmVj
dXJzZSkgewogICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAg
ICAgICAgIHZhbHVlID0gY29tcGFjdCgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgICAg
ICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSkgewogICAgICAgICAgICAgIElE
YXRhW10gYXJyYXkgPSB0dW5kcmEubGlzdC5vYmplY3QuY29tcGFjdCgoSURhdGFbXSl2YWx1ZSk7
CiAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgewog
ICAgICAgICAgICAgICAgYXJyYXlbaV0gPSBjb21wYWN0KGFycmF5W2ldLCByZWN1cnNlKTsKICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFsdWUgPSBhcnJheTsKICAgICAgICAgICAgfSBl
bHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdW10pIHsKICAgICAgICAgICAgICBTdHJp
bmdbXVtdIGFycmF5ID0gKFN0cmluZ1tdW10pdmFsdWU7CiAgICAgICAgICAgICAgZm9yIChpbnQg
aSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgYXJyYXlbaV0g
PSB0dW5kcmEubGlzdC5vYmplY3QuY29tcGFjdChhcnJheVtpXSk7CiAgICAgICAgICAgICAgfQog
ICAgICAgICAgICAgIHZhbHVlID0gYXJyYXk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUg
aW5zdGFuY2VvZiBTdHJpbmdbXSkgewogICAgICAgICAgICAgIHZhbHVlID0gdHVuZHJhLmxpc3Qu
b2JqZWN0LmNvbXBhY3QoKFN0cmluZ1tdKXZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2
YWx1ZSBpbnN0YW5jZW9mIE9iamVjdFtdKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0dW5kcmEu
bGlzdC5vYmplY3QuY29tcGFjdCgoT2JqZWN0W10pdmFsdWUpOwogICAgICAgICAgICB9CiAgICAg
ICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgSURhdGFVdGlsLnB1
dChvYywga2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgIGljLmRlc3Ry
b3koKTsKICAgICAgb2MuZGVzdHJveSgpOwogICAgfQogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQoK
Ly8gcmV0dXJucyBhIG5ldyBJRGF0YSBkb2N1bWVudCwgd2hlcmUgYWxsIElEYXRhcyBhcmUgaW1w
bGVtZW50ZWQgd2l0aCB0aGUgc2FtZSBjbGFzcywgYW5kIGFsbAovLyBmdWxseSBxdWFsaWZpZWQg
a2V5cyBhcmUgcmVwbGFjZWQgd2l0aCBhIG5lc3RlZCBzdHJ1Y3R1cmUKcHVibGljIHN0YXRpYyBJ
RGF0YSBub3JtYWxpemUoSURhdGEgaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgewogIGlmIChpbnB1
dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgSURhdGEgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNy
ZWF0ZSgpOwogIElEYXRhQ3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CgogIHRyeSB7CiAg
ICB3aGlsZShpYy5uZXh0KCkpIHsKICAgICAgU3RyaW5nIGtleSA9IGljLmdldEtleSgpOwogICAg
ICBPYmplY3QgdmFsdWUgPSBpYy5nZXRWYWx1ZSgpOwoKICAgICAgaWYgKHZhbHVlICE9IG51bGwp
IHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5jb2Rlci5JRGF0YUNv
ZGFibGUpIHsKICAgICAgICAgIHZhbHVlID0gKChjb20ud20udXRpbC5jb2Rlci5JRGF0YUNvZGFi
bGUpdmFsdWUpLmdldElEYXRhKCk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9m
IGNvbS53bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGUpIHsKICAgICAgICAgIHZhbHVlID0gKChj
b20ud20udXRpbC5jb2Rlci5WYWx1ZXNDb2RhYmxlKXZhbHVlKS5nZXRWYWx1ZXMoKTsKICAgICAg
ICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuY29kZXIuSURhdGFDb2Rh
YmxlW10pIHsKICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXplKChjb20ud20udXRpbC5jb2Rlci5J
RGF0YUNvZGFibGVbXSl2YWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBp
bnN0YW5jZW9mIGNvbS53bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGVbXSkgewogICAgICAgICAg
dmFsdWUgPSBub3JtYWxpemUoKGNvbS53bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGVbXSl2YWx1
ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10p
IHsKICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXplKChJRGF0YVtdKXZhbHVlLCByZWN1cnNlKTsK
ICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFibGUpIHsK
ICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXplKCgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdl
dFZhbHVlcygpLCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHJlY3Vyc2UgJiYgdmFsdWUg
aW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxpemUoKElEYXRhKXZh
bHVlLCByZWN1cnNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdHVuZHJhLnN1cHBvcnQuZG9j
dW1lbnQucHV0KG91dHB1dCwga2V5LCB2YWx1ZSk7CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIGlj
LmRlc3Ryb3koKTsKICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIG5vcm1hbGl6ZXMgYW4gSURh
dGFbXSwgd2hlcmUgYWxsIElEYXRhcyBhcmUgaW1wbGVtZW50ZWQgd2l0aCB0aGUgc2FtZSBjbGFz
cywgYW5kIGFsbAovLyBmdWxseSBxdWFsaWZpZWQga2V5cyBhcmUgcmVwbGFjZWQgd2l0aCBhIG5l
c3RlZCBzdHJ1Y3R1cmUKcHJvdGVjdGVkIHN0YXRpYyBJRGF0YVtdIG5vcm1hbGl6ZShJRGF0YVtd
IGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51
bGw7CgogIElEYXRhW10gb3V0cHV0ID0gbmV3IElEYXRhW2lucHV0Lmxlbmd0aF07CiAgZm9yIChp
bnQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgb3V0cHV0W2ldID0gbm9ybWFs
aXplKGlucHV0W2ldLCByZWN1cnNlKTsKICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIGNvbnZl
cnRzIGFuIElEYXRhQ29kYWJsZVtdIHRvIGFuIElEYXRhW10gYW5kIG5vcm1hbGl6ZXMsIHdoZXJl
IGFsbCBJRGF0YXMgYXJlIGltcGxlbWVudGVkIAovLyB3aXRoIHRoZSBzYW1lIGNsYXNzLCBhbmQg
YWxsIGZ1bGx5IHF1YWxpZmllZCBrZXlzIGFyZSByZXBsYWNlZCB3aXRoIGEgbmVzdGVkIHN0cnVj
dHVyZQpwcm90ZWN0ZWQgc3RhdGljIElEYXRhW10gbm9ybWFsaXplKGNvbS53bS51dGlsLmNvZGVy
LklEYXRhQ29kYWJsZVtdIGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0g
bnVsbCkgcmV0dXJuIG51bGw7CgogIElEYXRhW10gb3V0cHV0ID0gbmV3IElEYXRhW2lucHV0Lmxl
bmd0aF07CiAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgb3V0
cHV0W2ldID0gbm9ybWFsaXplKGlucHV0W2ldLmdldElEYXRhKCksIHJlY3Vyc2UpOwogIH0KICAK
ICByZXR1cm4gb3V0cHV0Owp9CgovLyBjb252ZXJ0cyBhIFZhbHVlc0NvZGFibGVbXSB0byBhbiBJ
RGF0YVtdIGFuZCBub3JtYWxpemVzLCB3aGVyZSBhbGwgSURhdGFzIGFyZSBpbXBsZW1lbnRlZCAK
Ly8gd2l0aCB0aGUgc2FtZSBjbGFzcywgYW5kIGFsbCBmdWxseSBxdWFsaWZpZWQga2V5cyBhcmUg
cmVwbGFjZWQgd2l0aCBhIG5lc3RlZCBzdHJ1Y3R1cmUKcHJvdGVjdGVkIHN0YXRpYyBJRGF0YVtd
IG5vcm1hbGl6ZShjb20ud20udXRpbC5jb2Rlci5WYWx1ZXNDb2RhYmxlW10gaW5wdXQsIGJvb2xl
YW4gcmVjdXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgSURhdGFb
XSBvdXRwdXQgPSBuZXcgSURhdGFbaW5wdXQubGVuZ3RoXTsKICBmb3IgKGludCBpID0gMDsgaSA8
IGlucHV0Lmxlbmd0aDsgaSsrKSB7CiAgICBvdXRwdXRbaV0gPSBub3JtYWxpemUoaW5wdXRbaV0u
Z2V0VmFsdWVzKCksIHJlY3Vyc2UpOwogIH0KICAKICByZXR1cm4gb3V0cHV0Owp9CgovLyByZW1v
dmVzIGFsbCBrZXlzIGV4Y2VwdCB0aG9zZSBzcGVjaWZpZWQgZnJvbSB0aGUgZ2l2ZW4gSURhdGEg
ZG9jdW1lbnQKcHVibGljIHN0YXRpYyB2b2lkIGNsZWFyKElEYXRhIGRvY3VtZW50LCBTdHJpbmdb
XSBrZXlzKSB7CiAgaWYgKGRvY3VtZW50ID09IG51bGwpIHJldHVybjsKCiAgSURhdGEgc2F2ZWQg
PSBudWxsOwogIGlmIChrZXlzICE9IG51bGwpIHsKICAgIHNhdmVkID0gSURhdGFGYWN0b3J5LmNy
ZWF0ZSgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAg
IE9iamVjdCB2YWx1ZSA9IHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LmdldChkb2N1bWVudCwga2V5
c1tpXSk7CiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5w
dXQoc2F2ZWQsIGtleXNbaV0sIHZhbHVlKTsKICAgIH0KICB9CgogIElEYXRhQ3Vyc29yIGN1cnNv
ciA9IGRvY3VtZW50LmdldEN1cnNvcigpOwogIGN1cnNvci5maXJzdCgpOwogIHdoaWxlKGN1cnNv
ci5kZWxldGUoKSk7CiAgY3Vyc29yLmRlc3Ryb3koKTsKCiAgaWYgKGtleXMgIT0gbnVsbCkgSURh
dGFVdGlsLm1lcmdlKHNhdmVkLCBkb2N1bWVudCk7Cn0KCi8vIHBlcmZvcm1zIHZhcmlhYmxlIHN1
YnN0aXR1dGlvbiBvbiBhbGwgZWxlbWVudHMgb2YgdGhlIGdpdmVuIElEYXRhIGlucHV0IGRvY3Vt
ZW50CnB1YmxpYyBzdGF0aWMgSURhdGEgc3Vic3RpdHV0ZShJRGF0YSBpbnB1dCwgSURhdGEgc2Nv
cGUsIGJvb2xlYW4gcmVjdXJzZSkgewogIHJldHVybiBzdWJzdGl0dXRlKGlucHV0LCBzY29wZSwg
bnVsbCwgcmVjdXJzZSk7Cn0KCi8vIHBlcmZvcm1zIHZhcmlhYmxlIHN1YnN0aXR1dGlvbiBvbiBh
bGwgZWxlbWVudHMgb2YgdGhlIGdpdmVuIElEYXRhIGlucHV0IGRvY3VtZW50CnB1YmxpYyBzdGF0
aWMgSURhdGEgc3Vic3RpdHV0ZShJRGF0YSBpbnB1dCwgSURhdGEgc2NvcGUsIFN0cmluZyBkZWZh
dWx0VmFsdWUsIGJvb2xlYW4gcmVjdXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4g
bnVsbDsKICBpZiAoc2NvcGUgPT0gbnVsbCkgc2NvcGUgPSBpbnB1dDsKCiAgSURhdGEgb3V0cHV0
ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwoKICBJRGF0YUN1cnNvciBpYyA9IGlucHV0LmdldEN1
cnNvcigpOwogIElEYXRhQ3Vyc29yIG9jID0gb3V0cHV0LmdldEN1cnNvcigpOwoKICB0cnkgewog
ICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAgIFN0cmluZyBrZXkgPSBpYy5nZXRLZXkoKTsKICAg
ICAgT2JqZWN0IHZhbHVlID0gaWMuZ2V0VmFsdWUoKTsKICAgICAgaWYgKHZhbHVlICE9IG51bGwp
IHsKICAgICAgICBpZiAocmVjdXJzZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIElEYXRhKSB7CiAgICAg
ICAgICB2YWx1ZSA9IHN1YnN0aXR1dGUoKElEYXRhKXZhbHVlLCBzY29wZSwgZGVmYXVsdFZhbHVl
LCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHJlY3Vyc2UgJiYgKHZhbHVlIGluc3RhbmNl
b2YgSURhdGFbXSB8fCB2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLlRhYmxlKSkgewogICAg
ICAgICAgSURhdGFbXSBpYXJ5ID0gdmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtdID8gKElEYXRhW10p
dmFsdWUgOiAoKGNvbS53bS51dGlsLlRhYmxlKXZhbHVlKS5nZXRWYWx1ZXMoKTsKICAgICAgICAg
IElEYXRhW10gb2FyeSA9IG5ldyBJRGF0YVtpYXJ5Lmxlbmd0aF07CiAgICAgICAgICBmb3IgKGlu
dCBpID0gMDsgaSA8IGlhcnkubGVuZ3RoOyBpKyspIG9hcnlbaV0gPSBzdWJzdGl0dXRlKGlhcnlb
aV0sIHNjb3BlLCBkZWZhdWx0VmFsdWUsIHJlY3Vyc2UpOwogICAgICAgICAgdmFsdWUgPSBvYXJ5
OwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAg
IHZhbHVlID0gdHVuZHJhLnN0cmluZy5zdWJzdGl0dXRlKChTdHJpbmcpdmFsdWUsIHNjb3BlLCBk
ZWZhdWx0VmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmdb
XSkgewogICAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlzdC5zdHJpbmcuc3Vic3RpdHV0ZSgoU3Ry
aW5nW10pdmFsdWUsIHNjb3BlLCBkZWZhdWx0VmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAodmFs
dWUgaW5zdGFuY2VvZiBTdHJpbmdbXVtdKSB7CiAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0
LnN0cmluZy5zdWJzdGl0dXRlKChTdHJpbmdbXVtdKXZhbHVlLCBzY29wZSwgZGVmYXVsdFZhbHVl
KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgSURhdGFVdGlsLnB1dChvYywga2V5LCB2YWx1ZSk7
CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIGljLmRlc3Ryb3koKTsKICAgIG9jLmRlc3Ryb3koKTsK
ICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIHBhcnNlcyBhbiBJRGF0YSBYTUwgaW5wdXQgc3Ry
ZWFtIHRvIGFuIElEYXRhIG9iamVjdApwdWJsaWMgc3RhdGljIElEYXRhIHBhcnNlKGphdmEuaW8u
SW5wdXRTdHJlYW0gaW4pIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICBjb20ud20udXRp
bC5jb2Rlci5YTUxDb2RlcldyYXBwZXIgY29kZWMgPSBuZXcgY29tLndtLnV0aWwuY29kZXIuWE1M
Q29kZXJXcmFwcGVyKCk7CiAgcmV0dXJuIGNvZGVjLmRlY29kZShpbik7Cn0KCi8vIHBhcnNlcyBh
biBJRGF0YSBYTUwgc3RyaW5nLCBieXRlIGFycmF5IG9yIGlucHV0IHN0cmVhbSB0byBhbiBJRGF0
YSBvYmplY3QKcHVibGljIHN0YXRpYyBJRGF0YSBwYXJzZShPYmplY3QgY29udGVudCwgU3RyaW5n
IGVuY29kaW5nKSB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgcmV0dXJuIHBhcnNlKChq
YXZhLmlvLklucHV0U3RyZWFtKXR1bmRyYS5vYmplY3QuY29udmVydChjb250ZW50LCBlbmNvZGlu
ZywgInN0cmVhbSIpKTsKfQoKLy8gZW1pdHMgYW4gSURhdGEgb2JqZWN0IGFzIGEgYW4gSURhdGEg
WE1MIHN0cmluZywgYnl0ZSBhcnJheSBvciBzdHJlYW0KcHVibGljIHN0YXRpYyBPYmplY3QgZW1p
dChJRGF0YSBkb2N1bWVudCwgU3RyaW5nIGVuY29kaW5nLCBTdHJpbmcgbW9kZSkgdGhyb3dzIGph
dmEuaW8uSU9FeGNlcHRpb24gewogIGNvbS53bS51dGlsLmNvZGVyLklEYXRhWE1MQ29kZXIgY29k
ZWMgPSBudWxsOwogIGlmIChlbmNvZGluZyA9PSBudWxsKSB7CiAgICBjb2RlYyA9IG5ldyBjb20u
d20udXRpbC5jb2Rlci5JRGF0YVhNTENvZGVyKCk7CiAgfSBlbHNlIHsKICAgIGNvZGVjID0gbmV3
IGNvbS53bS51dGlsLmNvZGVyLklEYXRhWE1MQ29kZXIoZW5jb2RpbmcpOwogIH0KCiAgamF2YS5p
by5CeXRlQXJyYXlPdXRwdXRTdHJlYW0gb3V0ID0gbmV3IGphdmEuaW8uQnl0ZUFycmF5T3V0cHV0
U3RyZWFtKCk7CiAgY29kZWMuZW5jb2RlKG91dCwgZG9jdW1lbnQpOwoKICByZXR1cm4gdHVuZHJh
Lm9iamVjdC5jb252ZXJ0KG91dC50b0J5dGVBcnJheSgpLCBlbmNvZGluZywgbW9kZSk7Cn0=</value>
  <value name="extends"></value>
  <array name="implements" type="value" depth="1">
  </array>
  <array name="imports" type="value" depth="1">
  </array>
</Values>
