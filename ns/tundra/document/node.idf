<?xml version="1.0" encoding="UTF-8"?>

<Values version="2.0">
  <value name="node_type">interface</value>
  <value name="node_nsName">tundra.document</value>
  <value name="encodeutf8">true</value>
  <value name="shared">Ly8gYW1lbmRzIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCB3aXRoIHRoZSB7a2V5LHZhbHVlfSBw
YWlycyBzcGVjaWZpZWQgaW4gdGhlCi8vIGFtZW5kbWVudHMgSURhdGEKcHVibGljIHN0YXRpYyBJ
RGF0YSBhbWVuZChJRGF0YSBkb2N1bWVudCwgSURhdGFbXSBhbWVuZG1lbnRzLCBJRGF0YSBzY29w
ZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRpb24gewogIGlmIChhbWVuZG1lbnRzID09IG51bGwpIHJl
dHVybiBkb2N1bWVudDsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbWVuZG1lbnRzLmxlbmd0aDsg
aSsrKSB7CiAgICBpZiAoYW1lbmRtZW50c1tpXSAhPSBudWxsKSB7CiAgICAgIElEYXRhQ3Vyc29y
IGN1cnNvciA9IGFtZW5kbWVudHNbaV0uZ2V0Q3Vyc29yKCk7CiAgICAgIFN0cmluZyBrZXkgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImtleSIpOwogICAgICBTdHJpbmcgdmFsdWUgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgInZhbHVlIik7CiAgICAgIFN0cmluZyBjb25kaXRp
b24gPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImNvbmRpdGlvbiIpOwogICAgICBjdXJz
b3IuZGVzdHJveSgpOwoKICAgICAga2V5ID0gdHVuZHJhLnN0cmluZy5zdWJzdGl0dXRlKGtleSwg
c2NvcGUpOwogICAgICB2YWx1ZSA9IHR1bmRyYS5zdHJpbmcuc3Vic3RpdHV0ZSh2YWx1ZSwgc2Nv
cGUpOwoKICAgICAgaWYgKChjb25kaXRpb24gPT0gbnVsbCkgfHwgdHVuZHJhLmNvbmRpdGlvbi5l
dmFsdWF0ZShjb25kaXRpb24sIHNjb3BlKSkgewogICAgICAgIGRvY3VtZW50ID0gdHVuZHJhLnN1
cHBvcnQuZG9jdW1lbnQucHV0KGRvY3VtZW50LCBrZXksIHZhbHVlKTsKICAgICAgfQogICAgfQog
IH0KCiAgcmV0dXJuIGRvY3VtZW50Owp9CgovLyByZXR1cm5zIHdoZXRoZXIgdHdvIGRvY3VtZW50
cyBhcmUgZXF1YWwKcHVibGljIHN0YXRpYyBib29sZWFuIGVxdWFsKElEYXRhIHgsIElEYXRhIHkp
IHsKICByZXR1cm4gdHVuZHJhLm9iamVjdC5lcXVhbCh4LCB5KTsKfQoKLy8gcmV0dXJucyBhbGwg
dGhlIGtleXMgaW4gdGhlIGdpdmVuIGRvY3VtZW50IGFzIGEgc3RyaW5nIGxpc3QKcHVibGljIHN0
YXRpYyBTdHJpbmdbXSBrZXlzZXQoSURhdGEgaW5wdXQpIHsKICByZXR1cm4ga2V5c2V0KGlucHV0
LCBudWxsKTsKfQoKLy8gcmV0dXJucyB0aGUga2V5cyB0aGF0IG1hdGNoIHRoZSBnaXZlbiByZWd1
bGFyIGV4cHJlc3Npb24gcGF0dGVybgovLyBpbiB0aGUgZ2l2ZW4gZG9jdW1lbnQgYXMgYSBzdHJp
bmcgbGlzdApwdWJsaWMgc3RhdGljIFN0cmluZ1tdIGtleXNldChJRGF0YSBpbnB1dCwgU3RyaW5n
IHBhdHRlcm4pIHsKICBqYXZhLnV0aWwucmVnZXguUGF0dGVybiBwID0gbnVsbDsKICBpZiAocGF0
dGVybiAhPSBudWxsKSBwID0gamF2YS51dGlsLnJlZ2V4LlBhdHRlcm4uY29tcGlsZShwYXR0ZXJu
KTsKCiAgamF2YS51dGlsLkxpc3Q8U3RyaW5nPiBrZXlzID0gbmV3IGphdmEudXRpbC5BcnJheUxp
c3Q8U3RyaW5nPigpOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJz
b3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIHdoaWxlKGN1cnNvci5uZXh0KCkpIHsKICAgICAg
U3RyaW5nIGtleSA9IGN1cnNvci5nZXRLZXkoKTsKCiAgICAgIGlmIChwID09IG51bGwpIHsKICAg
ICAgICBrZXlzLmFkZChjdXJzb3IuZ2V0S2V5KCkpOwogICAgICB9IGVsc2UgewogICAgICAgIGph
dmEudXRpbC5yZWdleC5NYXRjaGVyIG0gPSBwLm1hdGNoZXIoa2V5KTsKICAgICAgICBpZiAobS5t
YXRjaGVzKCkpIGtleXMuYWRkKGN1cnNvci5nZXRLZXkoKSk7CiAgICAgIH0gCiAgICB9CiAgICBj
dXJzb3IuZGVzdHJveSgpOwogIH0KICByZXR1cm4gKFN0cmluZ1tdKWtleXMudG9BcnJheShuZXcg
U3RyaW5nWzBdKTsKfQoKLy8gcmV0dXJucyBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gZG9j
dW1lbnQgYXMgYSBzdHJpbmcgbGlzdApwdWJsaWMgc3RhdGljIE9iamVjdFtdIHZhbHVlc2V0KElE
YXRhIGlucHV0KSB7CiAgamF2YS51dGlsLkxpc3Q8T2JqZWN0PiB2YWx1ZXMgPSBuZXcgamF2YS51
dGlsLkFycmF5TGlzdDxPYmplY3Q+KCk7CiAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgIElEYXRh
Q3Vyc29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgd2hpbGUoY3Vyc29yLm5leHQo
KSkgewogICAgICB2YWx1ZXMuYWRkKGN1cnNvci5nZXRWYWx1ZSgpKTsKICAgIH0KICAgIGN1cnNv
ci5kZXN0cm95KCk7CiAgfQogIHJldHVybiAoT2JqZWN0W10pdmFsdWVzLnRvQXJyYXkobmV3IE9i
amVjdFswXSk7Cn0KCi8vIG1lcmdlcyBtdWx0aXBsZSBJRGF0YSBkb2N1bWVudHMgaW50byBhIHNp
bmdsZSBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIG1lcmdlKElEYXRhW10gaW5wdXQpIHsK
ICBJRGF0YSBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgaWYgKGlucHV0ICE9IG51
bGwpIHsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgICAg
SURhdGFVdGlsLm1lcmdlKGlucHV0W2ldLCBvdXRwdXQpOwogICAgfQogIH0KICByZXR1cm4gb3V0
cHV0Owp9CgovLyBzb3J0cyB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQgYnkgaXRzIGtleXMgaW4g
bmF0dXJhbCBhc2NlbmRpbmcgb3JkZXIKcHVibGljIHN0YXRpYyBJRGF0YSBzb3J0KElEYXRhIGlu
cHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51bGw7
CgogIFN0cmluZ1tdIGtleXMgPSBrZXlzZXQoaW5wdXQpOwogIGphdmEudXRpbC5BcnJheXMuc29y
dChrZXlzKTsKCiAgSURhdGEgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogIElEYXRh
Q3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CiAgSURhdGFDdXJzb3Igb2MgPSBvdXRwdXQu
Z2V0Q3Vyc29yKCk7CgogIGZvciAoaW50IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewog
ICAgYm9vbGVhbiByZXN1bHQ7CgogICAgaWYgKGkgPiAwICYmIGtleXNbaV0uZXF1YWxzKGtleXNb
aS0xXSkpIHsKICAgICAgcmVzdWx0ID0gaWMubmV4dChrZXlzW2ldKTsKICAgIH0gZWxzZSB7CiAg
ICAgIHJlc3VsdCA9IGljLmZpcnN0KGtleXNbaV0pOwogICAgfQoKICAgIGlmIChyZXN1bHQpIHsK
ICAgICAgT2JqZWN0IHZhbHVlID0gaWMuZ2V0VmFsdWUoKTsKCiAgICAgIGlmICh2YWx1ZSAhPSBu
dWxsICYmIHJlY3Vyc2UpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YSkgewog
ICAgICAgICAgdmFsdWUgPSBzb3J0KChJRGF0YSl2YWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBl
bHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdmFsdWUgaW5zdGFuY2VvZiBjb20u
d20udXRpbC5UYWJsZSkgewogICAgICAgICAgSURhdGFbXSBhcnJheSA9IHZhbHVlIGluc3RhbmNl
b2YgSURhdGFbXSA/IChJRGF0YVtdKXZhbHVlIDogKChjb20ud20udXRpbC5UYWJsZSl2YWx1ZSku
Z2V0VmFsdWVzKCk7CiAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGFycmF5Lmxlbmd0aDsg
aisrKSB7CiAgICAgICAgICAgIGFycmF5W2pdID0gc29ydChhcnJheVtqXSwgcmVjdXJzZSk7CiAg
ICAgICAgICB9CiAgICAgICAgICB2YWx1ZSA9IGFycmF5OwogICAgICAgIH0KICAgICAgfQogICAg
ICBvYy5pbnNlcnRBZnRlcihrZXlzW2ldLCB2YWx1ZSk7CiAgICB9CiAgfQoKICBpYy5kZXN0cm95
KCk7CiAgb2MuZGVzdHJveSgpOwoKICByZXR1cm4gb3V0cHV0Owp9CgovLyB0cmltcyBhbGwgc3Ry
aW5nIHZhbHVlcywgdGhlbiBjb252ZXJ0cyBlbXB0eSBzdHJpbmdzIHRvIG51bGxzLCB0aGVuIGNv
bXBhY3RzIGJ5IHJlbW92aW5nIGFsbCBudWxsIHZhbHVlcwpwdWJsaWMgc3RhdGljIElEYXRhIHNx
dWVlemUoSURhdGEgaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxs
KSByZXR1cm4gbnVsbDsKCiAgSURhdGEgb3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwog
IElEYXRhQ3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CiAgSURhdGFDdXJzb3Igb2MgPSBv
dXRwdXQuZ2V0Q3Vyc29yKCk7CgogIHdoaWxlKGljLm5leHQoKSkgewogICAgU3RyaW5nIGtleSA9
IGljLmdldEtleSgpOwogICAgT2JqZWN0IHZhbHVlID0gaWMuZ2V0VmFsdWUoKTsKCiAgICBpZiAo
dmFsdWUgIT0gbnVsbCkgewogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAg
ICAgICBTdHJpbmcgc3RyaW5nID0gKFN0cmluZyl2YWx1ZTsKICAgICAgICBzdHJpbmcgPSBzdHJp
bmcudHJpbSgpOwogICAgICAgIGlmIChzdHJpbmcuZXF1YWxzKCIiKSkgc3RyaW5nID0gbnVsbDsK
ICAgICAgICB2YWx1ZSA9IHN0cmluZzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9m
IElEYXRhW10gfHwgdmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAg
IElEYXRhW10gYXJyYXkgPSB2YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURhdGFbXSl2YWx1
ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUpLmdldFZhbHVlcygpOwogICAgICAgIGlmIChy
ZWN1cnNlKSB7CiAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0LmRvY3VtZW50LnNxdWVlemUo
YXJyYXksIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAoYXJyYXkubGVuZ3RoID09IDApIHsK
ICAgICAgICAgIHZhbHVlID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFsdWUg
aW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAgIGlmIChyZWN1cnNlKSB7CiAgICAgICAgICB2YWx1
ZSA9IHNxdWVlemUoKElEYXRhKXZhbHVlLCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgSURhdGFDdXJzb3IgdmMgPSAoKElEYXRhKXZhbHVlKS5nZXRDdXJzb3IoKTsKICAgICAg
ICAgIGlmIChJRGF0YVV0aWwuc2l6ZSh2YykgPT0gMCkgdmFsdWUgPSBudWxsOwogICAgICAgICAg
dmMuZGVzdHJveSgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9m
IE9iamVjdFtdW10pIHsKICAgICAgICB2YWx1ZSA9IHR1bmRyYS5zdXBwb3J0LnRhYmxlLm9iamVj
dC5zcXVlZXplKChPYmplY3RbXVtdKXZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0
YW5jZW9mIE9iamVjdFtdKSB7CiAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlzdC5vYmplY3Quc3F1
ZWV6ZSgoT2JqZWN0W10pdmFsdWUpOwogICAgICB9CgogICAgICBpZiAodmFsdWUgIT0gbnVsbCkg
b2MuaW5zZXJ0QWZ0ZXIoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICBpZiAoSURhdGFVdGlsLnNp
emUob2MpID09IDApIG91dHB1dCA9IG51bGw7CgogIGljLmRlc3Ryb3koKTsKICBvYy5kZXN0cm95
KCk7CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIHJldHVybnMgdGhlIG51bWJlciBvZiB0b3AtbGV2
ZWwge2tleSwgdmFsdWV9IHBhaXJzIGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMg
c3RhdGljIGludCBzaXplKElEYXRhIGlucHV0KSB7CiAgaW50IHNpemUgPSAwOwogIGlmIChpbnB1
dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsK
ICAgIHNpemUgPSBJRGF0YVV0aWwuc2l6ZShjdXJzb3IpOwogICAgY3Vyc29yLmRlc3Ryb3koKTsK
ICB9CiAgcmV0dXJuIHNpemU7Cn0KCi8vIHJldHVybnMgYSBjbG9uZSBvZiB0aGUgZ2l2ZW4gSURh
dGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBkdXBsaWNhdGUoSURhdGEgaW5wdXQsIGJv
b2xlYW4gcmVjdXJzZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRpb24gewogIElEYXRhIG91dHB1dCA9
IG51bGw7CiAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgIElEYXRhQ3Vyc29yIGN1cnNvciA9IGlu
cHV0LmdldEN1cnNvcigpOwogICAgdHJ5IHsKICAgICAgaWYgKHJlY3Vyc2UpIHsKICAgICAgICBv
dXRwdXQgPSBJRGF0YVV0aWwuZGVlcENsb25lKGlucHV0KTsKICAgICAgfSBlbHNlIHsKICAgICAg
ICBvdXRwdXQgPSBJRGF0YVV0aWwuY2xvbmUoaW5wdXQpOwogICAgICB9CiAgICB9IGNhdGNoIChq
YXZhLmlvLklPRXhjZXB0aW9uIGV4KSB7CiAgICAgIHR1bmRyYS5leGNlcHRpb24ucmFpc2UoZXgp
OwogICAgfSBmaW5hbGx5IHsKICAgICAgY3Vyc29yLmRlc3Ryb3koKTsKICAgIH0KICB9CiAgcmV0
dXJuIG91dHB1dDsKfQoKLy8gcmVtb3ZlcyB0aGUgdmFsdWUgd2l0aCB0aGUgZ2l2ZW4ga2V5IGZy
b20gdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgSURhdGEgZHJvcChJRGF0
YSBpbnB1dCwgU3RyaW5nIGtleSkgewogIGlmIChpbnB1dCAhPSBudWxsICYmIGtleSAhPSBudWxs
KSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIElEYXRh
VXRpbC5yZW1vdmUoY3Vyc29yLCBrZXkpOwogICAgY3Vyc29yLmRlc3Ryb3koKTsKCiAgICBpZiAo
dHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQuS2V5LmlzRnVsbHlRdWFsaWZpZWQoa2V5KSkgZHJvcChp
bnB1dCwgdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQuS2V5LnBhcnNlKGtleSkpOwogIH0KICByZXR1
cm4gaW5wdXQ7Cn0KCi8vIHJlbW92ZXMgdGhlIHZhbHVlIHdpdGggdGhlIGdpdmVuIGtleSBmcm9t
IHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwcm90ZWN0ZWQgc3RhdGljIElEYXRhIGRyb3AoSURh
dGEgaW5wdXQsIGphdmEudXRpbC5RdWV1ZTx0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5LZXk+IGtl
eXMpIHsKICBpZiAoaW5wdXQgIT0gbnVsbCAmJiBrZXlzICE9IG51bGwgJiYga2V5cy5zaXplKCkg
PiAwKSB7CiAgICBJRGF0YUN1cnNvciBjdXJzb3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIHR1
bmRyYS5zdXBwb3J0LmRvY3VtZW50LktleSBrZXkgPSBrZXlzLnJlbW92ZSgpOwoKICAgIGlmIChr
ZXlzLnNpemUoKSA+IDApIHsKICAgICAgaWYgKGtleS5oYXNJbmRleCgpKSB7CiAgICAgICAgSURh
dGFbXSBhcnJheSA9IElEYXRhVXRpbC5nZXRJRGF0YUFycmF5KGN1cnNvciwga2V5LnRvU3RyaW5n
KCkpOwogICAgICAgIGRyb3AodHVuZHJhLmxpc3Qub2JqZWN0LmdldChhcnJheSwga2V5LmdldElu
ZGV4KCkpLCBrZXlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkcm9wKElEYXRhVXRpbC5nZXRJ
RGF0YShjdXJzb3IsIGtleS50b1N0cmluZygpKSwga2V5cyk7CiAgICAgIH0KICAgIH0gZWxzZSB7
CiAgICAgIGlmIChrZXkuaGFzSW5kZXgoKSkgewogICAgICAgIE9iamVjdFtdIGFycmF5ID0gSURh
dGFVdGlsLmdldE9iamVjdEFycmF5KGN1cnNvciwga2V5LnRvU3RyaW5nKCkpOwogICAgICAgIElE
YXRhVXRpbC5wdXQoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSwgdHVuZHJhLmxpc3Qub2JqZWN0LmRy
b3AoYXJyYXksIGtleS5nZXRJbmRleCgpKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgSURhdGFV
dGlsLnJlbW92ZShjdXJzb3IsIGtleS50b1N0cmluZygpKTsKICAgICAgfQogICAgfQogICAgY3Vy
c29yLmRlc3Ryb3koKTsKICB9CiAgcmV0dXJuIGlucHV0Owp9CgovLyB2aXNpdHMgZWFjaCBlbGVt
ZW50IGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCwgY2FsbHMgdGhlIGdpdmVuIHNlcnZpY2Ug
dG8gY29udmVydCB0aGUgZWxlbWVudCwgYW5kIGNyZWF0ZXMgYSBuZXcgSURhdGEgZG9jdW1lbnQg
d2l0aCB0aGUgcmVzdWx0aW5nIGVsZW1lbnRzCnB1YmxpYyBzdGF0aWMgSURhdGEgbWFwKElEYXRh
IGlucHV0LCBTdHJpbmcgc2VydmljZSwgSURhdGEgcGlwZWxpbmUsIFN0cmluZyBrZXlJbnB1dCwg
U3RyaW5nIGtleU91dHB1dCwgU3RyaW5nIHZhbHVlSW5wdXQsIFN0cmluZyB2YWx1ZU91dHB1dCwg
Q2xhc3MgdmFsdWVDbGFzcywgYm9vbGVhbiByZWN1cnNlKSB0aHJvd3MgU2VydmljZUV4Y2VwdGlv
biB7CiAgSURhdGEgb3V0cHV0ID0gbnVsbDsKCiAgaWYgKGlucHV0ICE9IG51bGwgJiYgc2Vydmlj
ZSAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBpYyA9IGlucHV0LmdldEN1cnNvcigpOwogICAg
b3V0cHV0ID0gSURhdGFGYWN0b3J5LmNyZWF0ZSgpOwogICAgSURhdGFDdXJzb3Igb2MgPSBvdXRw
dXQuZ2V0Q3Vyc29yKCk7CgogICAgaWYgKGtleUlucHV0ID09IG51bGwpIGtleUlucHV0ID0gIiRr
ZXkiOwogICAgaWYgKGtleU91dHB1dCA9PSBudWxsKSBrZXlPdXRwdXQgPSBrZXlJbnB1dDsKICAg
IGlmICh2YWx1ZUlucHV0ID09IG51bGwpIHZhbHVlSW5wdXQgPSAiJHZhbHVlIjsKICAgIGlmICh2
YWx1ZU91dHB1dCA9PSBudWxsKSB2YWx1ZU91dHB1dCA9IHZhbHVlSW5wdXQ7CiAgICBpZiAocGlw
ZWxpbmUgPT0gbnVsbCkgcGlwZWxpbmUgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CgogICAgdHJ5
IHsKICAgICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAgICAgVHVwbGU8T2JqZWN0PiB0dXBsZSA9
IG5ldyBUdXBsZTxPYmplY3Q+KGljLmdldEtleSgpLCBpYy5nZXRWYWx1ZSgpKTsKCiAgICAgICAg
aWYgKHJlY3Vyc2UgJiYgdHVwbGUudmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgaWYgKHR1cGxl
LnZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgICAgdHVwbGUudmFsdWUgPSBtYXAo
KElEYXRhKXR1cGxlLnZhbHVlLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91dHB1
dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MsIHJlY3Vyc2UpOwogICAgICAg
ICAgfSBlbHNlIGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdHVwbGUudmFs
dWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAgICAgICBJRGF0YVtdIGlh
cnkgPSB0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gPyAoSURhdGFbXSl0dXBsZS52YWx1
ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdHVwbGUudmFsdWUpLmdldFZhbHVlcygpOwogICAgICAg
ICAgICBJRGF0YVtdIG9hcnkgPSBuZXcgSURhdGFbaWFyeS5sZW5ndGhdOwogICAgICAgICAgICBm
b3IgKGludCBpID0gMDsgaSA8IGlhcnkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBvYXJ5
W2ldID0gbWFwKGlhcnlbaV0sIHNlcnZpY2UsIHBpcGVsaW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0
LCB2YWx1ZUlucHV0LCB2YWx1ZU91dHB1dCwgdmFsdWVDbGFzcywgcmVjdXJzZSk7CiAgICAgICAg
ICAgIH0KICAgICAgICAgICAgdHVwbGUudmFsdWUgPSBvYXJ5OwogICAgICAgICAgfSBlbHNlIGlm
ICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdW10pIHsKICAgICAgICAgICAgU3RyaW5n
W11bXSBpYXJ5ID0gKFN0cmluZ1tdW10pdHVwbGUudmFsdWU7CiAgICAgICAgICAgIFN0cmluZ1td
W10gb2FyeSA9IG5ldyBTdHJpbmdbaWFyeS5sZW5ndGhdW107CiAgICAgICAgICAgIGZvciAoaW50
IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChpYXJ5W2ld
ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9hcnlbaV0gPSBuZXcgU3RyaW5nW2lhcnlbaV0u
bGVuZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgaWFyeVtpXS5sZW5n
dGg7IGorKykgewogICAgICAgICAgICAgICAgICBUdXBsZTxTdHJpbmc+IHQgPSBtYXAobmV3IFR1
cGxlPFN0cmluZz4odHVwbGUua2V5LCBpYXJ5W2ldW2pdKSwgc2VydmljZSwgcGlwZWxpbmUsIGtl
eUlucHV0LCBrZXlPdXRwdXQsIHZhbHVlSW5wdXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNzKTsK
ICAgICAgICAgICAgICAgICAgb2FyeVtpXVtqXSA9IHQudmFsdWU7CiAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVlID0g
b2FyeTsKICAgICAgICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5zdGFuY2VvZiBTdHJpbmdb
XSkgewogICAgICAgICAgICBTdHJpbmdbXSBpYXJ5ID0gKFN0cmluZ1tdKXR1cGxlLnZhbHVlOwog
ICAgICAgICAgICBTdHJpbmdbXSBvYXJ5ID0gbmV3IFN0cmluZ1tpYXJ5Lmxlbmd0aF07CiAgICAg
ICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAgICAg
ICAgIFR1cGxlPFN0cmluZz4gdCA9IG1hcChuZXcgVHVwbGU8U3RyaW5nPih0dXBsZS5rZXksIGlh
cnlbaV0pLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJbnB1
dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MpOwogICAgICAgICAgICAgIG9hcnlbaV0gPSB0LnZh
bHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVlID0gb2FyeTsKICAgICAg
ICAgIH0gZWxzZSBpZiAodHVwbGUudmFsdWUgaW5zdGFuY2VvZiBPYmplY3RbXSkgewogICAgICAg
ICAgICBPYmplY3RbXSBpYXJ5ID0gKE9iamVjdFtdKXR1cGxlLnZhbHVlOwogICAgICAgICAgICBP
YmplY3RbXSBvYXJ5ID0gbmV3IE9iamVjdFtpYXJ5Lmxlbmd0aF07CiAgICAgICAgICAgIGZvciAo
aW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIFR1cGxlPE9i
amVjdD4gdCA9IG1hcChuZXcgVHVwbGU8T2JqZWN0Pih0dXBsZS5rZXksIGlhcnlbaV0pLCBzZXJ2
aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtleU91dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRw
dXQsIHZhbHVlQ2xhc3MpOwogICAgICAgICAgICAgIG9hcnlbaV0gPSB0LnZhbHVlOwogICAgICAg
ICAgICB9CiAgICAgICAgICAgIHR1cGxlLnZhbHVlID0gb2FyeTsKICAgICAgICAgIH0KICAgICAg
ICB9CiAgICAgICAgdHVwbGUgPSBtYXAodHVwbGUsIHNlcnZpY2UsIHBpcGVsaW5lLCBrZXlJbnB1
dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91dHB1dCwgdmFsdWVDbGFzcyk7CiAgICAg
ICAgSURhdGFVdGlsLnB1dChvYywgdHVwbGUua2V5LCB0dXBsZS52YWx1ZSk7CiAgICAgIH0KICAg
IH0gZmluYWxseSB7CiAgICAgIGljLmRlc3Ryb3koKTsKICAgICAgb2MuZGVzdHJveSgpOwogICAg
fQogIH0gZWxzZSB7CiAgICBvdXRwdXQgPSBkdXBsaWNhdGUoaW5wdXQsIHJlY3Vyc2UpOwogIH0K
CiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gd3JhcHBlciBjbGFzcyBmb3Ige2tleSwgdmFsdWV9IHR1
cGxlcwpwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFR1cGxlPFQ+IHsgCiAgcHVibGljIFN0cmluZyBr
ZXk7CiAgcHVibGljIFQgdmFsdWU7CiAgcHVibGljIFR1cGxlKFN0cmluZyBrZXksIFQgdmFsdWUp
IHsgCiAgICB0aGlzLmtleSA9IGtleTsgCiAgICB0aGlzLnZhbHVlID0gdmFsdWU7IAogIH0KfQoK
Ly8gY29udmVydHMgdGhlIGdpdmVuIGVsZW1lbnQgYnkgY2FsbGluZyB0aGUgZ2l2ZW4gc2Vydmlj
ZSwgYW5kIHJldHVybnMgdGhlIHJlc3VsdApwcm90ZWN0ZWQgc3RhdGljIDxUPiBUdXBsZTxUPiBt
YXAoVHVwbGU8VD4gdHVwbGUsIFN0cmluZyBzZXJ2aWNlLCBJRGF0YSBwaXBlbGluZSwgU3RyaW5n
IGtleUlucHV0LCBTdHJpbmcga2V5T3V0cHV0LCBTdHJpbmcgdmFsdWVJbnB1dCwgU3RyaW5nIHZh
bHVlT3V0cHV0LCBDbGFzcyB2YWx1ZUNsYXNzKSB0aHJvd3MgU2VydmljZUV4Y2VwdGlvbiB7CiAg
aWYgKHR1cGxlLnZhbHVlID09IG51bGwgfHwgdmFsdWVDbGFzcyA9PSBudWxsIHx8IHZhbHVlQ2xh
c3MuaXNJbnN0YW5jZSh0dXBsZS52YWx1ZSkpIHsKICAgIElEYXRhQ3Vyc29yIGN1cnNvciA9IHBp
cGVsaW5lLmdldEN1cnNvcigpOwogICAgSURhdGFVdGlsLnB1dChjdXJzb3IsIGtleUlucHV0LCB0
dXBsZS5rZXkpOwogICAgSURhdGFVdGlsLnB1dChjdXJzb3IsIHZhbHVlSW5wdXQsIHR1cGxlLnZh
bHVlKTsKICAgIGN1cnNvci5kZXN0cm95KCk7CgogICAgcGlwZWxpbmUgPSB0dW5kcmEuc2Vydmlj
ZS5pbnZva2Uoc2VydmljZSwgcGlwZWxpbmUpOwoKICAgIC8vIGNsZWFuIHVwIHRoZSBpbnB1dCBw
aXBlbGluZQogICAgY3Vyc29yID0gcGlwZWxpbmUuZ2V0Q3Vyc29yKCk7CiAgICB0dXBsZS5rZXkg
PSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwga2V5T3V0cHV0KTsKICAgIHR1cGxlLnZhbHVl
ID0gKFQpSURhdGFVdGlsLmdldChjdXJzb3IsIHZhbHVlT3V0cHV0KTsKICAgIElEYXRhVXRpbC5y
ZW1vdmUoY3Vyc29yLCBrZXlJbnB1dCk7CiAgICBpZiAoIWtleUlucHV0LmVxdWFscyhrZXlPdXRw
dXQpKSBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwga2V5T3V0cHV0KTsKICAgIElEYXRhVXRpbC5y
ZW1vdmUoY3Vyc29yLCB2YWx1ZUlucHV0KTsKICAgIGlmICghdmFsdWVJbnB1dC5lcXVhbHModmFs
dWVPdXRwdXQpKSBJRGF0YVV0aWwucmVtb3ZlKGN1cnNvciwgdmFsdWVPdXRwdXQpOwogICAgY3Vy
c29yLmRlc3Ryb3koKTsKICB9ICAKICByZXR1cm4gdHVwbGU7Cn0KCi8vIGludm9rZXMgdGhlIGdp
dmVuIHNlcnZpY2UgZm9yIGVhY2gge2tleSwgdmFsdWV9IHBhaXIgaW4gdGhlIGdpdmVuIElEYXRh
IGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgdm9pZCBlYWNoKElEYXRhIGlucHV0LCBTdHJpbmcgc2Vy
dmljZSwgSURhdGEgcGlwZWxpbmUsIFN0cmluZyBrZXlJbnB1dCwgU3RyaW5nIHZhbHVlSW5wdXQs
IENsYXNzIHZhbHVlQ2xhc3MsIGJvb2xlYW4gcmVjdXJzZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRp
b24gewogIG1hcChpbnB1dCwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlucHV0LCBudWxsLCB2YWx1
ZUlucHV0LCBudWxsLCB2YWx1ZUNsYXNzLCByZWN1cnNlKTsKfQoKLy8gcmVuYW1lcyBhIGtleSBm
cm9tIHNvdXJjZSB0byB0YXJnZXQgd2l0aGluIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJs
aWMgc3RhdGljIElEYXRhIHJlbmFtZShJRGF0YSBpbnB1dCwgU3RyaW5nIHNvdXJjZSwgU3RyaW5n
IHRhcmdldCkgewogIGlmICghc291cmNlLmVxdWFscyh0YXJnZXQpKSBpbnB1dCA9IGRyb3AoY29w
eShpbnB1dCwgc291cmNlLCB0YXJnZXQpLCBzb3VyY2UpOwogIHJldHVybiBpbnB1dDsKfQoKLy8g
Y29waWVzIGEgdmFsdWUgZnJvbSBzb3VyY2Uga2V5IHRvIHRhcmdldCBrZXkgd2l0aGluIHRoZSBn
aXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIGNvcHkoSURhdGEgaW5wdXQs
IFN0cmluZyBzb3VyY2UsIFN0cmluZyB0YXJnZXQpIHsKICBpZiAoc291cmNlLmVxdWFscyh0YXJn
ZXQpKSByZXR1cm4gaW5wdXQ7CiAgcmV0dXJuIHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LnB1dChp
bnB1dCwgdGFyZ2V0LCB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5nZXQoaW5wdXQsIHNvdXJjZSkp
Owp9CgovLyByZW1vdmVzIGFsbCBudWxsIHZhbHVlcyBmcm9tIHRoZSBnaXZlbiBJRGF0YSBkb2N1
bWVudApwdWJsaWMgc3RhdGljIElEYXRhIGNvbXBhY3QoSURhdGEgaW5wdXQsIGJvb2xlYW4gcmVj
dXJzZSkgewogIElEYXRhIG91dHB1dCA9IG51bGw7CgogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAg
ICBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgICBJRGF0YUN1cnNvciBpYyA9IGlu
cHV0LmdldEN1cnNvcigpOwogICAgSURhdGFDdXJzb3Igb2MgPSBvdXRwdXQuZ2V0Q3Vyc29yKCk7
CgogICAgdHJ5IHsKICAgICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAgICAgU3RyaW5nIGtleSA9
IGljLmdldEtleSgpOwogICAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7CgogICAg
ICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAocmVjdXJzZSkgewogICAgICAg
ICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YSkgewogICAgICAgICAgICAgIHZhbHVlID0g
Y29tcGFjdCgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZh
bHVlIGluc3RhbmNlb2YgSURhdGFbXSB8fCB2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLlRh
YmxlKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0dW5kcmEubGlzdC5kb2N1bWVudC5jb21wYWN0
KHZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSA/IChJRGF0YVtdKXZhbHVlIDogKChjb20ud20udXRp
bC5UYWJsZSl2YWx1ZSkuZ2V0VmFsdWVzKCksIHJlY3Vyc2UpOwogICAgICAgICAgICB9IGVsc2Ug
aWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0W11bXSkgewogICAgICAgICAgICAgIHZhbHVlID0g
dHVuZHJhLnN1cHBvcnQudGFibGUub2JqZWN0LmNvbXBhY3QoKE9iamVjdFtdW10pdmFsdWUpOwog
ICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0W10pIHsKICAgICAg
ICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0Lm9iamVjdC5jb21wYWN0KChPYmplY3RbXSl2YWx1
ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YWx1
ZSAhPSBudWxsKSBJRGF0YVV0aWwucHV0KG9jLCBrZXksIHZhbHVlKTsKICAgICAgfQogICAgfSBm
aW5hbGx5IHsKICAgICAgaWMuZGVzdHJveSgpOwogICAgICBvYy5kZXN0cm95KCk7CiAgICB9CiAg
fQoKICByZXR1cm4gb3V0cHV0Owp9CgovLyByZXR1cm5zIGEgbmV3IElEYXRhIGRvY3VtZW50LCB3
aGVyZSBhbGwgSURhdGFzIGFyZSBpbXBsZW1lbnRlZCB3aXRoIHRoZSBzYW1lIGNsYXNzLCBhbmQg
YWxsCi8vIGZ1bGx5IHF1YWxpZmllZCBrZXlzIGFyZSByZXBsYWNlZCB3aXRoIGEgbmVzdGVkIHN0
cnVjdHVyZQpwdWJsaWMgc3RhdGljIElEYXRhIG5vcm1hbGl6ZShJRGF0YSBpbnB1dCwgYm9vbGVh
biByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09IG51bGwpIHJldHVybiBudWxsOwoKICBJRGF0YSBv
dXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgSURhdGFDdXJzb3IgaWMgPSBpbnB1dC5n
ZXRDdXJzb3IoKTsKCiAgdHJ5IHsKICAgIHdoaWxlKGljLm5leHQoKSkgewogICAgICBTdHJpbmcg
a2V5ID0gaWMuZ2V0S2V5KCk7CiAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7Cgog
ICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGNv
bS53bS51dGlsLmNvZGVyLklEYXRhQ29kYWJsZSkgewogICAgICAgICAgdmFsdWUgPSAoKGNvbS53
bS51dGlsLmNvZGVyLklEYXRhQ29kYWJsZSl2YWx1ZSkuZ2V0SURhdGEoKTsKICAgICAgICB9IGVs
c2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuY29kZXIuVmFsdWVzQ29kYWJsZSkg
ewogICAgICAgICAgdmFsdWUgPSAoKGNvbS53bS51dGlsLmNvZGVyLlZhbHVlc0NvZGFibGUpdmFs
dWUpLmdldFZhbHVlcygpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBjb20u
d20udXRpbC5jb2Rlci5JRGF0YUNvZGFibGVbXSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxp
emUoKGNvbS53bS51dGlsLmNvZGVyLklEYXRhQ29kYWJsZVtdKXZhbHVlLCByZWN1cnNlKTsKICAg
ICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuY29kZXIuVmFsdWVz
Q29kYWJsZVtdKSB7CiAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6ZSgoY29tLndtLnV0aWwuY29k
ZXIuVmFsdWVzQ29kYWJsZVtdKXZhbHVlLCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHZh
bHVlIGluc3RhbmNlb2YgSURhdGFbXSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxpemUoKElE
YXRhW10pdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2Vv
ZiBjb20ud20udXRpbC5UYWJsZSkgewogICAgICAgICAgdmFsdWUgPSBub3JtYWxpemUoKChjb20u
d20udXRpbC5UYWJsZSl2YWx1ZSkuZ2V0VmFsdWVzKCksIHJlY3Vyc2UpOwogICAgICAgIH0gZWxz
ZSBpZiAocmVjdXJzZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIElEYXRhKSB7CiAgICAgICAgICB2YWx1
ZSA9IG5vcm1hbGl6ZSgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0KICAgICAgfQog
ICAgICB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5wdXQob3V0cHV0LCBrZXksIHZhbHVlKTsKICAg
IH0KICB9IGZpbmFsbHkgewogICAgaWMuZGVzdHJveSgpOwogIH0KCiAgcmV0dXJuIG91dHB1dDsK
fQoKLy8gbm9ybWFsaXplcyBhbiBJRGF0YVtdLCB3aGVyZSBhbGwgSURhdGFzIGFyZSBpbXBsZW1l
bnRlZCB3aXRoIHRoZSBzYW1lIGNsYXNzLCBhbmQgYWxsCi8vIGZ1bGx5IHF1YWxpZmllZCBrZXlz
IGFyZSByZXBsYWNlZCB3aXRoIGEgbmVzdGVkIHN0cnVjdHVyZQpwcm90ZWN0ZWQgc3RhdGljIElE
YXRhW10gbm9ybWFsaXplKElEYXRhW10gaW5wdXQsIGJvb2xlYW4gcmVjdXJzZSkgewogIGlmIChp
bnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgSURhdGFbXSBvdXRwdXQgPSBuZXcgSURhdGFb
aW5wdXQubGVuZ3RoXTsKICBmb3IgKGludCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7
CiAgICBvdXRwdXRbaV0gPSBub3JtYWxpemUoaW5wdXRbaV0sIHJlY3Vyc2UpOwogIH0KCiAgcmV0
dXJuIG91dHB1dDsKfQoKLy8gY29udmVydHMgYW4gSURhdGFDb2RhYmxlW10gdG8gYW4gSURhdGFb
XSBhbmQgbm9ybWFsaXplcywgd2hlcmUgYWxsIElEYXRhcyBhcmUgaW1wbGVtZW50ZWQgCi8vIHdp
dGggdGhlIHNhbWUgY2xhc3MsIGFuZCBhbGwgZnVsbHkgcXVhbGlmaWVkIGtleXMgYXJlIHJlcGxh
Y2VkIHdpdGggYSBuZXN0ZWQgc3RydWN0dXJlCnByb3RlY3RlZCBzdGF0aWMgSURhdGFbXSBub3Jt
YWxpemUoY29tLndtLnV0aWwuY29kZXIuSURhdGFDb2RhYmxlW10gaW5wdXQsIGJvb2xlYW4gcmVj
dXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgSURhdGFbXSBvdXRw
dXQgPSBuZXcgSURhdGFbaW5wdXQubGVuZ3RoXTsKICBmb3IgKGludCBpID0gMDsgaSA8IGlucHV0
Lmxlbmd0aDsgaSsrKSB7CiAgICBvdXRwdXRbaV0gPSBub3JtYWxpemUoaW5wdXRbaV0uZ2V0SURh
dGEoKSwgcmVjdXJzZSk7CiAgfQogIAogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIGNvbnZlcnRzIGEg
VmFsdWVzQ29kYWJsZVtdIHRvIGFuIElEYXRhW10gYW5kIG5vcm1hbGl6ZXMsIHdoZXJlIGFsbCBJ
RGF0YXMgYXJlIGltcGxlbWVudGVkIAovLyB3aXRoIHRoZSBzYW1lIGNsYXNzLCBhbmQgYWxsIGZ1
bGx5IHF1YWxpZmllZCBrZXlzIGFyZSByZXBsYWNlZCB3aXRoIGEgbmVzdGVkIHN0cnVjdHVyZQpw
cm90ZWN0ZWQgc3RhdGljIElEYXRhW10gbm9ybWFsaXplKGNvbS53bS51dGlsLmNvZGVyLlZhbHVl
c0NvZGFibGVbXSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09IG51bGwp
IHJldHVybiBudWxsOwoKICBJRGF0YVtdIG91dHB1dCA9IG5ldyBJRGF0YVtpbnB1dC5sZW5ndGhd
OwogIGZvciAoaW50IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgIG91dHB1dFtp
XSA9IG5vcm1hbGl6ZShpbnB1dFtpXS5nZXRWYWx1ZXMoKSwgcmVjdXJzZSk7CiAgfQogIAogIHJl
dHVybiBvdXRwdXQ7Cn0KCi8vIHJlbW92ZXMgYWxsIGtleXMgZXhjZXB0IHRob3NlIHNwZWNpZmll
ZCBmcm9tIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudApwdWJsaWMgc3RhdGljIHZvaWQgY2xlYXIo
SURhdGEgZG9jdW1lbnQsIFN0cmluZ1tdIGtleXMpIHsKICBpZiAoZG9jdW1lbnQgPT0gbnVsbCkg
cmV0dXJuOwoKICBJRGF0YSBzYXZlZCA9IG51bGw7CiAgaWYgKGtleXMgIT0gbnVsbCkgewogICAg
c2F2ZWQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGtl
eXMubGVuZ3RoOyBpKyspIHsKICAgICAgT2JqZWN0IHZhbHVlID0gdHVuZHJhLnN1cHBvcnQuZG9j
dW1lbnQuZ2V0KGRvY3VtZW50LCBrZXlzW2ldKTsKICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHR1
bmRyYS5zdXBwb3J0LmRvY3VtZW50LnB1dChzYXZlZCwga2V5c1tpXSwgdmFsdWUpOwogICAgfQog
IH0KCiAgSURhdGFDdXJzb3IgY3Vyc29yID0gZG9jdW1lbnQuZ2V0Q3Vyc29yKCk7CiAgY3Vyc29y
LmZpcnN0KCk7CiAgd2hpbGUoY3Vyc29yLmRlbGV0ZSgpKTsKICBjdXJzb3IuZGVzdHJveSgpOwoK
ICBpZiAoa2V5cyAhPSBudWxsKSBJRGF0YVV0aWwubWVyZ2Uoc2F2ZWQsIGRvY3VtZW50KTsKfQoK
Ly8gcGVyZm9ybXMgdmFyaWFibGUgc3Vic3RpdHV0aW9uIG9uIGFsbCBlbGVtZW50cyBvZiB0aGUg
Z2l2ZW4gSURhdGEgaW5wdXQgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBzdWJzdGl0dXRl
KElEYXRhIGlucHV0LCBJRGF0YSBzY29wZSwgYm9vbGVhbiByZWN1cnNlKSB7CiAgcmV0dXJuIHN1
YnN0aXR1dGUoaW5wdXQsIHNjb3BlLCBudWxsLCByZWN1cnNlKTsKfQoKLy8gcGVyZm9ybXMgdmFy
aWFibGUgc3Vic3RpdHV0aW9uIG9uIGFsbCBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gSURhdGEgaW5w
dXQgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBzdWJzdGl0dXRlKElEYXRhIGlucHV0LCBJ
RGF0YSBzY29wZSwgU3RyaW5nIGRlZmF1bHRWYWx1ZSwgYm9vbGVhbiByZWN1cnNlKSB7CiAgaWYg
KGlucHV0ID09IG51bGwpIHJldHVybiBudWxsOwogIGlmIChzY29wZSA9PSBudWxsKSBzY29wZSA9
IGlucHV0OwoKICBJRGF0YSBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CgogIElEYXRh
Q3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CiAgSURhdGFDdXJzb3Igb2MgPSBvdXRwdXQu
Z2V0Q3Vyc29yKCk7CgogIHRyeSB7CiAgICB3aGlsZShpYy5uZXh0KCkpIHsKICAgICAgU3RyaW5n
IGtleSA9IGljLmdldEtleSgpOwogICAgICBPYmplY3QgdmFsdWUgPSBpYy5nZXRWYWx1ZSgpOwog
ICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgIGlmIChyZWN1cnNlICYmIHZhbHVlIGlu
c3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgIHZhbHVlID0gc3Vic3RpdHV0ZSgoSURhdGEpdmFs
dWUsIHNjb3BlLCBkZWZhdWx0VmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAocmVj
dXJzZSAmJiAodmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtdIHx8IHZhbHVlIGluc3RhbmNlb2YgY29t
LndtLnV0aWwuVGFibGUpKSB7CiAgICAgICAgICBJRGF0YVtdIGlhcnkgPSB2YWx1ZSBpbnN0YW5j
ZW9mIElEYXRhW10gPyAoSURhdGFbXSl2YWx1ZSA6ICgoY29tLndtLnV0aWwuVGFibGUpdmFsdWUp
LmdldFZhbHVlcygpOwogICAgICAgICAgSURhdGFbXSBvYXJ5ID0gbmV3IElEYXRhW2lhcnkubGVu
Z3RoXTsKICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgb2Fy
eVtpXSA9IHN1YnN0aXR1dGUoaWFyeVtpXSwgc2NvcGUsIGRlZmF1bHRWYWx1ZSwgcmVjdXJzZSk7
CiAgICAgICAgICB2YWx1ZSA9IG9hcnk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5j
ZW9mIFN0cmluZykgewogICAgICAgICAgdmFsdWUgPSB0dW5kcmEuc3RyaW5nLnN1YnN0aXR1dGUo
KFN0cmluZyl2YWx1ZSwgc2NvcGUsIGRlZmF1bHRWYWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICh2
YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdKSB7CiAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0
LnN0cmluZy5zdWJzdGl0dXRlKChTdHJpbmdbXSl2YWx1ZSwgc2NvcGUsIGRlZmF1bHRWYWx1ZSk7
CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdW10pIHsKICAgICAg
ICAgIHZhbHVlID0gdHVuZHJhLmxpc3Quc3RyaW5nLnN1YnN0aXR1dGUoKFN0cmluZ1tdW10pdmFs
dWUsIHNjb3BlLCBkZWZhdWx0VmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBJRGF0YVV0
aWwucHV0KG9jLCBrZXksIHZhbHVlKTsKICAgIH0KICB9IGZpbmFsbHkgewogICAgaWMuZGVzdHJv
eSgpOwogICAgb2MuZGVzdHJveSgpOwogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gcGFyc2Vz
IGFuIElEYXRhIFhNTCBpbnB1dCBzdHJlYW0gdG8gYW4gSURhdGEgb2JqZWN0CnB1YmxpYyBzdGF0
aWMgSURhdGEgcGFyc2UoamF2YS5pby5JbnB1dFN0cmVhbSBpbikgdGhyb3dzIGphdmEuaW8uSU9F
eGNlcHRpb24gewogIGNvbS53bS51dGlsLmNvZGVyLlhNTENvZGVyV3JhcHBlciBjb2RlYyA9IG5l
dyBjb20ud20udXRpbC5jb2Rlci5YTUxDb2RlcldyYXBwZXIoKTsKICByZXR1cm4gY29kZWMuZGVj
b2RlKGluKTsKfQoKLy8gcGFyc2VzIGFuIElEYXRhIFhNTCBzdHJpbmcsIGJ5dGUgYXJyYXkgb3Ig
aW5wdXQgc3RyZWFtIHRvIGFuIElEYXRhIG9iamVjdApwdWJsaWMgc3RhdGljIElEYXRhIHBhcnNl
KE9iamVjdCBjb250ZW50LCBTdHJpbmcgZW5jb2RpbmcpIHRocm93cyBqYXZhLmlvLklPRXhjZXB0
aW9uIHsKICByZXR1cm4gcGFyc2UoKGphdmEuaW8uSW5wdXRTdHJlYW0pdHVuZHJhLm9iamVjdC5j
b252ZXJ0KGNvbnRlbnQsIGVuY29kaW5nLCAic3RyZWFtIikpOwp9CgovLyBlbWl0cyBhbiBJRGF0
YSBvYmplY3QgYXMgYSBhbiBJRGF0YSBYTUwgc3RyaW5nLCBieXRlIGFycmF5IG9yIHN0cmVhbQpw
dWJsaWMgc3RhdGljIE9iamVjdCBlbWl0KElEYXRhIGRvY3VtZW50LCBTdHJpbmcgZW5jb2Rpbmcs
IFN0cmluZyBtb2RlKSB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgY29tLndtLnV0aWwu
Y29kZXIuSURhdGFYTUxDb2RlciBjb2RlYyA9IG51bGw7CiAgaWYgKGVuY29kaW5nID09IG51bGwp
IHsKICAgIGNvZGVjID0gbmV3IGNvbS53bS51dGlsLmNvZGVyLklEYXRhWE1MQ29kZXIoKTsKICB9
IGVsc2UgewogICAgY29kZWMgPSBuZXcgY29tLndtLnV0aWwuY29kZXIuSURhdGFYTUxDb2Rlcihl
bmNvZGluZyk7CiAgfQoKICBqYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbSBvdXQgPSBuZXcg
amF2YS5pby5CeXRlQXJyYXlPdXRwdXRTdHJlYW0oKTsKICBjb2RlYy5lbmNvZGUob3V0LCBkb2N1
bWVudCk7CgogIHJldHVybiB0dW5kcmEub2JqZWN0LmNvbnZlcnQob3V0LnRvQnl0ZUFycmF5KCks
IGVuY29kaW5nLCBtb2RlKTsKfQ==</value>
  <value name="extends"></value>
  <array name="implements" type="value" depth="1">
  </array>
  <array name="imports" type="value" depth="1">
  </array>
</Values>
