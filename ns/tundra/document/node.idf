<?xml version="1.0" encoding="UTF-8"?>

<Values version="2.0">
  <value name="node_type">interface</value>
  <value name="node_nsName">tundra.document</value>
  <value name="encodeutf8">true</value>
  <value name="shared">Ly8gYW1lbmRzIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCB3aXRoIHRoZSB7a2V5LHZhbHVlfSBw
YWlycyBzcGVjaWZpZWQgaW4gdGhlCi8vIGFtZW5kbWVudHMgSURhdGEKcHVibGljIHN0YXRpYyBJ
RGF0YSBhbWVuZChJRGF0YSBkb2N1bWVudCwgSURhdGFbXSBhbWVuZG1lbnRzLCBJRGF0YSBzY29w
ZSkgdGhyb3dzIFNlcnZpY2VFeGNlcHRpb24gewogIGlmIChhbWVuZG1lbnRzID09IG51bGwpIHJl
dHVybiBkb2N1bWVudDsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbWVuZG1lbnRzLmxlbmd0aDsg
aSsrKSB7CiAgICBpZiAoYW1lbmRtZW50c1tpXSAhPSBudWxsKSB7CiAgICAgIElEYXRhQ3Vyc29y
IGN1cnNvciA9IGFtZW5kbWVudHNbaV0uZ2V0Q3Vyc29yKCk7CiAgICAgIFN0cmluZyBrZXkgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImtleSIpOwogICAgICBTdHJpbmcgdmFsdWUgPSBJ
RGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgInZhbHVlIik7CiAgICAgIFN0cmluZyBjb25kaXRp
b24gPSBJRGF0YVV0aWwuZ2V0U3RyaW5nKGN1cnNvciwgImNvbmRpdGlvbiIpOwogICAgICBjdXJz
b3IuZGVzdHJveSgpOwoKICAgICAga2V5ID0gdHVuZHJhLnN0cmluZy5zdWJzdGl0dXRlKGtleSwg
c2NvcGUpOwogICAgICB2YWx1ZSA9IHR1bmRyYS5zdHJpbmcuc3Vic3RpdHV0ZSh2YWx1ZSwgc2Nv
cGUpOwoKICAgICAgaWYgKChjb25kaXRpb24gPT0gbnVsbCkgfHwgdHVuZHJhLmNvbmRpdGlvbi5l
dmFsdWF0ZShjb25kaXRpb24sIHNjb3BlKSkgewogICAgICAgIGRvY3VtZW50ID0gdHVuZHJhLnN1
cHBvcnQuZG9jdW1lbnQucHV0KGRvY3VtZW50LCBrZXksIHZhbHVlKTsKICAgICAgfQogICAgfQog
IH0KCiAgcmV0dXJuIGRvY3VtZW50Owp9CgovLyByZXR1cm5zIHdoZXRoZXIgdHdvIGRvY3VtZW50
cyBhcmUgZXF1YWwKcHVibGljIHN0YXRpYyBib29sZWFuIGVxdWFsKElEYXRhIHgsIElEYXRhIHkp
IHsKICByZXR1cm4gdHVuZHJhLm9iamVjdC5lcXVhbCh4LCB5KTsKfQoKLy8gcmV0dXJucyBhbGwg
dGhlIGtleXMgaW4gdGhlIGdpdmVuIGRvY3VtZW50IGFzIGEgc3RyaW5nIGxpc3QKcHVibGljIHN0
YXRpYyBTdHJpbmdbXSBrZXlzZXQoSURhdGEgaW5wdXQpIHsKICByZXR1cm4ga2V5c2V0KGlucHV0
LCBudWxsKTsKfQoKLy8gcmV0dXJucyB0aGUga2V5cyB0aGF0IG1hdGNoIHRoZSBnaXZlbiByZWd1
bGFyIGV4cHJlc3Npb24gcGF0dGVybgovLyBpbiB0aGUgZ2l2ZW4gZG9jdW1lbnQgYXMgYSBzdHJp
bmcgbGlzdApwdWJsaWMgc3RhdGljIFN0cmluZ1tdIGtleXNldChJRGF0YSBpbnB1dCwgU3RyaW5n
IHBhdHRlcm4pIHsKICBqYXZhLnV0aWwucmVnZXguUGF0dGVybiBwID0gbnVsbDsKICBpZiAocGF0
dGVybiAhPSBudWxsKSBwID0gamF2YS51dGlsLnJlZ2V4LlBhdHRlcm4uY29tcGlsZShwYXR0ZXJu
KTsKCiAgamF2YS51dGlsLkxpc3Q8U3RyaW5nPiBrZXlzID0gbmV3IGphdmEudXRpbC5BcnJheUxp
c3Q8U3RyaW5nPigpOwogIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICBJRGF0YUN1cnNvciBjdXJz
b3IgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICAgIHdoaWxlKGN1cnNvci5uZXh0KCkpIHsKICAgICAg
U3RyaW5nIGtleSA9IGN1cnNvci5nZXRLZXkoKTsKCiAgICAgIGlmIChwID09IG51bGwpIHsKICAg
ICAgICBrZXlzLmFkZChjdXJzb3IuZ2V0S2V5KCkpOwogICAgICB9IGVsc2UgewogICAgICAgIGph
dmEudXRpbC5yZWdleC5NYXRjaGVyIG0gPSBwLm1hdGNoZXIoa2V5KTsKICAgICAgICBpZiAobS5t
YXRjaGVzKCkpIGtleXMuYWRkKGN1cnNvci5nZXRLZXkoKSk7CiAgICAgIH0gCiAgICB9CiAgICBj
dXJzb3IuZGVzdHJveSgpOwogIH0KICByZXR1cm4gKFN0cmluZ1tdKWtleXMudG9BcnJheShuZXcg
U3RyaW5nWzBdKTsKfQoKLy8gcmV0dXJucyBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gZG9j
dW1lbnQgYXMgYSBzdHJpbmcgbGlzdApwdWJsaWMgc3RhdGljIE9iamVjdFtdIHZhbHVlc2V0KElE
YXRhIGlucHV0KSB7CiAgamF2YS51dGlsLkxpc3QgdmFsdWVzID0gbmV3IGphdmEudXRpbC5BcnJh
eUxpc3QoKTsKICBqYXZhLnV0aWwuU2V0PENsYXNzPD8+PiBjbGFzc2VzID0gbmV3IGphdmEudXRp
bC5MaW5rZWRIYXNoU2V0PENsYXNzPD8+PigpOwoKICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAg
SURhdGFDdXJzb3IgY3Vyc29yID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CiAgICB3aGlsZShjdXJzb3Iu
bmV4dCgpKSB7CiAgICAgIE9iamVjdCB2YWx1ZSA9IGN1cnNvci5nZXRWYWx1ZSgpOwogICAgICBp
ZiAodmFsdWUgIT0gbnVsbCkgY2xhc3Nlcy5hZGQodmFsdWUuZ2V0Q2xhc3MoKSk7CiAgICAgIHZh
bHVlcy5hZGQodmFsdWUpOwogICAgfQogICAgY3Vyc29yLmRlc3Ryb3koKTsKICB9CgogIENsYXNz
PD8+IG5lYXJlc3RBbmNlc3RvciA9IHR1bmRyYS5zdXBwb3J0Lm9iamVjdC5uZWFyZXN0QW5jZXN0
b3IoY2xhc3Nlcyk7CiAgaWYgKG5lYXJlc3RBbmNlc3RvciA9PSBudWxsKSBuZWFyZXN0QW5jZXN0
b3IgPSBPYmplY3QuY2xhc3M7CiAgCiAgcmV0dXJuIHZhbHVlcy50b0FycmF5KChPYmplY3RbXSlq
YXZhLmxhbmcucmVmbGVjdC5BcnJheS5uZXdJbnN0YW5jZShuZWFyZXN0QW5jZXN0b3IsIDApKTsK
fQoKLy8gbWVyZ2VzIG11bHRpcGxlIElEYXRhIGRvY3VtZW50cyBpbnRvIGEgc2luZ2xlIGRvY3Vt
ZW50CnB1YmxpYyBzdGF0aWMgSURhdGEgbWVyZ2UoSURhdGFbXSBpbnB1dCkgewogIElEYXRhIG91
dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAg
Zm9yIChpbnQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgICBJRGF0YVV0aWwu
bWVyZ2UoaW5wdXRbaV0sIG91dHB1dCk7CiAgICB9CiAgfQogIHJldHVybiBvdXRwdXQ7Cn0KCi8v
IHNvcnRzIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVudCBieSBpdHMga2V5cyBpbiBuYXR1cmFsIGFz
Y2VuZGluZyBvcmRlcgpwdWJsaWMgc3RhdGljIElEYXRhIHNvcnQoSURhdGEgaW5wdXQsIGJvb2xl
YW4gcmVjdXJzZSkgewogIGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgU3RyaW5n
W10ga2V5cyA9IGtleXNldChpbnB1dCk7CiAgamF2YS51dGlsLkFycmF5cy5zb3J0KGtleXMpOwoK
ICBJRGF0YSBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgSURhdGFDdXJzb3IgaWMg
PSBpbnB1dC5nZXRDdXJzb3IoKTsKICBJRGF0YUN1cnNvciBvYyA9IG91dHB1dC5nZXRDdXJzb3Io
KTsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICBib29sZWFu
IHJlc3VsdDsKCiAgICBpZiAoaSA+IDAgJiYga2V5c1tpXS5lcXVhbHMoa2V5c1tpLTFdKSkgewog
ICAgICByZXN1bHQgPSBpYy5uZXh0KGtleXNbaV0pOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0
ID0gaWMuZmlyc3Qoa2V5c1tpXSk7CiAgICB9CgogICAgaWYgKHJlc3VsdCkgewogICAgICBPYmpl
Y3QgdmFsdWUgPSBpYy5nZXRWYWx1ZSgpOwoKICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgcmVj
dXJzZSkgewogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEYXRhKSB7CiAgICAgICAgICB2
YWx1ZSA9IHNvcnQoKElEYXRhKXZhbHVlLCByZWN1cnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHZh
bHVlIGluc3RhbmNlb2YgSURhdGFbXSB8fCB2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLlRh
YmxlKSB7CiAgICAgICAgICBJRGF0YVtdIGFycmF5ID0gdmFsdWUgaW5zdGFuY2VvZiBJRGF0YVtd
ID8gKElEYXRhW10pdmFsdWUgOiAoKGNvbS53bS51dGlsLlRhYmxlKXZhbHVlKS5nZXRWYWx1ZXMo
KTsKICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYXJyYXkubGVuZ3RoOyBqKyspIHsKICAg
ICAgICAgICAgYXJyYXlbal0gPSBzb3J0KGFycmF5W2pdLCByZWN1cnNlKTsKICAgICAgICAgIH0K
ICAgICAgICAgIHZhbHVlID0gYXJyYXk7CiAgICAgICAgfQogICAgICB9CiAgICAgIG9jLmluc2Vy
dEFmdGVyKGtleXNbaV0sIHZhbHVlKTsKICAgIH0KICB9CgogIGljLmRlc3Ryb3koKTsKICBvYy5k
ZXN0cm95KCk7CgogIHJldHVybiBvdXRwdXQ7Cn0KCi8vIHRyaW1zIGFsbCBzdHJpbmcgdmFsdWVz
LCB0aGVuIGNvbnZlcnRzIGVtcHR5IHN0cmluZ3MgdG8gbnVsbHMsIHRoZW4gY29tcGFjdHMgYnkg
cmVtb3ZpbmcgYWxsIG51bGwgdmFsdWVzCnB1YmxpYyBzdGF0aWMgSURhdGEgc3F1ZWV6ZShJRGF0
YSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09IG51bGwpIHJldHVybiBu
dWxsOwoKICBJRGF0YSBvdXRwdXQgPSBJRGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgSURhdGFDdXJz
b3IgaWMgPSBpbnB1dC5nZXRDdXJzb3IoKTsKICBJRGF0YUN1cnNvciBvYyA9IG91dHB1dC5nZXRD
dXJzb3IoKTsKCiAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICBTdHJpbmcga2V5ID0gaWMuZ2V0S2V5
KCk7CiAgICBPYmplY3QgdmFsdWUgPSBpYy5nZXRWYWx1ZSgpOwoKICAgIGlmICh2YWx1ZSAhPSBu
dWxsKSB7CiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIFN0cmlu
ZyBzdHJpbmcgPSAoU3RyaW5nKXZhbHVlOwogICAgICAgIHN0cmluZyA9IHN0cmluZy50cmltKCk7
CiAgICAgICAgaWYgKHN0cmluZy5lcXVhbHMoIiIpKSBzdHJpbmcgPSBudWxsOwogICAgICAgIHZh
bHVlID0gc3RyaW5nOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSB8
fCB2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLlRhYmxlKSB7CiAgICAgICAgSURhdGFbXSBh
cnJheSA9IHZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSA/IChJRGF0YVtdKXZhbHVlIDogKChjb20u
d20udXRpbC5UYWJsZSl2YWx1ZSkuZ2V0VmFsdWVzKCk7CiAgICAgICAgaWYgKHJlY3Vyc2UpIHsK
ICAgICAgICAgIHZhbHVlID0gdHVuZHJhLmxpc3QuZG9jdW1lbnQuc3F1ZWV6ZShhcnJheSwgcmVj
dXJzZSk7CiAgICAgICAgfSBlbHNlIGlmIChhcnJheS5sZW5ndGggPT0gMCkgewogICAgICAgICAg
dmFsdWUgPSBudWxsOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9m
IElEYXRhKSB7CiAgICAgICAgaWYgKHJlY3Vyc2UpIHsKICAgICAgICAgIHZhbHVlID0gc3F1ZWV6
ZSgoSURhdGEpdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBJRGF0
YUN1cnNvciB2YyA9ICgoSURhdGEpdmFsdWUpLmdldEN1cnNvcigpOwogICAgICAgICAgaWYgKElE
YXRhVXRpbC5zaXplKHZjKSA9PSAwKSB2YWx1ZSA9IG51bGw7CiAgICAgICAgICB2Yy5kZXN0cm95
KCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0W11b
XSkgewogICAgICAgIHZhbHVlID0gdHVuZHJhLnN1cHBvcnQudGFibGUub2JqZWN0LnNxdWVlemUo
KE9iamVjdFtdW10pdmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2Jq
ZWN0W10pIHsKICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0Lm9iamVjdC5zcXVlZXplKChPYmpl
Y3RbXSl2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSBvYy5pbnNlcnRB
ZnRlcihrZXksIHZhbHVlKTsKICAgIH0KICB9CgogIGlmIChJRGF0YVV0aWwuc2l6ZShvYykgPT0g
MCkgb3V0cHV0ID0gbnVsbDsKCiAgaWMuZGVzdHJveSgpOwogIG9jLmRlc3Ryb3koKTsKCiAgcmV0
dXJuIG91dHB1dDsKfQoKLy8gcmV0dXJucyB0aGUgbnVtYmVyIG9mIHRvcC1sZXZlbCB7a2V5LCB2
YWx1ZX0gcGFpcnMgaW4gdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgaW50
IHNpemUoSURhdGEgaW5wdXQpIHsKICBpbnQgc2l6ZSA9IDA7CiAgaWYgKGlucHV0ICE9IG51bGwp
IHsKICAgIElEYXRhQ3Vyc29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgc2l6ZSA9
IElEYXRhVXRpbC5zaXplKGN1cnNvcik7CiAgICBjdXJzb3IuZGVzdHJveSgpOwogIH0KICByZXR1
cm4gc2l6ZTsKfQoKLy8gcmV0dXJucyBhIGNsb25lIG9mIHRoZSBnaXZlbiBJRGF0YSBkb2N1bWVu
dApwdWJsaWMgc3RhdGljIElEYXRhIGR1cGxpY2F0ZShJRGF0YSBpbnB1dCwgYm9vbGVhbiByZWN1
cnNlKSB0aHJvd3MgU2VydmljZUV4Y2VwdGlvbiB7CiAgSURhdGEgb3V0cHV0ID0gbnVsbDsKICBp
ZiAoaW5wdXQgIT0gbnVsbCkgewogICAgSURhdGFDdXJzb3IgY3Vyc29yID0gaW5wdXQuZ2V0Q3Vy
c29yKCk7CiAgICB0cnkgewogICAgICBpZiAocmVjdXJzZSkgewogICAgICAgIG91dHB1dCA9IElE
YXRhVXRpbC5kZWVwQ2xvbmUoaW5wdXQpOwogICAgICB9IGVsc2UgewogICAgICAgIG91dHB1dCA9
IElEYXRhVXRpbC5jbG9uZShpbnB1dCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGphdmEuaW8uSU9F
eGNlcHRpb24gZXgpIHsKICAgICAgdHVuZHJhLmV4Y2VwdGlvbi5yYWlzZShleCk7CiAgICB9IGZp
bmFsbHkgewogICAgICBjdXJzb3IuZGVzdHJveSgpOwogICAgfQogIH0KICByZXR1cm4gb3V0cHV0
Owp9CgovLyByZW1vdmVzIHRoZSB2YWx1ZSB3aXRoIHRoZSBnaXZlbiBrZXkgZnJvbSB0aGUgZ2l2
ZW4gSURhdGEgZG9jdW1lbnQKcHVibGljIHN0YXRpYyBJRGF0YSBkcm9wKElEYXRhIGlucHV0LCBT
dHJpbmcga2V5KSB7CiAgaWYgKGlucHV0ICE9IG51bGwgJiYga2V5ICE9IG51bGwpIHsKICAgIElE
YXRhQ3Vyc29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgSURhdGFVdGlsLnJlbW92
ZShjdXJzb3IsIGtleSk7CiAgICBjdXJzb3IuZGVzdHJveSgpOwoKICAgIGlmICh0dW5kcmEuc3Vw
cG9ydC5kb2N1bWVudC5LZXkuaXNGdWxseVF1YWxpZmllZChrZXkpKSBkcm9wKGlucHV0LCB0dW5k
cmEuc3VwcG9ydC5kb2N1bWVudC5LZXkucGFyc2Uoa2V5KSk7CiAgfQogIHJldHVybiBpbnB1dDsK
fQoKLy8gcmVtb3ZlcyB0aGUgdmFsdWUgd2l0aCB0aGUgZ2l2ZW4ga2V5IGZyb20gdGhlIGdpdmVu
IElEYXRhIGRvY3VtZW50CnByb3RlY3RlZCBzdGF0aWMgSURhdGEgZHJvcChJRGF0YSBpbnB1dCwg
amF2YS51dGlsLlF1ZXVlPHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LktleT4ga2V5cykgewogIGlm
IChpbnB1dCAhPSBudWxsICYmIGtleXMgIT0gbnVsbCAmJiBrZXlzLnNpemUoKSA+IDApIHsKICAg
IElEYXRhQ3Vyc29yIGN1cnNvciA9IGlucHV0LmdldEN1cnNvcigpOwogICAgdHVuZHJhLnN1cHBv
cnQuZG9jdW1lbnQuS2V5IGtleSA9IGtleXMucmVtb3ZlKCk7CgogICAgaWYgKGtleXMuc2l6ZSgp
ID4gMCkgewogICAgICBpZiAoa2V5Lmhhc0luZGV4KCkpIHsKICAgICAgICBJRGF0YVtdIGFycmF5
ID0gSURhdGFVdGlsLmdldElEYXRhQXJyYXkoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSk7CiAgICAg
ICAgZHJvcCh0dW5kcmEubGlzdC5vYmplY3QuZ2V0KGFycmF5LCBrZXkuZ2V0SW5kZXgoKSksIGtl
eXMpOwogICAgICB9IGVsc2UgewogICAgICAgIGRyb3AoSURhdGFVdGlsLmdldElEYXRhKGN1cnNv
ciwga2V5LnRvU3RyaW5nKCkpLCBrZXlzKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYg
KGtleS5oYXNJbmRleCgpKSB7CiAgICAgICAgT2JqZWN0W10gYXJyYXkgPSBJRGF0YVV0aWwuZ2V0
T2JqZWN0QXJyYXkoY3Vyc29yLCBrZXkudG9TdHJpbmcoKSk7CiAgICAgICAgSURhdGFVdGlsLnB1
dChjdXJzb3IsIGtleS50b1N0cmluZygpLCB0dW5kcmEubGlzdC5vYmplY3QuZHJvcChhcnJheSwg
a2V5LmdldEluZGV4KCkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBJRGF0YVV0aWwucmVtb3Zl
KGN1cnNvciwga2V5LnRvU3RyaW5nKCkpOwogICAgICB9CiAgICB9CiAgICBjdXJzb3IuZGVzdHJv
eSgpOwogIH0KICByZXR1cm4gaW5wdXQ7Cn0KCi8vIHZpc2l0cyBlYWNoIGVsZW1lbnQgaW4gdGhl
IGdpdmVuIElEYXRhIGRvY3VtZW50LCBjYWxscyB0aGUgZ2l2ZW4gc2VydmljZSB0byBjb252ZXJ0
IHRoZSBlbGVtZW50LCBhbmQgY3JlYXRlcyBhIG5ldyBJRGF0YSBkb2N1bWVudCB3aXRoIHRoZSBy
ZXN1bHRpbmcgZWxlbWVudHMKcHVibGljIHN0YXRpYyBJRGF0YSBtYXAoSURhdGEgaW5wdXQsIFN0
cmluZyBzZXJ2aWNlLCBJRGF0YSBwaXBlbGluZSwgU3RyaW5nIGtleUlucHV0LCBTdHJpbmcga2V5
T3V0cHV0LCBTdHJpbmcgdmFsdWVJbnB1dCwgU3RyaW5nIHZhbHVlT3V0cHV0LCBDbGFzcyB2YWx1
ZUNsYXNzLCBib29sZWFuIHJlY3Vyc2UpIHRocm93cyBTZXJ2aWNlRXhjZXB0aW9uIHsKICBJRGF0
YSBvdXRwdXQgPSBudWxsOwoKICBpZiAoaW5wdXQgIT0gbnVsbCAmJiBzZXJ2aWNlICE9IG51bGwp
IHsKICAgIElEYXRhQ3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vyc29yKCk7CiAgICBvdXRwdXQgPSBJ
RGF0YUZhY3RvcnkuY3JlYXRlKCk7CiAgICBJRGF0YUN1cnNvciBvYyA9IG91dHB1dC5nZXRDdXJz
b3IoKTsKCiAgICBpZiAoa2V5SW5wdXQgPT0gbnVsbCkga2V5SW5wdXQgPSAiJGtleSI7CiAgICBp
ZiAoa2V5T3V0cHV0ID09IG51bGwpIGtleU91dHB1dCA9IGtleUlucHV0OwogICAgaWYgKHZhbHVl
SW5wdXQgPT0gbnVsbCkgdmFsdWVJbnB1dCA9ICIkdmFsdWUiOwogICAgaWYgKHZhbHVlT3V0cHV0
ID09IG51bGwpIHZhbHVlT3V0cHV0ID0gdmFsdWVJbnB1dDsKICAgIGlmIChwaXBlbGluZSA9PSBu
dWxsKSBwaXBlbGluZSA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKCiAgICB0cnkgewogICAgICB3
aGlsZShpYy5uZXh0KCkpIHsKICAgICAgICBUdXBsZTxPYmplY3Q+IHR1cGxlID0gbmV3IFR1cGxl
PE9iamVjdD4oaWMuZ2V0S2V5KCksIGljLmdldFZhbHVlKCkpOwoKICAgICAgICBpZiAocmVjdXJz
ZSAmJiB0dXBsZS52YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAodHVwbGUudmFsdWUgaW5z
dGFuY2VvZiBJRGF0YSkgewogICAgICAgICAgICB0dXBsZS52YWx1ZSA9IG1hcCgoSURhdGEpdHVw
bGUudmFsdWUsIHNlcnZpY2UsIHBpcGVsaW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlu
cHV0LCB2YWx1ZU91dHB1dCwgdmFsdWVDbGFzcywgcmVjdXJzZSk7CiAgICAgICAgICB9IGVsc2Ug
aWYgKHR1cGxlLnZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSB8fCB0dXBsZS52YWx1ZSBpbnN0YW5j
ZW9mIGNvbS53bS51dGlsLlRhYmxlKSB7CiAgICAgICAgICAgIElEYXRhW10gaWFyeSA9IHR1cGxl
LnZhbHVlIGluc3RhbmNlb2YgSURhdGFbXSA/IChJRGF0YVtdKXR1cGxlLnZhbHVlIDogKChjb20u
d20udXRpbC5UYWJsZSl0dXBsZS52YWx1ZSkuZ2V0VmFsdWVzKCk7CiAgICAgICAgICAgIElEYXRh
W10gb2FyeSA9IG5ldyBJRGF0YVtpYXJ5Lmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkg
PSAwOyBpIDwgaWFyeS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIG9hcnlbaV0gPSBtYXAo
aWFyeVtpXSwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlucHV0LCBrZXlPdXRwdXQsIHZhbHVlSW5w
dXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNzLCByZWN1cnNlKTsKICAgICAgICAgICAgfQogICAg
ICAgICAgICB0dXBsZS52YWx1ZSA9IG9hcnk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR1cGxlLnZh
bHVlIGluc3RhbmNlb2YgU3RyaW5nW11bXSkgewogICAgICAgICAgICBTdHJpbmdbXVtdIGlhcnkg
PSAoU3RyaW5nW11bXSl0dXBsZS52YWx1ZTsKICAgICAgICAgICAgU3RyaW5nW11bXSBvYXJ5ID0g
bmV3IFN0cmluZ1tpYXJ5Lmxlbmd0aF1bXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg
PCBpYXJ5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKGlhcnlbaV0gIT0gbnVsbCkg
ewogICAgICAgICAgICAgICAgb2FyeVtpXSA9IG5ldyBTdHJpbmdbaWFyeVtpXS5sZW5ndGhdOwog
ICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBpYXJ5W2ldLmxlbmd0aDsgaisrKSB7
CiAgICAgICAgICAgICAgICAgIFR1cGxlPFN0cmluZz4gdCA9IG1hcChuZXcgVHVwbGU8U3RyaW5n
Pih0dXBsZS5rZXksIGlhcnlbaV1bal0pLCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIGtl
eU91dHB1dCwgdmFsdWVJbnB1dCwgdmFsdWVPdXRwdXQsIHZhbHVlQ2xhc3MpOwogICAgICAgICAg
ICAgICAgICBvYXJ5W2ldW2pdID0gdC52YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHVwbGUudmFsdWUgPSBvYXJ5OwogICAg
ICAgICAgfSBlbHNlIGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ1tdKSB7CiAgICAg
ICAgICAgIFN0cmluZ1tdIGlhcnkgPSAoU3RyaW5nW10pdHVwbGUudmFsdWU7CiAgICAgICAgICAg
IFN0cmluZ1tdIG9hcnkgPSBuZXcgU3RyaW5nW2lhcnkubGVuZ3RoXTsKICAgICAgICAgICAgZm9y
IChpbnQgaSA9IDA7IGkgPCBpYXJ5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgVHVwbGU8
U3RyaW5nPiB0ID0gbWFwKG5ldyBUdXBsZTxTdHJpbmc+KHR1cGxlLmtleSwgaWFyeVtpXSksIHNl
cnZpY2UsIHBpcGVsaW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91
dHB1dCwgdmFsdWVDbGFzcyk7CiAgICAgICAgICAgICAgb2FyeVtpXSA9IHQudmFsdWU7CiAgICAg
ICAgICAgIH0KICAgICAgICAgICAgdHVwbGUudmFsdWUgPSBvYXJ5OwogICAgICAgICAgfSBlbHNl
IGlmICh0dXBsZS52YWx1ZSBpbnN0YW5jZW9mIE9iamVjdFtdKSB7CiAgICAgICAgICAgIE9iamVj
dFtdIGlhcnkgPSAoT2JqZWN0W10pdHVwbGUudmFsdWU7CiAgICAgICAgICAgIE9iamVjdFtdIG9h
cnkgPSBuZXcgT2JqZWN0W2lhcnkubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7
IGkgPCBpYXJ5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgVHVwbGU8T2JqZWN0PiB0ID0g
bWFwKG5ldyBUdXBsZTxPYmplY3Q+KHR1cGxlLmtleSwgaWFyeVtpXSksIHNlcnZpY2UsIHBpcGVs
aW5lLCBrZXlJbnB1dCwga2V5T3V0cHV0LCB2YWx1ZUlucHV0LCB2YWx1ZU91dHB1dCwgdmFsdWVD
bGFzcyk7CiAgICAgICAgICAgICAgb2FyeVtpXSA9IHQudmFsdWU7CiAgICAgICAgICAgIH0KICAg
ICAgICAgICAgdHVwbGUudmFsdWUgPSBvYXJ5OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAg
ICB0dXBsZSA9IG1hcCh0dXBsZSwgc2VydmljZSwgcGlwZWxpbmUsIGtleUlucHV0LCBrZXlPdXRw
dXQsIHZhbHVlSW5wdXQsIHZhbHVlT3V0cHV0LCB2YWx1ZUNsYXNzKTsKICAgICAgICBJRGF0YVV0
aWwucHV0KG9jLCB0dXBsZS5rZXksIHR1cGxlLnZhbHVlKTsKICAgICAgfQogICAgfSBmaW5hbGx5
IHsKICAgICAgaWMuZGVzdHJveSgpOwogICAgICBvYy5kZXN0cm95KCk7CiAgICB9CiAgfSBlbHNl
IHsKICAgIG91dHB1dCA9IGR1cGxpY2F0ZShpbnB1dCwgcmVjdXJzZSk7CiAgfQoKICByZXR1cm4g
b3V0cHV0Owp9CgovLyB3cmFwcGVyIGNsYXNzIGZvciB7a2V5LCB2YWx1ZX0gdHVwbGVzCnByb3Rl
Y3RlZCBzdGF0aWMgY2xhc3MgVHVwbGU8VD4geyAKICBwdWJsaWMgU3RyaW5nIGtleTsKICBwdWJs
aWMgVCB2YWx1ZTsKICBwdWJsaWMgVHVwbGUoU3RyaW5nIGtleSwgVCB2YWx1ZSkgeyAKICAgIHRo
aXMua2V5ID0ga2V5OyAKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsgCiAgfQp9CgovLyBjb252ZXJ0
cyB0aGUgZ2l2ZW4gZWxlbWVudCBieSBjYWxsaW5nIHRoZSBnaXZlbiBzZXJ2aWNlLCBhbmQgcmV0
dXJucyB0aGUgcmVzdWx0CnByb3RlY3RlZCBzdGF0aWMgPFQ+IFR1cGxlPFQ+IG1hcChUdXBsZTxU
PiB0dXBsZSwgU3RyaW5nIHNlcnZpY2UsIElEYXRhIHBpcGVsaW5lLCBTdHJpbmcga2V5SW5wdXQs
IFN0cmluZyBrZXlPdXRwdXQsIFN0cmluZyB2YWx1ZUlucHV0LCBTdHJpbmcgdmFsdWVPdXRwdXQs
IENsYXNzIHZhbHVlQ2xhc3MpIHRocm93cyBTZXJ2aWNlRXhjZXB0aW9uIHsKICBpZiAodHVwbGUu
dmFsdWUgPT0gbnVsbCB8fCB2YWx1ZUNsYXNzID09IG51bGwgfHwgdmFsdWVDbGFzcy5pc0luc3Rh
bmNlKHR1cGxlLnZhbHVlKSkgewogICAgSURhdGFDdXJzb3IgY3Vyc29yID0gcGlwZWxpbmUuZ2V0
Q3Vyc29yKCk7CiAgICBJRGF0YVV0aWwucHV0KGN1cnNvciwga2V5SW5wdXQsIHR1cGxlLmtleSk7
CiAgICBJRGF0YVV0aWwucHV0KGN1cnNvciwgdmFsdWVJbnB1dCwgdHVwbGUudmFsdWUpOwogICAg
Y3Vyc29yLmRlc3Ryb3koKTsKCiAgICBwaXBlbGluZSA9IHR1bmRyYS5zZXJ2aWNlLmludm9rZShz
ZXJ2aWNlLCBwaXBlbGluZSk7CgogICAgLy8gY2xlYW4gdXAgdGhlIGlucHV0IHBpcGVsaW5lCiAg
ICBjdXJzb3IgPSBwaXBlbGluZS5nZXRDdXJzb3IoKTsKICAgIHR1cGxlLmtleSA9IElEYXRhVXRp
bC5nZXRTdHJpbmcoY3Vyc29yLCBrZXlPdXRwdXQpOwogICAgdHVwbGUudmFsdWUgPSAoVClJRGF0
YVV0aWwuZ2V0KGN1cnNvciwgdmFsdWVPdXRwdXQpOwogICAgSURhdGFVdGlsLnJlbW92ZShjdXJz
b3IsIGtleUlucHV0KTsKICAgIGlmICgha2V5SW5wdXQuZXF1YWxzKGtleU91dHB1dCkpIElEYXRh
VXRpbC5yZW1vdmUoY3Vyc29yLCBrZXlPdXRwdXQpOwogICAgSURhdGFVdGlsLnJlbW92ZShjdXJz
b3IsIHZhbHVlSW5wdXQpOwogICAgaWYgKCF2YWx1ZUlucHV0LmVxdWFscyh2YWx1ZU91dHB1dCkp
IElEYXRhVXRpbC5yZW1vdmUoY3Vyc29yLCB2YWx1ZU91dHB1dCk7CiAgICBjdXJzb3IuZGVzdHJv
eSgpOwogIH0gIAogIHJldHVybiB0dXBsZTsKfQoKLy8gaW52b2tlcyB0aGUgZ2l2ZW4gc2Vydmlj
ZSBmb3IgZWFjaCB7a2V5LCB2YWx1ZX0gcGFpciBpbiB0aGUgZ2l2ZW4gSURhdGEgZG9jdW1lbnQK
cHVibGljIHN0YXRpYyB2b2lkIGVhY2goSURhdGEgaW5wdXQsIFN0cmluZyBzZXJ2aWNlLCBJRGF0
YSBwaXBlbGluZSwgU3RyaW5nIGtleUlucHV0LCBTdHJpbmcgdmFsdWVJbnB1dCwgQ2xhc3MgdmFs
dWVDbGFzcywgYm9vbGVhbiByZWN1cnNlKSB0aHJvd3MgU2VydmljZUV4Y2VwdGlvbiB7CiAgbWFw
KGlucHV0LCBzZXJ2aWNlLCBwaXBlbGluZSwga2V5SW5wdXQsIG51bGwsIHZhbHVlSW5wdXQsIG51
bGwsIHZhbHVlQ2xhc3MsIHJlY3Vyc2UpOwp9CgovLyByZW5hbWVzIGEga2V5IGZyb20gc291cmNl
IHRvIHRhcmdldCB3aXRoaW4gdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMg
SURhdGEgcmVuYW1lKElEYXRhIGlucHV0LCBTdHJpbmcgc291cmNlLCBTdHJpbmcgdGFyZ2V0KSB7
CiAgaWYgKCFzb3VyY2UuZXF1YWxzKHRhcmdldCkpIGlucHV0ID0gZHJvcChjb3B5KGlucHV0LCBz
b3VyY2UsIHRhcmdldCksIHNvdXJjZSk7CiAgcmV0dXJuIGlucHV0Owp9CgovLyBjb3BpZXMgYSB2
YWx1ZSBmcm9tIHNvdXJjZSBrZXkgdG8gdGFyZ2V0IGtleSB3aXRoaW4gdGhlIGdpdmVuIElEYXRh
IGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgSURhdGEgY29weShJRGF0YSBpbnB1dCwgU3RyaW5nIHNv
dXJjZSwgU3RyaW5nIHRhcmdldCkgewogIGlmIChzb3VyY2UuZXF1YWxzKHRhcmdldCkpIHJldHVy
biBpbnB1dDsKICByZXR1cm4gdHVuZHJhLnN1cHBvcnQuZG9jdW1lbnQucHV0KGlucHV0LCB0YXJn
ZXQsIHR1bmRyYS5zdXBwb3J0LmRvY3VtZW50LmdldChpbnB1dCwgc291cmNlKSk7Cn0KCi8vIHJl
bW92ZXMgYWxsIG51bGwgdmFsdWVzIGZyb20gdGhlIGdpdmVuIElEYXRhIGRvY3VtZW50CnB1Ymxp
YyBzdGF0aWMgSURhdGEgY29tcGFjdChJRGF0YSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAg
SURhdGEgb3V0cHV0ID0gbnVsbDsKCiAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgIG91dHB1dCA9
IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKICAgIElEYXRhQ3Vyc29yIGljID0gaW5wdXQuZ2V0Q3Vy
c29yKCk7CiAgICBJRGF0YUN1cnNvciBvYyA9IG91dHB1dC5nZXRDdXJzb3IoKTsKCiAgICB0cnkg
ewogICAgICB3aGlsZShpYy5uZXh0KCkpIHsKICAgICAgICBTdHJpbmcga2V5ID0gaWMuZ2V0S2V5
KCk7CiAgICAgICAgT2JqZWN0IHZhbHVlID0gaWMuZ2V0VmFsdWUoKTsKCiAgICAgICAgaWYgKHZh
bHVlICE9IG51bGwpIHsKICAgICAgICAgIGlmIChyZWN1cnNlKSB7CiAgICAgICAgICAgIGlmICh2
YWx1ZSBpbnN0YW5jZW9mIElEYXRhKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBjb21wYWN0KChJ
RGF0YSl2YWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFu
Y2VvZiBJRGF0YVtdIHx8IHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwuVGFibGUpIHsKICAg
ICAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5saXN0LmRvY3VtZW50LmNvbXBhY3QodmFsdWUgaW5z
dGFuY2VvZiBJRGF0YVtdID8gKElEYXRhW10pdmFsdWUgOiAoKGNvbS53bS51dGlsLlRhYmxlKXZh
bHVlKS5nZXRWYWx1ZXMoKSwgcmVjdXJzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUg
aW5zdGFuY2VvZiBPYmplY3RbXVtdKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0dW5kcmEuc3Vw
cG9ydC50YWJsZS5vYmplY3QuY29tcGFjdCgoT2JqZWN0W11bXSl2YWx1ZSk7CiAgICAgICAgICAg
IH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3RbXSkgewogICAgICAgICAgICAgIHZh
bHVlID0gdHVuZHJhLmxpc3Qub2JqZWN0LmNvbXBhY3QoKE9iamVjdFtdKXZhbHVlKTsKICAgICAg
ICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwp
IElEYXRhVXRpbC5wdXQob2MsIGtleSwgdmFsdWUpOwogICAgICB9CiAgICB9IGZpbmFsbHkgewog
ICAgICBpYy5kZXN0cm95KCk7CiAgICAgIG9jLmRlc3Ryb3koKTsKICAgIH0KICB9CgogIHJldHVy
biBvdXRwdXQ7Cn0KCi8vIHJldHVybnMgYSBuZXcgSURhdGEgZG9jdW1lbnQsIHdoZXJlIGFsbCBJ
RGF0YXMgYXJlIGltcGxlbWVudGVkIHdpdGggdGhlIHNhbWUgY2xhc3MsIGFuZCBhbGwKLy8gZnVs
bHkgcXVhbGlmaWVkIGtleXMgYXJlIHJlcGxhY2VkIHdpdGggYSBuZXN0ZWQgc3RydWN0dXJlCnB1
YmxpYyBzdGF0aWMgSURhdGEgbm9ybWFsaXplKElEYXRhIGlucHV0LCBib29sZWFuIHJlY3Vyc2Up
IHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51bGw7CgogIElEYXRhIG91dHB1dCA9IElE
YXRhRmFjdG9yeS5jcmVhdGUoKTsKICBJRGF0YUN1cnNvciBpYyA9IGlucHV0LmdldEN1cnNvcigp
OwoKICB0cnkgewogICAgd2hpbGUoaWMubmV4dCgpKSB7CiAgICAgIFN0cmluZyBrZXkgPSBpYy5n
ZXRLZXkoKTsKICAgICAgT2JqZWN0IHZhbHVlID0gaWMuZ2V0VmFsdWUoKTsKCiAgICAgIGlmICh2
YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgY29tLndtLnV0aWwu
Y29kZXIuSURhdGFDb2RhYmxlKSB7CiAgICAgICAgICB2YWx1ZSA9ICgoY29tLndtLnV0aWwuY29k
ZXIuSURhdGFDb2RhYmxlKXZhbHVlKS5nZXRJRGF0YSgpOwogICAgICAgIH0gZWxzZSBpZiAodmFs
dWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5jb2Rlci5WYWx1ZXNDb2RhYmxlKSB7CiAgICAgICAg
ICB2YWx1ZSA9ICgoY29tLndtLnV0aWwuY29kZXIuVmFsdWVzQ29kYWJsZSl2YWx1ZSkuZ2V0VmFs
dWVzKCk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51dGlsLmNv
ZGVyLklEYXRhQ29kYWJsZVtdKSB7CiAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6ZSgoY29tLndt
LnV0aWwuY29kZXIuSURhdGFDb2RhYmxlW10pdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxz
ZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5jb2Rlci5WYWx1ZXNDb2RhYmxlW10p
IHsKICAgICAgICAgIHZhbHVlID0gbm9ybWFsaXplKChjb20ud20udXRpbC5jb2Rlci5WYWx1ZXND
b2RhYmxlW10pdmFsdWUsIHJlY3Vyc2UpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFu
Y2VvZiBJRGF0YVtdKSB7CiAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6ZSgoSURhdGFbXSl2YWx1
ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGNvbS53bS51
dGlsLlRhYmxlKSB7CiAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6ZSgoKGNvbS53bS51dGlsLlRh
YmxlKXZhbHVlKS5nZXRWYWx1ZXMoKSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmIChyZWN1
cnNlICYmIHZhbHVlIGluc3RhbmNlb2YgSURhdGEpIHsKICAgICAgICAgIHZhbHVlID0gbm9ybWFs
aXplKChJRGF0YSl2YWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHR1bmRy
YS5zdXBwb3J0LmRvY3VtZW50LnB1dChvdXRwdXQsIGtleSwgdmFsdWUpOwogICAgfQogIH0gZmlu
YWxseSB7CiAgICBpYy5kZXN0cm95KCk7CiAgfQoKICByZXR1cm4gb3V0cHV0Owp9CgovLyBub3Jt
YWxpemVzIGFuIElEYXRhW10sIHdoZXJlIGFsbCBJRGF0YXMgYXJlIGltcGxlbWVudGVkIHdpdGgg
dGhlIHNhbWUgY2xhc3MsIGFuZCBhbGwKLy8gZnVsbHkgcXVhbGlmaWVkIGtleXMgYXJlIHJlcGxh
Y2VkIHdpdGggYSBuZXN0ZWQgc3RydWN0dXJlCnByb3RlY3RlZCBzdGF0aWMgSURhdGFbXSBub3Jt
YWxpemUoSURhdGFbXSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAgaWYgKGlucHV0ID09IG51
bGwpIHJldHVybiBudWxsOwoKICBJRGF0YVtdIG91dHB1dCA9IG5ldyBJRGF0YVtpbnB1dC5sZW5n
dGhdOwogIGZvciAoaW50IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgIG91dHB1
dFtpXSA9IG5vcm1hbGl6ZShpbnB1dFtpXSwgcmVjdXJzZSk7CiAgfQoKICByZXR1cm4gb3V0cHV0
Owp9CgovLyBjb252ZXJ0cyBhbiBJRGF0YUNvZGFibGVbXSB0byBhbiBJRGF0YVtdIGFuZCBub3Jt
YWxpemVzLCB3aGVyZSBhbGwgSURhdGFzIGFyZSBpbXBsZW1lbnRlZCAKLy8gd2l0aCB0aGUgc2Ft
ZSBjbGFzcywgYW5kIGFsbCBmdWxseSBxdWFsaWZpZWQga2V5cyBhcmUgcmVwbGFjZWQgd2l0aCBh
IG5lc3RlZCBzdHJ1Y3R1cmUKcHJvdGVjdGVkIHN0YXRpYyBJRGF0YVtdIG5vcm1hbGl6ZShjb20u
d20udXRpbC5jb2Rlci5JRGF0YUNvZGFibGVbXSBpbnB1dCwgYm9vbGVhbiByZWN1cnNlKSB7CiAg
aWYgKGlucHV0ID09IG51bGwpIHJldHVybiBudWxsOwoKICBJRGF0YVtdIG91dHB1dCA9IG5ldyBJ
RGF0YVtpbnB1dC5sZW5ndGhdOwogIGZvciAoaW50IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBp
KyspIHsKICAgIG91dHB1dFtpXSA9IG5vcm1hbGl6ZShpbnB1dFtpXS5nZXRJRGF0YSgpLCByZWN1
cnNlKTsKICB9CiAgCiAgcmV0dXJuIG91dHB1dDsKfQoKLy8gY29udmVydHMgYSBWYWx1ZXNDb2Rh
YmxlW10gdG8gYW4gSURhdGFbXSBhbmQgbm9ybWFsaXplcywgd2hlcmUgYWxsIElEYXRhcyBhcmUg
aW1wbGVtZW50ZWQgCi8vIHdpdGggdGhlIHNhbWUgY2xhc3MsIGFuZCBhbGwgZnVsbHkgcXVhbGlm
aWVkIGtleXMgYXJlIHJlcGxhY2VkIHdpdGggYSBuZXN0ZWQgc3RydWN0dXJlCnByb3RlY3RlZCBz
dGF0aWMgSURhdGFbXSBub3JtYWxpemUoY29tLndtLnV0aWwuY29kZXIuVmFsdWVzQ29kYWJsZVtd
IGlucHV0LCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0gbnVsbCkgcmV0dXJuIG51
bGw7CgogIElEYXRhW10gb3V0cHV0ID0gbmV3IElEYXRhW2lucHV0Lmxlbmd0aF07CiAgZm9yIChp
bnQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgb3V0cHV0W2ldID0gbm9ybWFs
aXplKGlucHV0W2ldLmdldFZhbHVlcygpLCByZWN1cnNlKTsKICB9CiAgCiAgcmV0dXJuIG91dHB1
dDsKfQoKLy8gcmVtb3ZlcyBhbGwga2V5cyBleGNlcHQgdGhvc2Ugc3BlY2lmaWVkIGZyb20gdGhl
IGdpdmVuIElEYXRhIGRvY3VtZW50CnB1YmxpYyBzdGF0aWMgdm9pZCBjbGVhcihJRGF0YSBkb2N1
bWVudCwgU3RyaW5nW10ga2V5cykgewogIGlmIChkb2N1bWVudCA9PSBudWxsKSByZXR1cm47Cgog
IElEYXRhIHNhdmVkID0gbnVsbDsKICBpZiAoa2V5cyAhPSBudWxsKSB7CiAgICBzYXZlZCA9IElE
YXRhRmFjdG9yeS5jcmVhdGUoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7
IGkrKykgewogICAgICBPYmplY3QgdmFsdWUgPSB0dW5kcmEuc3VwcG9ydC5kb2N1bWVudC5nZXQo
ZG9jdW1lbnQsIGtleXNbaV0pOwogICAgICBpZiAodmFsdWUgIT0gbnVsbCkgdHVuZHJhLnN1cHBv
cnQuZG9jdW1lbnQucHV0KHNhdmVkLCBrZXlzW2ldLCB2YWx1ZSk7CiAgICB9CiAgfQoKICBJRGF0
YUN1cnNvciBjdXJzb3IgPSBkb2N1bWVudC5nZXRDdXJzb3IoKTsKICBjdXJzb3IuZmlyc3QoKTsK
ICB3aGlsZShjdXJzb3IuZGVsZXRlKCkpOwogIGN1cnNvci5kZXN0cm95KCk7CgogIGlmIChrZXlz
ICE9IG51bGwpIElEYXRhVXRpbC5tZXJnZShzYXZlZCwgZG9jdW1lbnQpOwp9CgovLyBwZXJmb3Jt
cyB2YXJpYWJsZSBzdWJzdGl0dXRpb24gb24gYWxsIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBJRGF0
YSBpbnB1dCBkb2N1bWVudApwdWJsaWMgc3RhdGljIElEYXRhIHN1YnN0aXR1dGUoSURhdGEgaW5w
dXQsIElEYXRhIHNjb3BlLCBib29sZWFuIHJlY3Vyc2UpIHsKICByZXR1cm4gc3Vic3RpdHV0ZShp
bnB1dCwgc2NvcGUsIG51bGwsIHJlY3Vyc2UpOwp9CgovLyBwZXJmb3JtcyB2YXJpYWJsZSBzdWJz
dGl0dXRpb24gb24gYWxsIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBJRGF0YSBpbnB1dCBkb2N1bWVu
dApwdWJsaWMgc3RhdGljIElEYXRhIHN1YnN0aXR1dGUoSURhdGEgaW5wdXQsIElEYXRhIHNjb3Bl
LCBTdHJpbmcgZGVmYXVsdFZhbHVlLCBib29sZWFuIHJlY3Vyc2UpIHsKICBpZiAoaW5wdXQgPT0g
bnVsbCkgcmV0dXJuIG51bGw7CiAgaWYgKHNjb3BlID09IG51bGwpIHNjb3BlID0gaW5wdXQ7Cgog
IElEYXRhIG91dHB1dCA9IElEYXRhRmFjdG9yeS5jcmVhdGUoKTsKCiAgSURhdGFDdXJzb3IgaWMg
PSBpbnB1dC5nZXRDdXJzb3IoKTsKICBJRGF0YUN1cnNvciBvYyA9IG91dHB1dC5nZXRDdXJzb3Io
KTsKCiAgdHJ5IHsKICAgIHdoaWxlKGljLm5leHQoKSkgewogICAgICBTdHJpbmcga2V5ID0gaWMu
Z2V0S2V5KCk7CiAgICAgIE9iamVjdCB2YWx1ZSA9IGljLmdldFZhbHVlKCk7CiAgICAgIGlmICh2
YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgaWYgKHJlY3Vyc2UgJiYgdmFsdWUgaW5zdGFuY2VvZiBJ
RGF0YSkgewogICAgICAgICAgdmFsdWUgPSBzdWJzdGl0dXRlKChJRGF0YSl2YWx1ZSwgc2NvcGUs
IGRlZmF1bHRWYWx1ZSwgcmVjdXJzZSk7CiAgICAgICAgfSBlbHNlIGlmIChyZWN1cnNlICYmICh2
YWx1ZSBpbnN0YW5jZW9mIElEYXRhW10gfHwgdmFsdWUgaW5zdGFuY2VvZiBjb20ud20udXRpbC5U
YWJsZSkpIHsKICAgICAgICAgIElEYXRhW10gaWFyeSA9IHZhbHVlIGluc3RhbmNlb2YgSURhdGFb
XSA/IChJRGF0YVtdKXZhbHVlIDogKChjb20ud20udXRpbC5UYWJsZSl2YWx1ZSkuZ2V0VmFsdWVz
KCk7CiAgICAgICAgICBJRGF0YVtdIG9hcnkgPSBuZXcgSURhdGFbaWFyeS5sZW5ndGhdOwogICAg
ICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpYXJ5Lmxlbmd0aDsgaSsrKSBvYXJ5W2ldID0gc3Vi
c3RpdHV0ZShpYXJ5W2ldLCBzY29wZSwgZGVmYXVsdFZhbHVlLCByZWN1cnNlKTsKICAgICAgICAg
IHZhbHVlID0gb2FyeTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5n
KSB7CiAgICAgICAgICB2YWx1ZSA9IHR1bmRyYS5zdHJpbmcuc3Vic3RpdHV0ZSgoU3RyaW5nKXZh
bHVlLCBzY29wZSwgZGVmYXVsdFZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3Rh
bmNlb2YgU3RyaW5nW10pIHsKICAgICAgICAgIHZhbHVlID0gdHVuZHJhLmxpc3Quc3RyaW5nLnN1
YnN0aXR1dGUoKFN0cmluZ1tdKXZhbHVlLCBzY29wZSwgZGVmYXVsdFZhbHVlKTsKICAgICAgICB9
IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nW11bXSkgewogICAgICAgICAgdmFsdWUg
PSB0dW5kcmEubGlzdC5zdHJpbmcuc3Vic3RpdHV0ZSgoU3RyaW5nW11bXSl2YWx1ZSwgc2NvcGUs
IGRlZmF1bHRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIElEYXRhVXRpbC5wdXQob2Ms
IGtleSwgdmFsdWUpOwogICAgfQogIH0gZmluYWxseSB7CiAgICBpYy5kZXN0cm95KCk7CiAgICBv
Yy5kZXN0cm95KCk7CiAgfQoKICByZXR1cm4gb3V0cHV0Owp9CgovLyBwYXJzZXMgYW4gSURhdGEg
WE1MIGlucHV0IHN0cmVhbSB0byBhbiBJRGF0YSBvYmplY3QKcHVibGljIHN0YXRpYyBJRGF0YSBw
YXJzZShqYXZhLmlvLklucHV0U3RyZWFtIGluKSB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7
CiAgY29tLndtLnV0aWwuY29kZXIuWE1MQ29kZXJXcmFwcGVyIGNvZGVjID0gbmV3IGNvbS53bS51
dGlsLmNvZGVyLlhNTENvZGVyV3JhcHBlcigpOwogIHJldHVybiBjb2RlYy5kZWNvZGUoaW4pOwp9
CgovLyBwYXJzZXMgYW4gSURhdGEgWE1MIHN0cmluZywgYnl0ZSBhcnJheSBvciBpbnB1dCBzdHJl
YW0gdG8gYW4gSURhdGEgb2JqZWN0CnB1YmxpYyBzdGF0aWMgSURhdGEgcGFyc2UoT2JqZWN0IGNv
bnRlbnQsIFN0cmluZyBlbmNvZGluZykgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogIHJl
dHVybiBwYXJzZSgoamF2YS5pby5JbnB1dFN0cmVhbSl0dW5kcmEub2JqZWN0LmNvbnZlcnQoY29u
dGVudCwgZW5jb2RpbmcsICJzdHJlYW0iKSk7Cn0KCi8vIGVtaXRzIGFuIElEYXRhIG9iamVjdCBh
cyBhIGFuIElEYXRhIFhNTCBzdHJpbmcsIGJ5dGUgYXJyYXkgb3Igc3RyZWFtCnB1YmxpYyBzdGF0
aWMgT2JqZWN0IGVtaXQoSURhdGEgZG9jdW1lbnQsIFN0cmluZyBlbmNvZGluZywgU3RyaW5nIG1v
ZGUpIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICBjb20ud20udXRpbC5jb2Rlci5JRGF0
YVhNTENvZGVyIGNvZGVjID0gbnVsbDsKICBpZiAoZW5jb2RpbmcgPT0gbnVsbCkgewogICAgY29k
ZWMgPSBuZXcgY29tLndtLnV0aWwuY29kZXIuSURhdGFYTUxDb2RlcigpOwogIH0gZWxzZSB7CiAg
ICBjb2RlYyA9IG5ldyBjb20ud20udXRpbC5jb2Rlci5JRGF0YVhNTENvZGVyKGVuY29kaW5nKTsK
ICB9CgogIGphdmEuaW8uQnl0ZUFycmF5T3V0cHV0U3RyZWFtIG91dCA9IG5ldyBqYXZhLmlvLkJ5
dGVBcnJheU91dHB1dFN0cmVhbSgpOwogIGNvZGVjLmVuY29kZShvdXQsIGRvY3VtZW50KTsKCiAg
cmV0dXJuIHR1bmRyYS5vYmplY3QuY29udmVydChvdXQudG9CeXRlQXJyYXkoKSwgZW5jb2Rpbmcs
IG1vZGUpOwp9</value>
  <value name="extends"></value>
  <array name="implements" type="value" depth="1">
  </array>
  <array name="imports" type="value" depth="1">
  </array>
</Values>
